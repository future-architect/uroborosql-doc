<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQLファイルインタフェース | uroboroSQL</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/uroborosql-doc/favicon.ico">
    <meta name="description" content="uroboroSQLはJava製のシンプルなSQL実行ライブラリです">
    <meta name="og:title" content="SQLファイルインタフェース">
    <meta name="og:url" content="/uroborosql-doc/basics/sql-file-api.html">
    <meta name="og:type" content="website">
    <meta name="og:description" content="uroboroSQLDeveloper-oriented and SQL centric database access library.">
    <meta name="og:image" content="https://future-architect.github.io/uroborosql-doc/images/logo.png">
    
    <link rel="preload" href="/uroborosql-doc/assets/css/0.styles.466672a1.css" as="style"><link rel="preload" href="/uroborosql-doc/assets/js/app.fc355632.js" as="script"><link rel="preload" href="/uroborosql-doc/assets/js/2.e1a5c61f.js" as="script"><link rel="preload" href="/uroborosql-doc/assets/js/17.b992cbad.js" as="script"><link rel="preload" href="/uroborosql-doc/assets/js/4.93701c86.js" as="script"><link rel="prefetch" href="/uroborosql-doc/assets/js/10.1663d500.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/11.0614fdda.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/12.6064d663.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/13.fe09fe32.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/14.fc231e30.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/15.49279ee3.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/16.6ae6757c.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/18.95fa51cf.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/19.68c10ff1.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/20.156efa43.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/21.eb299bbe.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/22.9466963c.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/23.7a77a636.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/24.b162d445.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/25.b1a51fbb.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/26.1b4bd17a.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/27.05b4e69b.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/28.4c32ba70.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/29.bfdf3542.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/3.f74bbe9d.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/30.3b44c701.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/31.6bab11b7.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/32.733d5055.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/33.57f384f9.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/34.20af6add.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/5.7af68e87.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/6.a5fdc69f.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/7.a6e58161.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/8.8d22e40d.js"><link rel="prefetch" href="/uroborosql-doc/assets/js/9.04c18d6d.js">
    <link rel="stylesheet" href="/uroborosql-doc/assets/css/0.styles.466672a1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/uroborosql-doc/" class="home-link router-link-active"><img src="/uroborosql-doc/images/logo.png" alt="uroboroSQL" class="logo"> <span class="site-name can-hide">uroboroSQL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/uroborosql-doc/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/uroborosql-doc/getting_started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/uroborosql-doc/basics/" class="nav-link router-link-active">
  基本操作
</a></div><div class="nav-item"><a href="/uroborosql-doc/configuration/" class="nav-link">
  設定
</a></div><div class="nav-item"><a href="/uroborosql-doc/advanced/" class="nav-link">
  高度な操作
</a></div><div class="nav-item"><a href="/uroborosql-doc/developer_tools/" class="nav-link">
  Developer Tools
</a></div> <a href="https://github.com/future-architect/uroborosql" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/uroborosql-doc/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/uroborosql-doc/getting_started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/uroborosql-doc/basics/" class="nav-link router-link-active">
  基本操作
</a></div><div class="nav-item"><a href="/uroborosql-doc/configuration/" class="nav-link">
  設定
</a></div><div class="nav-item"><a href="/uroborosql-doc/advanced/" class="nav-link">
  高度な操作
</a></div><div class="nav-item"><a href="/uroborosql-doc/developer_tools/" class="nav-link">
  Developer Tools
</a></div> <a href="https://github.com/future-architect/uroborosql" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Why uroboroSQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前提知識</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基本操作</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/uroborosql-doc/basics/" aria-current="page" class="sidebar-link">事前準備</a></li><li><a href="/uroborosql-doc/basics/sql-file-api.html" aria-current="page" class="active sidebar-link">SQLファイルインタフェース</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#sqlによる検索-sqlagent-query-querywith" class="sidebar-link">SQLによる検索(SqlAgent#query /#queryWith)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#検索結果の取得" class="sidebar-link">検索結果の取得</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#リスト取得-sqlquery-collect" class="sidebar-link">リスト取得(SqlQuery#collect)</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#先頭取得-sqlquery-first" class="sidebar-link">先頭取得（SqlQuery#first)</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#先頭取得-sqlquery-findfirst" class="sidebar-link">先頭取得（SqlQuery#findFirst)</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#先頭1件取得-sqlquery-one" class="sidebar-link">先頭１件取得（SqlQuery#one)</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#先頭1件取得-sqlquery-findone" class="sidebar-link">先頭１件取得（SqlQuery#findOne)</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#stream取得-sqlquery-stream" class="sidebar-link">Stream取得(SqlQuery#stream)</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#resultset取得-sqlquery-resultset" class="sidebar-link">ResultSet取得(SqlQuery#resultSet)</a></li></ul></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#sqlによる更新-sqlagent-update-updatewith" class="sidebar-link">SQLによる更新(SqlAgent#update /#updateWith)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#更新の実行-sqlupdate-count" class="sidebar-link">更新の実行(SqlUpdate#count)</a></li></ul></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#sqlによるバッチ更新-sqlbatch-batch-batchwith" class="sidebar-link">SQLによるバッチ更新(SqlBatch#batch /#batchWith)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#バッチ更新の実行-sqlbatch-count" class="sidebar-link">バッチ更新の実行(SqlBatch#count)</a></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#バッチsql実行動作のカスタマイズ" class="sidebar-link">バッチSQL実行動作のカスタマイズ</a></li></ul></li><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#ストアドプロシージャの実行-sqlagent-proc-procwith" class="sidebar-link">ストアドプロシージャの実行(SqlAgent#proc /#procWith)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/uroborosql-doc/basics/sql-file-api.html#procedureインタフェース" class="sidebar-link">Procedureインタフェース</a></li></ul></li></ul></li><li><a href="/uroborosql-doc/basics/entity-api.html" class="sidebar-link">DAOインタフェース</a></li><li><a href="/uroborosql-doc/basics/transaction.html" class="sidebar-link">トランザクション</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>設定</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>高度な操作</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/uroborosql-doc/developer_tools/" class="sidebar-link">Developer Tools</a></li><li><a href="/uroborosql-doc/developer_guide/" class="sidebar-link">開発者ガイド</a></li><li><a href="/uroborosql-doc/license/" class="sidebar-link">License</a></li><li><a href="/uroborosql-doc/about/" class="sidebar-link">uroboroSQLについて</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sqlファイルインタフェース"><a href="#sqlファイルインタフェース" class="header-anchor">#</a> SQLファイルインタフェース</h1> <h2 id="sqlによる検索-sqlagent-query-querywith"><a href="#sqlによる検索-sqlagent-query-querywith" class="header-anchor">#</a> SQLによる検索(<code>SqlAgent#query</code> /<code>#queryWith</code>)</h2> <p>SQLを検索する方法は2つあります。</p> <table><thead><tr><th style="text-align:left;">利用メソッド</th> <th style="text-align:left;">説明</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlAgent#query(&quot;[SQL名]&quot;)</td> <td style="text-align:left;"><a href="/uroborosql-doc/basics/#sql名">SQL名</a>で説明した<code>SQL名</code>を指定</td></tr> <tr><td style="text-align:left;">SqlAgent#queryWith(&quot;[SQL文字列]&quot;)</td> <td style="text-align:left;"><code>SQL文字列</code>を直接指定</td></tr></tbody></table> <p>上記２つのメソッドは検索を行うための<code>SqlQuery</code>インタフェースのインスタンスを返却します。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// SQL名を指定</span>
<span class="token class-name">SqlQuery</span> query1 <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;employee/select_employee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SQL文字列を指定</span>
<span class="token class-name">SqlQuery</span> query2 <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">queryWith</span><span class="token punctuation">(</span><span class="token string">&quot;select first_name, last_name where employee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="検索結果の取得"><a href="#検索結果の取得" class="header-anchor">#</a> 検索結果の取得</h3> <p><code>SqlAgent</code>から取得した<code>SQLQuery</code>を使用していろいろな形式で検索結果を取得することが出来ます。<br>
下記のSQLを例に説明します。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- department/select_department.sql</span>
<span class="token keyword">select</span> <span class="token comment">/* _SQL_ID_ */</span>
  dept<span class="token punctuation">.</span>dept_no  <span class="token keyword">as</span>  dept_no
<span class="token punctuation">,</span>  dept<span class="token punctuation">.</span>dept_name  <span class="token keyword">as</span>  dept_name
<span class="token keyword">from</span>
  department  dept
<span class="token keyword">where</span>
  <span class="token number">1</span>        <span class="token operator">=</span>  <span class="token number">1</span>
<span class="token comment">/*IF SF.isNotEmpty(dept_no)*/</span>
<span class="token operator">and</span>  dept<span class="token punctuation">.</span>dept_no  <span class="token operator">=</span>  <span class="token comment">/*dept_no*/</span><span class="token number">1</span>
<span class="token comment">/*END*/</span>
<span class="token comment">/*IF SF.isNotEmpty(dept_name)*/</span>
<span class="token operator">and</span>  dept<span class="token punctuation">.</span>dept_name  <span class="token operator">=</span>  <span class="token comment">/*dept_name*/</span><span class="token string">'sample'</span>
<span class="token comment">/*END*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="リスト取得-sqlquery-collect"><a href="#リスト取得-sqlquery-collect" class="header-anchor">#</a> リスト取得(<code>SqlQuery#collect</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlQuery#collect()</td> <td style="text-align:left;">List&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#collect(CaseFormat)</td> <td style="text-align:left;">List&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#collect(Class&lt;T&gt;)</td> <td style="text-align:left;">List&lt;Class&lt;T&gt;&gt;</td></tr></tbody></table> <p>検索結果をMapやエンティティクラスのListとして取得します。<br>
Mapには<code>キー：カラムラベル名</code>、<code>値：カラムの値</code>の形で1行分のデータが格納されます。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>SqlQuery#collect()</code>では検索結果をすべてメモリ上に格納します。大量データの検索を行う場合は後述の<code>SqlQuery#strem()</code>の利用を検討してください。</p></div> <p>引数なし</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> departments <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(departments)</span>
<span class="token punctuation">[</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;export&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;accounting&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;personnel&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>引数に<code>jp.co.future.uroborosql.utils.CaseFormat</code>を指定することで、Mapのキー名に対する書式を変更することができます。</p> <p><code>CaseFormat.CAMEL_CASE</code>指定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> departments <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">CaseFormat</span><span class="token punctuation">.</span>CAMEL_CASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(departments) のキーが&quot;deptNo&quot;, &quot;deptName&quot;となる</span>
<span class="token punctuation">[</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;export&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;accounting&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;personnel&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>CaseFormat</code>の指定がない場合はデフォルトの<code>CaseFormat</code>（初期設定では<code>UPPER_SNAKE_CASE</code>）で加工した値になります。<br>
デフォルトの<code>CaseFormat</code>はSqlConfig生成時に変更することができます。
デフォルト<code>CaseFormat</code>の設定の詳細は <a href="/uroborosql-doc/configuration/sql-agent-factory.html#caseformatの初期値設定">CaseFormatの初期値設定</a> を参照してください</p> <p>引数にエンティティクラスを指定すると、検索結果をMapの代わりにエンティティクラスのインスタンスのListで取得することができます。</p> <p>エンティティクラス</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Entity that can be mapped to department table
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">long</span> deptNo<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> deptName<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getDeptNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>　<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deptNo<span class="token punctuation">;</span>　<span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDeptNo</span><span class="token punctuation">(</span><span class="token keyword">long</span> deptNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>　<span class="token keyword">this</span><span class="token punctuation">.</span>deptNo <span class="token operator">=</span> deptNo<span class="token punctuation">;</span>　<span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDeptName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>　<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deptName<span class="token punctuation">;</span>　<span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDeptName</span><span class="token punctuation">(</span><span class="token class-name">String</span> deptName<span class="token punctuation">)</span> <span class="token punctuation">{</span>　<span class="token keyword">this</span><span class="token punctuation">.</span>deptName <span class="token operator">=</span> deptName<span class="token punctuation">;</span>　<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> departments <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="先頭取得-sqlquery-first"><a href="#先頭取得-sqlquery-first" class="header-anchor">#</a> 先頭取得（<code>SqlQuery#first</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlQuery#first()</td> <td style="text-align:left;">Map&lt;String, Object&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#first(CaseFormat)</td> <td style="text-align:left;">Map&lt;String, Object&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#first(Class&lt;T&gt;)</td> <td style="text-align:left;">T</td></tr></tbody></table> <p>検索結果の1件目を取得します。<br>
結果を取得できない（検索結果が0件）場合、<code>jp.co.future.uroborosql.exception.DataNotFoundException</code>をスローします。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>メモリ上には最大1件分のデータしか格納しないため、検索結果が大量になる場合でもメモリ使用量を気にせず呼び出すことができます。</p></div> <p>引数なし</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>引数に<code>jp.co.future.uroborosql.utils.CaseFormat</code>を指定することで、Mapのキー名に対する書式を変更することができます。</p> <p><code>CaseFormat.CAMEL_CASE</code>指定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token class-name">CaseFormat</span><span class="token punctuation">.</span>CAMEL_CASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p> <p>エンティティクラス</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Department</span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="先頭取得-sqlquery-findfirst"><a href="#先頭取得-sqlquery-findfirst" class="header-anchor">#</a> 先頭取得（<code>SqlQuery#findFirst</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlQuery#findFirst()</td> <td style="text-align:left;">Optional&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#findFirst(CaseFormat)</td> <td style="text-align:left;">Optional&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#findFirst(Class&lt;T&gt;)</td> <td style="text-align:left;">Optional&lt;T&gt;</td></tr></tbody></table> <p>検索結果の1件目をOptionalの形式で取得します。<br>
メモリ上には最大1件分のデータしか格納しないため、検索結果が大量になる場合でもメモリ使用量を気にせず呼び出すことができます。</p> <p>引数なし</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>引数に<code>jp.co.future.uroborosql.utils.CaseFormat</code>を指定することで、Mapのキー名に対する書式を変更することができます。</p> <p><code>CaseFormat.CAMEL_CASE</code>指定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token class-name">CaseFormat</span><span class="token punctuation">.</span>CAMEL_CASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p> <p>エンティティクラス</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Department</span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="先頭1件取得-sqlquery-one"><a href="#先頭1件取得-sqlquery-one" class="header-anchor">#</a> 先頭１件取得（<code>SqlQuery#one</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlQuery#one()</td> <td style="text-align:left;">Map&lt;String, Object&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#one(CaseFormat)</td> <td style="text-align:left;">Map&lt;String, Object&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#one(Class&lt;T&gt;)</td> <td style="text-align:left;">T</td></tr></tbody></table> <p>検索結果の1件目を取得します。<a href="#%E5%85%88%E9%A0%AD%E5%8F%96%E5%BE%97%EF%BC%88sqlquery-first">find()</a>と違い、実行するSQLで複数件の検索結果を返す場合は例外をスローします。<br>
結果を取得できない（検索結果が0件）場合、<code>jp.co.future.uroborosql.exception.DataNotFoundException</code>をスローします。<br>
検索結果が2件以上存在する場合、<code>jp.co.future.uroborosql.exception.DataNotUniqueException</code>をスローします。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>メモリ上には最大1件分のデータしか格納しないため、検索結果が大量になる場合でもメモリ使用量を気にせず呼び出すことができます。</p></div> <p>引数なし</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">DataNotUniqueException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>引数に<code>jp.co.future.uroborosql.utils.CaseFormat</code>を指定することで、Mapのキー名に対する書式を変更することができます。</p> <p><code>CaseFormat.CAMEL_CASE</code>指定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">one</span><span class="token punctuation">(</span><span class="token class-name">CaseFormat</span><span class="token punctuation">.</span>CAMEL_CASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">DataNotUniqueException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p> <p>エンティティクラス</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Department</span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">one</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">DataNotUniqueException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="先頭1件取得-sqlquery-findone"><a href="#先頭1件取得-sqlquery-findone" class="header-anchor">#</a> 先頭１件取得（<code>SqlQuery#findOne</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlQuery#findOne()</td> <td style="text-align:left;">Optional&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#findOne(CaseFormat)</td> <td style="text-align:left;">Optional&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#findOne(Class&lt;T&gt;)</td> <td style="text-align:left;">Optional&lt;T&gt;</td></tr></tbody></table> <p>検索結果の1件目をOptionalの形式で取得します。<br>
検索結果が2件以上存在する場合、<code>jp.co.future.uroborosql.exception.DataNotUniqueException</code>をスローします。<br>
メモリ上には最大1件分のデータしか格納しないため、検索結果が大量になる場合でもメモリ使用量を気にせず呼び出すことができます。</p> <p>引数なし</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotUniqueException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>引数に<code>jp.co.future.uroborosql.utils.CaseFormat</code>を指定することで、Mapのキー名に対する書式を変更することができます。</p> <p><code>CaseFormat.CAMEL_CASE</code>指定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">CaseFormat</span><span class="token punctuation">.</span>CAMEL_CASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotUniqueException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果(department)</span>
 <span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p> <p>エンティティクラス</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Department</span> department <span class="token operator">=</span>
    agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataNotUniqueException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="stream取得-sqlquery-stream"><a href="#stream取得-sqlquery-stream" class="header-anchor">#</a> Stream取得(<code>SqlQuery#stream</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlQuery#stream()</td> <td style="text-align:left;">Stream&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#stream(CaseFormat)</td> <td style="text-align:left;">Stream&lt;Map&lt;String, Object&gt;&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#stream(Class&lt;T&gt;)</td> <td style="text-align:left;">Stream&lt;T&gt;</td></tr> <tr><td style="text-align:left;">SqlQuery#stream(ResultSetConverter&lt;T&gt;)</td> <td style="text-align:left;">Stream&lt;T&gt;</td></tr></tbody></table> <p>検索結果を<code>java.util.stream.Stream</code>の形式で取得します。<br>
Streamによる順次読み込みと終端操作までの遅延処理により、メモリ効率の良い操作が可能になります。</p> <p>引数なし</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果</span>
<span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;export&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;accounting&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT_NAME&quot;</span><span class="token operator">=</span><span class="token string">&quot;personnel&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>引数に<code>jp.co.future.uroborosql.utils.CaseFormat</code>を指定することで、Mapのキー名に対する書式を変更することができます。</p> <p>CaseFormat.PASCAL_CASE指定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">CaseFormat</span><span class="token punctuation">.</span>PASCAL_CASE<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果</span>
<span class="token punctuation">{</span><span class="token string">&quot;DeptNo&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DeptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;DeptNo&quot;</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;DeptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;export&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;DeptNo&quot;</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;DeptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;accounting&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;DeptNo&quot;</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;DeptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;personnel&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p> <p>エンティティクラス</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>jp.co.future.uroborosql.converter.ResultSetConverter</code>インタフェースを実装したクラスを引数に渡すことで、検索結果により複雑な加工を行うことができます。<br> <code>ResultSetConverter</code>は<code>FunctionInterface</code>として提供されているので、<code>lambda式</code>による記述も可能です。</p> <p>ResultSetConverter指定(lambda式)</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ResultSetConverterはlambda式で指定可能</span>
  agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>rs <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> row <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;deptNo&quot;</span><span class="token punctuation">,</span> rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">&quot;DEPT_NO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;deptName&quot;</span><span class="token punctuation">,</span> rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">&quot;DEPT_NAME&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> row<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 結果</span>
<span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;sales&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;export&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;accounting&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;deptNo&quot;</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;deptName&quot;</span><span class="token operator">=</span><span class="token string">&quot;personnel&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">注意</p> <p>戻り値として取得されるStreamインスタンスは内部にResultSetリソースを保持しています。このResultSetはデータを最後まで読み込むか<code>Stream#close()</code>が呼ばれたタイミングでリソースのクローズを行います。(Stream生成時、Stream#onClose()にResultSetリソースの<code>closeHandler</code>を登録します)<br>
そのため、取得したStreamで全データを扱う終端処理(collectなど)を行うか、try-with-resourcesの利用やStream#close()の明示的な呼び出しによるStreamのクローズを行わないとResultSetリソースがクローズされずカーソルのリークが発生します。</p></div> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>取得したStreamのクローズより先にSqlAgentインスタンスがクローズ、または破棄された場合、Streamの内部に保持しているResultSetリソースもクローズされてしまい不正な動作となります。StreamインスタンスとそのStreamを生成したSqlAgentインスタンスの生存期間を合わせる、もしくはSqlAgentインスタンスの生存期間を長くしてください。</p></div> <p>Streamのクローズ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Stream#findFirst() はStream内のResultSetリソースをクローズしないので、try-with-resourcesでStreamをクローズする</span>
    stream<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="resultset取得-sqlquery-resultset"><a href="#resultset取得-sqlquery-resultset" class="header-anchor">#</a> ResultSet取得(<code>SqlQuery#resultSet</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlQuery#resultSet()</td> <td style="text-align:left;">ResulitSet</td></tr></tbody></table> <p>検索結果を<code>java.sql.ResultSet</code>の形式で取得します。</p> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>ResultSetリソースのクローズは各自で行う必要があります。</p></div> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>ResultSetリソースのクローズより先にSqlAgentインスタンスがクローズ、または破棄された場合、ResultSetリソースもクローズされてしまい不正な動作となります。ResultSetリソースとそのResultSetを生成したSqlAgentインスタンスの生存期間を合わせる、もしくはSqlAgentインスタンスの生存期間を長くしてください。</p></div> <p>このAPIは他のフレームワークとの連携など、<code>ResultSet</code>リソースの取得が必要なケースを想定して提供しています。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>ResultSet</code>リソースの取得が必要でなければ、<code>ResultSet</code>リソースのクローズが管理されている他のAPIの利用を検討してください。</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// try-with-resourcesでResultSetをクローズする</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ResultSetからの値取得</span>
      ・・・
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="sqlによる更新-sqlagent-update-updatewith"><a href="#sqlによる更新-sqlagent-update-updatewith" class="header-anchor">#</a> SQLによる更新(<code>SqlAgent#update</code> /<code>#updateWith</code>)</h2> <p>DB更新処理(登録/変更/削除)やDDLの実行も検索処理と同様<code>SQL名</code>を指定する場合と<code>SQL文字列</code>を指定する２つのAPIが提供されています。</p> <table><thead><tr><th style="text-align:left;">利用メソッド</th> <th style="text-align:left;">説明</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlAgent#update(&quot;[SQL名]&quot;)</td> <td style="text-align:left;"><a href="/uroborosql-doc/basics/#sql名">SQL名</a>で説明した<code>SQL名</code>を指定</td></tr> <tr><td style="text-align:left;">SqlAgent#updateWith(&quot;[SQL文字列]&quot;)</td> <td style="text-align:left;"><code>SQL文字列</code>を直接指定</td></tr></tbody></table> <p>上記２つのメソッドは更新を行うための<code>SqlUpdate</code>インタフェースのインスタンスを返却します。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// １件挿入(SQL名指定)</span>
<span class="token keyword">int</span> count <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;department/insert_department&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;dept_no&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;dept_name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sales&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 更新(SQL文字列指定)</span>
<span class="token keyword">int</span> count <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">updateWith</span><span class="token punctuation">(</span><span class="token string">&quot;update employee set first_name = /*first_name*/ where emp_no = /*emp_no*/&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;emp_no&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;first_name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>department/insert_department.sql</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token comment">/* _SQL_ID_ */</span>
<span class="token keyword">into</span>
  department
<span class="token punctuation">(</span>
  dept_name
<span class="token punctuation">,</span> lock_version
<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>
  <span class="token comment">/*dept_name*/</span><span class="token string">'sample'</span>
<span class="token punctuation">,</span>  <span class="token number">0</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>SqlUpdate</code>インタフェースの主なAPIは以下になります。</p> <h3 id="更新の実行-sqlupdate-count"><a href="#更新の実行-sqlupdate-count" class="header-anchor">#</a> 更新の実行(<code>SqlUpdate#count</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlUpdate#count()</td> <td style="text-align:left;">int</td></tr></tbody></table> <p>更新処理を行い、登録、更新、削除を行った行数を返します。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// insert</span>
  agent<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;department/insert_department&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;dept_no&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;dept_name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sales&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// update</span>
  agent<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;department/update_department&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;dept_no&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;dept_name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HR&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// delete</span>
  agent<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;department/delete_department&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;dept_no&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="sqlによるバッチ更新-sqlbatch-batch-batchwith"><a href="#sqlによるバッチ更新-sqlbatch-batch-batchwith" class="header-anchor">#</a> SQLによるバッチ更新(<code>SqlBatch#batch</code> /<code>#batchWith</code>)</h2> <p>大量のデータを一括で更新する場合、通常の更新ではSQLが都度実行されるため処理速度が遅く問題になる場合があります。<br>
こういったケースに対応するため、<strong>uroboroSQL</strong>ではバッチ更新用のAPIを提供しています。</p> <p>バッチ更新処理も他と同様<code>SQL名</code>を指定する場合と<code>SQL文字列</code>を直接記述する２つのAPIが提供されています。</p> <table><thead><tr><th style="text-align:left;">利用メソッド</th> <th style="text-align:left;">説明</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlAgent#batch(&quot;[SQL名]&quot;)</td> <td style="text-align:left;"><a href="/uroborosql-doc/basics/#sql名">SQL名</a>で説明した<code>SQL名</code>を指定</td></tr> <tr><td style="text-align:left;">SqlAgent#batchWith(&quot;[SQL文字列]&quot;)</td> <td style="text-align:left;"><code>SQL文字列</code>を直接指定</td></tr></tbody></table> <p>上記２つのメソッドはバッチ更新を行うための<code>SqlBatch</code>インタフェースのインスタンスを返却します。</p> <p><code>SqlBatch</code>インタフェースでは、<code>SqlFluent</code>インタフェースによるバインドパラメータの設定とは別に<code>java.util.stream.Stream</code>を用いたバッチパラメータの設定を行うAPIが提供されています。</p> <table><thead><tr><th style="text-align:left;">メソッド</th> <th style="text-align:left;">説明</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlBatch#paramStream(Stream&lt;Map&lt;String, Object&gt;&gt;)</td> <td style="text-align:left;">バインドパラメータや置換文字列として使用するキーと値のセットを<code>java.util.stream.Stream</code>で設定する。<span class="badge tip" style="vertical-align:top;" data-v-15b7b770>0.5.0+</span></td></tr> <tr><td style="text-align:left;">SqlBatch#paramStream(Stream&lt;E&gt;)</td> <td style="text-align:left;">バインドパラメータや置換文字列として使用するエンティティクラスインスタンスを<code>java.util.stream.Stream</code>で設定する。<span class="badge tip" style="vertical-align:top;" data-v-15b7b770>0.10.0+</span></td></tr></tbody></table> <h3 id="バッチ更新の実行-sqlbatch-count"><a href="#バッチ更新の実行-sqlbatch-count" class="header-anchor">#</a> バッチ更新の実行(<code>SqlBatch#count</code>)</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlBatch#count()</td> <td style="text-align:left;">int</td></tr></tbody></table> <p>バッチ更新処理を行い、登録、更新、削除を行った行数を返します。</p> <p>バッチ更新</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// バッチ処理の実行</span>
<span class="token keyword">int</span> count <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span><span class="token string">&quot;department/insert_department&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">// 指定したファイルからMap&lt;String, Object&gt;のStreamを生成し、バッチ処理のパラメータとして指定する</span>
  <span class="token punctuation">.</span><span class="token function">paramStream</span><span class="token punctuation">(</span><span class="token function">getDataByFile</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;data/department.tsv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

・・・

<span class="token keyword">private</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDataByFile</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Path</span> filePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readAllLines</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> header <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> lines<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> header<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>row<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>header<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Map</span><span class="token operator">::</span><span class="token function">putAll</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UncheckedIOException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>data/department.tsv　の内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>dept_no  dept_name
1  sales
2  export
3  accounting
4  personnel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>paramStream()</code>メソッドに<code>SqlQuery#stream()</code>の結果を指定することで疑似的に<code>SELECT-INSERT</code> / <code>SELECT-UPDATE</code> / <code>SELECT-DELETE</code>を行うことができます。<br>
Stream APIを利用することで検索結果の件数が多い場合でも、少ないメモリ使用量でバッチ処理を行うことができます。</p> <p>SELECT-UPDATE</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> updateCount <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span><span class="token string">&quot;department/update_department&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">paramStream</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;department/select_department&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">CaseFormat</span><span class="token punctuation">.</span>LOWER_SNAKE_CASE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
      <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> ans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ans<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> v <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> v<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;_after&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;after&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取得した検索結果の各行の値に &quot;_after&quot; を付与する</span>
      <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="バッチsql実行動作のカスタマイズ"><a href="#バッチsql実行動作のカスタマイズ" class="header-anchor">#</a> バッチSQL実行動作のカスタマイズ</h3> <p><code>SqlBatch</code>インタフェースにはバッチSQL実行時の動作を変更するためのAPIが提供されています。</p> <table><thead><tr><th style="text-align:left;">メソッド</th> <th style="text-align:left;">説明</th> <th style="text-align:left;">デフォルト値</th></tr></thead> <tbody><tr><td style="text-align:left;">by(BiPredicate&lt;SqlContext, Map&lt;String, Object&gt;&gt;)</td> <td style="text-align:left;">バッチSQLの実行条件を指定します。<code>BiPredicate</code>の結果がtrueの場合にバッチSQLを実行します。</td> <td style="text-align:left;">1000件毎</td></tr> <tr><td style="text-align:left;">batchWhen(BiConsumer&lt;SqlAgent, SqlContext&gt;)</td> <td style="text-align:left;">バッチSQLの実行タイミングで行う操作を指定します。</td> <td style="text-align:left;">何もしない</td></tr> <tr><td style="text-align:left;">errorWhen(TriConsumer&lt;SqlAgent, SqlContext, Exception&gt;)</td> <td style="text-align:left;">バッチSQLの実行時に例外が発生した時の動作を指定します。</td> <td style="text-align:left;"><code>UroborosqlRuntimeException</code>をスローする</td></tr></tbody></table> <p>これらのAPIを利用することでより柔軟なSQL実行が可能になります。</p> <p>バッチSQL実行時動作のカスタマイズ例</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> inputData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 中略　入力データ作成</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlAgent</span> agent <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  agent<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span><span class="token string">&quot;department/insert_department&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">paramStream</span><span class="token punctuation">(</span>inputData<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> row<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">batchCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">// 10件毎にSQL実行</span>
    <span class="token punctuation">.</span><span class="token function">batchWhen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>agent<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> agent<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// SQL実行が成功したらコミットする</span>
    <span class="token punctuation">.</span><span class="token function">errorWhen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>agent<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> ex<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;error occured. ex:{}&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 例外が発生したらログ出力する</span>
    <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="ストアドプロシージャの実行-sqlagent-proc-procwith"><a href="#ストアドプロシージャの実行-sqlagent-proc-procwith" class="header-anchor">#</a> ストアドプロシージャの実行(<code>SqlAgent#proc</code> /<code>#procWith</code>)</h2> <p><strong>uroboroSQL</strong>では、SQLの検索/更新のほかDBが提供するストアドプロシージャの呼び出し用APIも提供しています。</p> <table><thead><tr><th style="text-align:left;">利用メソッド</th> <th style="text-align:left;">説明</th></tr></thead> <tbody><tr><td style="text-align:left;">SqlAgent#proc(&quot;[SQL名]&quot;)</td> <td style="text-align:left;"><a href="/uroborosql-doc/basics/#sql名">SQL名</a>で説明した<code>SQL名</code>を指定</td></tr> <tr><td style="text-align:left;">SqlAgent#procWith(&quot;[SQL文字列]&quot;)</td> <td style="text-align:left;"><code>SQL文字列</code>を直接指定</td></tr></tbody></table> <p>上記２つのメソッドはストアドプロシージャの呼出を行うための<code>Procedure</code>インタフェースのインスタンスを返却します。</p> <h3 id="procedureインタフェース"><a href="#procedureインタフェース" class="header-anchor">#</a> <code>Procedure</code>インタフェース</h3> <table><thead><tr><th style="text-align:left;">メソッド名</th> <th style="text-align:left;">戻り値の型</th></tr></thead> <tbody><tr><td style="text-align:left;">Procedure#call()</td> <td style="text-align:left;">Map&lt;String, Object&gt;</td></tr></tbody></table> <p><code>Procedure</code>インタフェースでは、ストアドプロシージャからの戻り値を取得するためのAPIが提供されています。</p> <table><thead><tr><th style="text-align:left;">メソッド</th> <th style="text-align:left;">説明</th></tr></thead> <tbody><tr><td style="text-align:left;">ProcedureFluent#outParam(String, int)</td> <td style="text-align:left;">ストアドプロシージャからの戻り値として受け取るパラメータを指定します<br>実行したストアドプロシージャ内で指定したキーに設定された値が、戻り値の<code>Map&lt;String, Object&gt;</code>に格納されて取得できます。第2引数で受け取る値の型をint型で指定します</td></tr> <tr><td style="text-align:left;">ProcedureFluent#outParam(String, SQLType)</td> <td style="text-align:left;">ストアドプロシージャからの戻り値として受け取るパラメータを指定します<br>実行したストアドプロシージャ内で指定したキーに設定された値が、戻り値の<code>Map&lt;String, Object&gt;</code>に格納されて取得できます。第2引数で受け取る値の型をSQLType型で指定します</td></tr> <tr><td style="text-align:left;">ProcedureFluent#inOutParam(String, int)</td> <td style="text-align:left;">ストアドプロシージャに渡し、かつ、戻り値として受け取るパラメータを指定します<br>実行したストアドプロシージャ内で指定したキーに設定された値が、戻り値の<code>Map&lt;String, Object&gt;</code>に格納されて取得できます。第2引数で受け取る値の型をint型で指定します</td></tr> <tr><td style="text-align:left;">ProcedureFluent#inOutParam(String, SQLType)</td> <td style="text-align:left;">ストアドプロシージャに渡し、かつ、戻り値として受け取るパラメータを指定します<br>実行したストアドプロシージャ内で指定したキーに設定された値が、戻り値の<code>Map&lt;String, Object&gt;</code>に格納されて取得できます。第2引数で受け取る値の型をSQLType型で指定します</td></tr> <tr><td style="text-align:left;">ProcedureFluent#inOutParamIfAbsent(String, int)</td> <td style="text-align:left;">ストアドプロシージャに渡し、かつ、戻り値として受け取るパラメータを指定します<br>指定したパラメータ名のパラメータが事前に登録されていない場合に値を追加します<br>実行したストアドプロシージャ内で指定したキーに設定された値が、戻り値の<code>Map&lt;String, Object&gt;</code>に格納されて取得できます。第2引数で受け取る値の型をint型で指定します</td></tr> <tr><td style="text-align:left;">ProcedureFluent#inOutParamIfAbsent(String, SQLType)</td> <td style="text-align:left;">ストアドプロシージャに渡し、かつ、戻り値として受け取るパラメータを指定します<br>指定したパラメータ名のパラメータが事前に登録されていない場合に値を追加します<br>実行したストアドプロシージャ内で指定したキーに設定された値が、戻り値の<code>Map&lt;String, Object&gt;</code>に格納されて取得できます。第2引数で受け取る値の型をSQLType型で指定します</td></tr></tbody></table> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Procedureインタフェースのインスタンスを取得</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> agent<span class="token punctuation">.</span><span class="token function">procWith</span><span class="token punctuation">(</span><span class="token string">&quot;{call product_id_exist_check(/*product_id*/, /*check_out*/)}&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;product_id&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">outParam</span><span class="token punctuation">(</span><span class="token string">&quot;check_out&quot;</span><span class="token punctuation">,</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span><span class="token class-name">JDBCType</span><span class="token punctuation">.</span>NUMERIC<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// outParamメソッドで指定したパラメータの値(戻り値)を取得</span>
<span class="token class-name">BigDecimal</span> checkOut <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token punctuation">)</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;check_out&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/future-architect/uroborosql-doc/edit/master/src/basics/sql-file-api.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020-3-8 21:44:34</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/uroborosql-doc/basics/" class="prev router-link-active">
        事前準備
      </a></span> <span class="next"><a href="/uroborosql-doc/basics/entity-api.html">
        DAOインタフェース
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/uroborosql-doc/assets/js/app.fc355632.js" defer></script><script src="/uroborosql-doc/assets/js/2.e1a5c61f.js" defer></script><script src="/uroborosql-doc/assets/js/17.b992cbad.js" defer></script><script src="/uroborosql-doc/assets/js/4.93701c86.js" defer></script>
  </body>
</html>
