(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{66:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"事前準備"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事前準備","aria-hidden":"true"}},[t._v("#")]),t._v(" 事前準備")]),t._v(" "),s("p",[s("strong",[t._v("uroboroSQL")]),t._v("を利用した基本的なDB操作を説明します。")]),t._v(" "),s("h2",{attrs:{id:"db接続"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#db接続","aria-hidden":"true"}},[t._v("#")]),t._v(" DB接続")]),t._v(" "),s("p",[t._v("まず最初にSQLを実行するDBへの接続を行います。"),s("br"),t._v("\nDBに接続するためには"),s("code",[t._v("SqlConfig")]),t._v("インタフェースのインスタンスを生成する必要があります。")]),t._v(" "),s("p",[s("code",[t._v("SqlConfig")]),t._v("インスタンスは"),s("code",[t._v("UroboroSQL")]),t._v("クラスのビルダーメソッドを使用して生成します。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// JDBC接続を行うSqlConfigの生成")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SqlConfig config = UroboroSQL.builder(url, user, password).build();")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlConfig")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UroboroSQL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jdbc:h2:mem:uroborosql"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sa"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DataSourceを使用したDB接続を行うSqlConfigの生成")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SqlConfig config = UroboroSQL.builder(datasource).build();")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InitialContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataSource")]),t._v(" dataSource "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lookup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java:comp/env/jdbc/datasource"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlConfig")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UroboroSQL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[s("code",[t._v("UroboroSQL")]),t._v("クラスを使って"),s("code",[t._v("SqlConfig")]),t._v("インスタンスを生成する際、"),s("strong",[t._v("uroboroSQL")]),t._v("の挙動を変更する各種の設定も合わせて行うことができます。"),s("br"),t._v("\n設定の詳細については"),s("a",{attrs:{href:"../configuration"}},[t._v("設定")]),t._v("を参照してください。")]),t._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",[s("code",[t._v("SqlConfig")]),t._v("インスタンスはアプリケーション内で接続先毎に１つ保持するようにしてください。\nSQL実行の都度生成すると、不要なインスタンスの生成やSQLロード処理が実行されます。")])]),t._v(" "),s("h2",{attrs:{id:"sqlagentインスタンスの取得"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sqlagentインスタンスの取得","aria-hidden":"true"}},[t._v("#")]),t._v(" SqlAgentインスタンスの取得")]),t._v(" "),s("p",[t._v("次にすべての操作の基点となる"),s("code",[t._v("SqlAgent")]),t._v("インタフェースのインスタンスを取得します。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlAgent")]),t._v(" agent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("agent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// この中でSQLの操作を行う")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("SQLの操作はすべてこの"),s("code",[t._v("SqlAgent")]),t._v("インスタンスを使って行うことになります。")]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[s("code",[t._v("SqlAgent")]),t._v("インタフェースは"),s("code",[t._v("java.lang.AutoClosable")]),t._v("インタフェースを実装しており、"),s("code",[t._v("try-with-resources")]),t._v("で記述することで終了時に自動的にclose処理が呼び出され、中で保持しているConnectionやPreparedStatementなどのリソースオブジェクトも正しくクローズされます。")])]),t._v(" "),s("h2",{attrs:{id:"sqlファイルの配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sqlファイルの配置","aria-hidden":"true"}},[t._v("#")]),t._v(" SQLファイルの配置")]),t._v(" "),s("p",[s("strong",[t._v("uroboroSQL")]),t._v("ではSQL文の書かれたファイルのパスを指定してSQLを実行することができます。"),s("br"),t._v("\nその際、SQLファイルはクラスパスから参照できる場所に配置されている必要があります。")]),t._v(" "),s("div",{staticClass:"language-md line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-md"}},[s("code",[t._v("src\n    └─main\n        └─resources\n            └─sql\n                ├─department\n                │    ├─insert"),s("span",{pre:!0,attrs:{class:"token italic"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token content"}},[t._v("department.sql\n                │    └─select")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("_")])]),t._v("department.sql\n                └─employee\n                     ├─insert"),s("span",{pre:!0,attrs:{class:"token italic"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token content"}},[t._v("employee.sql\n                     └─select")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("_")])]),t._v("employee.sql\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("上のようなフォルダ構成の場合で、"),s("code",[t._v("src/main/resources/")]),t._v("をクラスパスに指定すれば、\nその下の"),s("code",[t._v("sql")]),t._v("フォルダをルートフォルダとした相対パスでSQLファイルを指定することができます。")]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("SQLファイルのルートフォルダ（初期値："),s("code",[t._v("sql")]),t._v(")は変更することができます。"),s("br"),t._v("\n変更方法の詳細は "),s("router-link",{attrs:{to:"/configuration/sql-manager.html#sqlファイルルートフォルダの設定"}},[t._v("SQLファイルルートフォルダの設定")]),t._v(" を参照してください。")],1)]),t._v(" "),s("h3",{attrs:{id:"sql名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sql名","aria-hidden":"true"}},[t._v("#")]),t._v(" SQL名")]),t._v(" "),s("p",[t._v("SQLファイルの指定する際のファイルパスを"),s("code",[t._v("SQL名")]),t._v("といいます。"),s("br"),t._v("\n上記フォルダ構成の場合、それぞれのSQLファイルは以下のような"),s("code",[t._v("SQL名")]),t._v("となります。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("SQLファイルパス（SQLルートフォルダから）")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("SQL名")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("department/insert_department.sql")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("department/insert_department")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("department/select_department.sql")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("department/select_department")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("employee/insert_employee.sql")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("employee/insert_employee")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("employee/select_employee.sql")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("employee/select_employee")])])])]),t._v(" "),s("p",[t._v("SQLファイルの配置は設定によりカスタマイズが可能です。SQLファイル配置のカスタマイズについては "),s("router-link",{attrs:{to:"/advanced/#sqlファイルの解決ルール"}},[t._v("SQLファイルの解決ルール")]),t._v(" を参照してください。")],1),t._v(" "),s("h3",{attrs:{id:"共通api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#共通api","aria-hidden":"true"}},[t._v("#")]),t._v(" 共通API")]),t._v(" "),s("p",[t._v("検索("),s("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/fluent/SqlQuery.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("SqlQuery"),s("OutboundLink")],1),t._v(")、更新("),s("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/fluent/SqlUpdate.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("SqlUpdate"),s("OutboundLink")],1),t._v(")、バッチ更新("),s("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/fluent/SqlBatch.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("SqlBatch"),s("OutboundLink")],1),t._v(")、プロシージャ実行("),s("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/fluent/Procedure.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("Procedure"),s("OutboundLink")],1),t._v(")を行うクラスは、バインドパラメータや置換文字列の設定を行うためのAPI("),s("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/fluent/SqlFluent.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("SqlFluent"),s("OutboundLink")],1),t._v(")を実装しています。")]),t._v(" "),s("p",[t._v("バインドパラメータや置換文字列の設定はこのAPIを利用して設定を行ってください。"),s("br"),t._v("\n流れるAPI(Fluent API)を採用しているため、値の設定は連続して行うことができるようになっています。")]),t._v(" "),s("p",[t._v("パラメータ設定例")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" department "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" agent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"department/select_department"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dept_no"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dept_name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sales"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("first")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("主なメソッド")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("説明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("SqlFluent#param(String key, Object value)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("バインドパラメータや置換文字列として使用するキーと値のセットを設定する")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("SqlFluent#param(String key, Supplier<Object> supplier)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("supplierの評価結果をキーの値としてパラメータに設定する "),s("Badge",{attrs:{text:"0.10.1+"}})],1)]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("SqlFluent#paramList(String key, Object... value)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("IN句のバインドパラメータに使用するキーと値のセットを設定する")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("SqlFluent#paramMap(Map<String, ?> paramMap)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("引数のMapのKey/Valueのセットをパラメータに設定する")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("SqlFluent#paramBean(Object bean)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("引数として渡されたObjectのフィールド名と値のセットをパラメータに設定する")])])])]),t._v(" "),s("p",[t._v("他にもパラメータの型に応じたパラメータ設定メソッドが提供されています。")])])},[],!1,null,null,null);a.default=n.exports}}]);