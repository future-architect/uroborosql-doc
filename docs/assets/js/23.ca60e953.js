(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{67:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"sqlfiltermanager"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sqlfiltermanager","aria-hidden":"true"}},[t._v("#")]),t._v(" SqlFilterManager")]),t._v(" "),s("h2",{attrs:{id:"sqlフィルター"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sqlフィルター","aria-hidden":"true"}},[t._v("#")]),t._v(" SQLフィルター")]),t._v(" "),s("p",[s("strong",[t._v("uroboroSQL")]),t._v("ではSQLの実行を行う一連の処理の流れの中にいくつかの拡張ポイントを設けており、この拡張ポイントに処理を追加することで、共通的なSQL文の加工や検索結果の記録といった様々な拡張を行うことができるように設計されています。")]),t._v(" "),s("p",[t._v("SQL処理の拡張はSqlFilterインタフェースを実装したクラスを作成し登録することで行います。"),s("br"),t._v("\nSqlFilterインタフェースには以下のメソッドが定義されています。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("SqlFilterメソッド名")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("説明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("initialize")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("SqlFilterの初期化を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doTransformSql")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("変換前のSQLに対して加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doParameter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("バインドパラメータの加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doOutParameter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("ストアドプロシージャのOutParameterの加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doPreparedStatement")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("PreparedStatementの加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doCallableStatement")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("CallableStatementの加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doQuery")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("検索処理結果の加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doUpdate")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("更新処理結果の加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doBatch")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("バッチ処理結果の加工を行う")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("doProcedure")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Procedure呼出処理結果の加工を行う")])])])]),t._v(" "),s("p",[s("strong",[t._v("uroboroSQL")]),t._v("には標準でいくつかのSqlFilterの実装が含まれています。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("クラス名")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("説明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("jp.co.future.uroborosql.filter.DebugSqlFilter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("SqlFilterの動作を理解するためのサンプル。各拡張ポイントで呼び出されるメソッドでログを出力します。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("jp.co.future.uroborosql.filter.DumpResultSqlFilter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("検索結果を表形式でログ出力するSQLフィルター。SqlREPLで使用しています。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("jp.co.future.uroborosql.filter.WrapContextSqlFilter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("SQL文の前後に文字列を追加するSQLフィルター。ページングや検索件数の上限設定に使用します。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("jp.co.future.uroborosql.filter.SecretColumnSqlFilter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("指定した特定のカラムのみ暗号化を行うSQLフィルター。パスワードや機密情報を暗号化してDBに格納するために使用します。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("jp.co.future.uroborosql.filter.AuditLogSqlFilter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("監査記録を取得するためのSQLフィルター。")])])])]),t._v(" "),s("p",[t._v("SQLフィルターを利用するためには、SqlConfig生成時にSqlFilterManagerの設定を追加して利用するSQLフィルターの登録を行ってください。"),s("br"),t._v("\nSQLフィルターは複数登録することができます。複数登録した場合は登録した順にSQLフィルターが処理されます。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create SqlConfig")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlConfig")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UroboroSQL")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SqlFilterManagerの設定")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSqlFilterManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlFilterManagerImpl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DumpResultSqlFilterの登録")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSqlFilter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DumpResultSqlFilter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WrapContextSqlFilterの登録")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSqlFilter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WrapContextSqlFilter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LIMIT /*$maxRowCount*/10 OFFSET /*$startRowIndex*/0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('".*FOR\\\\sUPDATE.*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[t._v("独自にSqlFilterを作成する場合は、"),s("code",[t._v("jp.co.future.uroborosql.filter.AbstractSqlFilter")]),t._v("を継承し、必要に応じてメソッドをオーバーライドしてください。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomSqlFilter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSqlFilter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 途中略")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResultSet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doQuery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlContext")]),t._v(" sqlContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PreparedStatement")]),t._v(" preparedStatement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResultSet")]),t._v(" resultSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// フィルター処理の実装")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])])])},[],!1,null,null,null);a.default=n.exports}}]);