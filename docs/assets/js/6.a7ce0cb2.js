(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{37:function(t,s,a){t.exports=a.p+"assets/img/erd.5706ef62.png"},64:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"sqlファイルを使用したdbアクセス"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlファイルを使用したdbアクセス","aria-hidden":"true"}},[t._v("#")]),t._v(" SQLファイルを使用したDBアクセス")]),t._v(" "),n("h2",{attrs:{id:"sqlconfigの生成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlconfigの生成","aria-hidden":"true"}},[t._v("#")]),t._v(" SqlConfigの生成")]),t._v(" "),n("p",[t._v("SQLファイルを使用したサンプルコード "),n("a",{attrs:{href:"https://github.com/future-architect/uroborosql-sample/blob/master/src/main/java/jp/co/future/uroborosql/sample/SqlFileApiSample.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("SqlFileApiSample.java"),n("OutboundLink")],1),t._v(" を例として説明します。")]),t._v(" "),n("p",[t._v("まず初めにコンストラクタの中で最初に"),n("code",[t._v("SqlConfig")]),t._v("クラスを作成しています。\n"),n("code",[t._v("SqlConfig")]),t._v("は"),n("strong",[t._v("uroboroSQL")]),t._v("に対する各種の設定を保持するクラスで、"),n("code",[t._v("SqlConfig")]),t._v("の設定を変更することで"),n("strong",[t._v("uroboroSQL")]),t._v("の動作を変更することが出来ます。"),n("br"),t._v("\nここでは"),n("a",{attrs:{href:"http://www.h2database.com/html/main.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("H2DB"),n("OutboundLink")],1),t._v("のメモリDBに接続する"),n("code",[t._v("SqlConfig")]),t._v("インスタンスを生成しています。\n"),n("code",[t._v("SqlConfig")]),t._v("の生成には"),n("code",[t._v("UroboroSQL")]),t._v("クラスによるBuilderAPIを使用します。")]),t._v(" "),n("ul",[n("li",[t._v("基本的な呼出方法（DBへの接続情報のみ指定）")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create SqlConfig")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlConfig")]),t._v(" config "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UroboroSQL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jdbc:h2:mem:test;DB_CLOSE_DELAY=-1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("ul",[n("li",[t._v("設定のカスタマイズ（定数の指定や検索結果の取得方法変更）")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create SqlConfig")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlConfig")]),t._v(" config "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UroboroSQL")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jdbc:h2:mem:test;DB_CLOSE_DELAY=-1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SqlContextFactoryの設定（Enum定数パッケージ設定の追加）")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSqlContextFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlContextFactoryImpl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEnumConstantPackageNames")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Arrays")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("asList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gender")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPackage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SqlAgentFactoryの設定（Queryの戻り値のMapのキー文字列のデフォルトCaseFormat設定の追加）")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSqlAgentFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlAgentFactoryImpl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDefaultMapKeyCaseFormat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CaseFormat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CAMEL_CASE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SqlManagerの設定（NioSqlManagerImplの指定）")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSqlManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NioSqlManagerImpl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("p",[n("code",[t._v("SqlConfig")]),t._v("生成時のカスタマイズの詳細については "),n("a",{attrs:{href:"../configuration"}},[t._v("設定")]),t._v("を参照してください。")]),t._v(" "),n("h2",{attrs:{id:"テーブルの作成と初期データの登録"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#テーブルの作成と初期データの登録","aria-hidden":"true"}},[t._v("#")]),t._v(" テーブルの作成と初期データの登録")]),t._v(" "),n("p",[t._v("次に事前準備として以降の処理で使用するテーブルの作成と初期データの登録を行います。（"),n("code",[t._v("SqlFileApiSample#setupTableAndData()")]),t._v("を参照）"),n("br"),t._v("\nSQLを実行する場合は"),n("code",[t._v("SqlConfig")]),t._v("から"),n("code",[t._v("SqlAgent")]),t._v("を生成します。\n"),n("code",[t._v("SqlAgent")]),t._v("は"),n("strong",[t._v("uroboroSQL")]),t._v("の中核となるクラスで、"),n("strong",[t._v("uroboroSQL")]),t._v("の各操作はこの"),n("code",[t._v("SqlAgent")]),t._v("を使って行います。"),n("br"),t._v(" "),n("code",[t._v("SqlAgent")]),t._v("は"),n("code",[t._v("AutoClosable")]),t._v("インタフェースを実装しているので、try-with-resources文で囲むことで処理終了時に自動でクローズされます。\nこのとき"),n("code",[t._v("SqlAgent")]),t._v("の中に保持する"),n("code",[t._v("Connection")]),t._v("や"),n("code",[t._v("Statement")]),t._v("も合わせてクローズされるため、クローズ漏れによるメモリリークを防ぐことができます。")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create SqlAgent. SqlAgent implements AutoClosable.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlAgent")]),t._v(" agent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("agent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ここにSQL実行の処理を実装する")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("div",{staticClass:"tip custom-block"},[n("p",[t._v("以降の説明では"),n("code",[t._v("SqlAgent")]),t._v("に対する処理はtry-with-resources文の中で行っているものとします。")])]),t._v(" "),n("p",[n("strong",[t._v("uroboroSQL")]),t._v("では実行するSQLをファイルパスに似た表現（以降 "),n("em",[t._v("SQL名")]),t._v(" と呼ぶ）で指定します。\n下の例ではクラスパス上にあるsqlフォルダ配下のddl/create_tables.sqlを指定してSQL更新処理を実行します。")]),t._v(" "),n("p",[t._v("更新処理を行う場合、"),n("code",[t._v('SqlAgent#update("[SQL名]")')]),t._v("メソッドを使用して"),n("strong",[t._v("SqlUpdate")]),t._v("を取得しUpdateの実行を行います。")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create table :  テーブル作成")]),t._v("\nagent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ddl/create_tables"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setup data : 初期データ挿入")]),t._v("\nagent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setup/insert_data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("ddl/create_tables.sqlで作成したテーブルの構成は以下になります。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(37),alt:"テーブル構成"}})]),t._v(" "),n("h2",{attrs:{id:"sqlファイルを使用した検索"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlファイルを使用した検索","aria-hidden":"true"}},[t._v("#")]),t._v(" SQLファイルを使用した検索")]),t._v(" "),n("p",[t._v("登録したデータを検索します。検索を行う際は、"),n("code",[t._v('SqlAgent#query("[SQL名]")')]),t._v("メソッドを使用して"),n("strong",[t._v("SqlQuery")]),t._v("を取得し、バインドパラメータの設定や検索の実行を行います。")]),t._v(" "),n("p",[n("strong",[t._v("SqlQuery")]),t._v("では検索結果をいくつかの形式で取得することができます。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("メソッド")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("説明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("SqlQuery#collect()")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("検索結果を"),n("code",[t._v("List<Map>")]),t._v("の形式で取得する")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("SqlQuery#stream()")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("検索結果を"),n("code",[t._v("java.util.Stream")]),t._v("の形式で取得する")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("SqlQuery#resultSet()")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("検索結果の"),n("code",[t._v("ResultSet")]),t._v("を取得する")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("SqlQuery#first()")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("検索結果の１件目を取得する。取得できない場合は"),n("code",[t._v("RuntimeException")]),t._v("がスローされる")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("SqlQuery#findFirst()")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("検索結果の１件目を取得する。戻り値は"),n("code",[t._v("Optional")])])])])]),t._v(" "),n("p",[t._v("以下のように呼び出します。")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// no parameter : バインドパラメータ指定なしで検索")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" deps1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" agent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"department/select_department"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("collect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// add bind parameter : バインドパラメータを設定して検索")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" deps2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" agent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"department/select_department"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deptNo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("collect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("p",[t._v("ここで実行されるSQLは以下のようになっています。")]),t._v(" "),n("ul",[n("li",[t._v("department/select_department.sql")])]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* _SQL_ID_ */")]),t._v("\n    dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dept_no        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v("    dept_no\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dept_name      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v("    dept_name\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock_version   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v("    lock_version\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n    department    dept\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*BEGIN*/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*IF SF.isNotEmpty(deptNo)*/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dept_no    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*deptNo*/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*END*/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*IF SF.isNotEmpty(deptName)*/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dept_name  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*deptName*/")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sample'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*END*/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*END*/")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br")])]),n("ul",[n("li",[n("code",[t._v("/* _SQL_ID_ */")]),t._v(" はSQLを特定するID(SQL_IDといいます)を付与するための予約語で、実行時にSQLファイルを特定するための文字列に変換されます。")]),t._v(" "),n("li",[n("code",[t._v("/*IF*/ ... /*END*/")]),t._v("は条件分岐で、IFの後ろの評価式が"),n("code",[t._v("True")]),t._v("となる場合に"),n("code",[t._v("/*IF*/")]),t._v("と"),n("code",[t._v("/*END*/")]),t._v("で囲まれた部分が出力されます。")]),t._v(" "),n("li",[n("code",[t._v("/*deptNo*/")]),t._v("はバインドパラメータで、実行時に"),n("code",[t._v("?")]),t._v("に変換され、SqlQueryに設定したパラメータがSQLへバインドされます。")]),t._v(" "),n("li",[n("code",[t._v("/*deptNo*/")]),t._v("の後ろの"),n("code",[t._v("1")]),t._v("はテスト用データです。このようにテスト用データをSQL文に記述しておくことで、このSQLを\nSQLクライアントツールで実行する際にエラーにならずに文法の確認を行うことができます。")])]),t._v(" "),n("p",[t._v("SQLで使用できる構文については"),n("router-link",{attrs:{to:"/background/#_2waysql"}},[t._v("2WaySQL")]),t._v("を参照してください。"),n("br"),t._v("\nまた、検索のより詳しい説明は"),n("router-link",{attrs:{to:"/basics/sql-file-api.html#sqlによる検索-sqlagent-query-sqlagent-querywith"}},[t._v("SQLによる検索")]),t._v("を参照してください。")],1),t._v(" "),n("h2",{attrs:{id:"sqlファイルを使用した行挿入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlファイルを使用した行挿入","aria-hidden":"true"}},[t._v("#")]),t._v(" SQLファイルを使用した行挿入")]),t._v(" "),n("p",[t._v("テーブルに対して行挿入を行うことも出来ます。\n行挿入を行う際は、"),n("code",[t._v('SqlAgent#update("[SQL名]")')]),t._v("メソッドを使用して"),n("strong",[t._v("SqlUpdate")]),t._v("を取得し、続けてバインドパラメータの設定やSQLの実行を行います。")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("agent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"department/insert_department"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("param"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deptName"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[t._v("ここで実行されるSQLは以下のようになっています。")]),t._v(" "),n("ul",[n("li",[t._v("department/insert_department.sql")])]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* _SQL_ID_ */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v("\n    department\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    dept_name\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   lock_version\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*deptName*/")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sample'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[n("code",[t._v('SqlAgent#update("[SQL名]")')]),t._v("では実行するSQLの内容によって行挿入の他に行更新や行削除を行うことが出来ます。より詳しい説明は"),n("router-link",{attrs:{to:"/basics/sql-file-api.html#sqlによる更新-sqlagent-update-sqlagent-updatewith"}},[t._v("SQLによる更新")]),t._v("を参照してください。")],1)])},[],!1,null,null,null);s.default=e.exports}}]);