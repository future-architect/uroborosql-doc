(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{61:function(t,e,a){"use strict";a.r(e);var l=a(0),s=Object(l.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"dialect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dialect","aria-hidden":"true"}},[t._v("#")]),t._v(" Dialect")]),t._v(" "),a("p",[t._v("複数のDBを対象とするアプリケーションを作成する場合、DB毎のSQL文法の差異を吸収するため\nアプリケーションで対象DBを判定し実行するSQLファイルを切り替える、といった対応が必要になります。\n"),a("strong",[t._v("uroboroSQL")]),t._v("では、こういったDB毎のSQL文法の差異に対応するため、"),a("code",[t._v("Dialect")]),t._v("という仕組みを提供しています。"),a("br"),t._v(" "),a("code",[t._v("Dialect")]),t._v("は接続したDBから取得できる情報を元に自動で判別される為、通常は変更する必要はありません。")]),t._v(" "),a("p",[t._v("現在、標準で以下のDBに対するDialectが提供されています。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("DB名")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Dialect")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("H2 DB")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/H2Dialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("H2Dialect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Microsoft SQL Server")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/MsSqlDialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("MsSqlDialect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/MySqlDialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("MySqlDialect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Oracle10g以下")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/Oracle10Dialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oracle10Dialect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Oracle11g")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/Oracle11Dialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oracle11Dialect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Oracle12c以上")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/Oracle12Dialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oracle12Dialect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Postgresql")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/PostgresqlDialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgresqlDialect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("その他")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/future-architect/uroborosql/blob/master/src/main/java/jp/co/future/uroborosql/dialect/DefaultDialect.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("DefaultDialect"),a("OutboundLink")],1)])])])]),t._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",[t._v("該当するDBが見つからない場合は"),a("code",[t._v("DefaultDialect")]),t._v("が適用されます")])]),t._v(" "),a("h2",{attrs:{id:"カスタムdialectの登録"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#カスタムdialectの登録","aria-hidden":"true"}},[t._v("#")]),t._v(" カスタムDialectの登録")]),t._v(" "),a("p",[t._v("標準でサポートしている上記のDB以外に接続し、"),a("code",[t._v("DefaultDialect")]),t._v("と違う動作をさせたい場合は、対象のDBに対する"),a("code",[t._v("Dialect")]),t._v("クラスを作成して"),a("strong",[t._v("uroboroSQL")]),t._v("に登録する必要があります。")]),t._v(" "),a("p",[a("code",[t._v("Dialect")]),t._v("の登録には、Javaの "),a("a",{attrs:{href:"https://docs.oracle.com/javase/jp/8/docs/api/java/util/ServiceLoader.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("java.util.ServiceLoader"),a("OutboundLink")],1),t._v("を利用します。")]),t._v(" "),a("p",[t._v("最初に対象のDB（ここではSQLiteとする）に対する"),a("code",[t._v("Dialect")]),t._v("クラスを作成します。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dialect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqliteDialect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractDialect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * コンストラクタ\n   */")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqliteDialect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDatabaseName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SQLite"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 対象DBの製品名を特定するための文字列を返す")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// supportsXXXメソッド、isXXXメソッド、getXXXメソッドを必要に応じて実装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("p",[a("code",[t._v("Dialect")]),t._v("インタフェースで提供すべきメソッドは以下になります。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("メソッド名")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("戻り値")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("説明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("supportsBulkInsert()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("BULK INSERT")]),t._v("をサポートするかどうか")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("supportsLimitClause()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("LIMIT")]),t._v("句をサポートするかどうか")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("supportsNullValuesOrdering()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SELECT句のO"),a("code",[t._v("RDER BY")]),t._v("でNULL値の順序を指定できるか（NULLS FIRST/LAST）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("supportsIdentity()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("データベースのIDカラムを使用したID自動採番をサポートしているか")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("supportsSequence()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("データベースのシーケンスを使用したID自動採番をサポートしているか")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("isRemoveTerminator()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("実行するSQLに記述されている終端文字("),a("code",[t._v(";")]),t._v(")を削除するかどうか")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("isRollbackToSavepointBeforeRetry()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("リトライする前に設定したSavepointまでロールバックするかどうか")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("getSequenceNextValSql(String sequenceName)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("シーケンスを取得するためのSQL文を取得する")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("getLimitClause(long limit, long offset)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("LIMIT")]),t._v("句（と"),a("code",[t._v("OFFSET")]),t._v("句）を取得する")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("getJavaType(JDBCType jdbcType, String jdbcTypeName)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("JavaType")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("引数で渡ってきたJavaTypeを変換したJavaTypeを取得する。（DB固有のJava型変換を行う場合に実装）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("getJavaType(int jdbcType, String jdbcTypeName)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("JavaType")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("引数で渡ってきたJavaTypeを変換したJavaTypeを取得する。（DB固有のJava型変換を行う場合に実装）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("getDatabaseName()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("データベースを判別するための文字列を取得する")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("getDatabaseType()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("データベースの種別を表す名前を取得する")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("getEscapeChar()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("char")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("LIKE")]),t._v("句で指定するエスケープキャラクタを取得する")])])])]),t._v(" "),a("p",[a("code",[t._v("Dialect")]),t._v("インタフェースのデフォルト実装や"),a("code",[t._v("AbstractDialect")]),t._v("クラスを参考に、上記のメソッドのうち変更が必要なメソッドの実装を行ってください。")]),t._v(" "),a("p",[t._v("次に"),a("strong",[t._v("uroboroSQL")]),t._v("を利用するアプリケーションのクラスパス上に以下のファイル名のファイルを作成します。")]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("META-INF\n  └─services\n      └─jp.co.future.uroborosql.dialect.Dialect\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("最後に作成した"),a("code",[t._v("jp.co.future.uroborosql.dialect.Dialect")]),t._v("ファイルの中に作成した"),a("code",[t._v("Dialect")]),t._v("のクラス名（FQDN名）を記述します。")]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("foo.bar.dialect.SqliteDialect\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("アプリケーションで"),a("code",[t._v("jp.co.future.uroborosql.dialect.Dialect")]),t._v("が"),a("code",[t._v("ServiceLoader")]),t._v("経由で読み込まれれば登録した"),a("code",[t._v("SqliteDialect")]),t._v("が利用可能になります。")])])},[],!1,null,null,null);e.default=s.exports}}]);