import{_ as E,C as l,o as i,c as o,j as a,a as n,E as e,a2 as p,b as h,w as t,a3 as d}from"./chunks/framework.DuVu33VI.js";const S=JSON.parse('{"title":"EventListenerHolder と EventSubscriber","description":"","frontmatter":{"head":[["meta",{"name":"og:title","content":"EventListenerHolder"}],["meta",{"name":"og:url","content":"/uroborosql-doc/configuration/event-listener-holder.html"}]]},"headers":[],"relativePath":"configuration/event-listener-holder.md","filePath":"configuration/event-listener-holder.md"}'),b={name:"configuration/event-listener-holder.md"};function c(g,s,u,y,m,A){const k=l("CopyOrDownloadAsMarkdownButtons"),r=l("Mermaid");return i(),o("div",null,[s[2]||(s[2]=a("div",{style:{display:"none"},hidden:"true","aria-hidden":"true"},"Are you an LLM? You can read better optimized documentation at /uroborosql-doc/configuration/event-listener-holder.md for this page in Markdown format",-1)),s[3]||(s[3]=a("h1",{id:"eventlistenerholder-と-eventsubscriber",tabindex:"-1"},[n("EventListenerHolder と EventSubscriber "),a("a",{class:"header-anchor",href:"#eventlistenerholder-と-eventsubscriber","aria-label":'Permalink to "EventListenerHolder と EventSubscriber"'},"​")],-1)),e(k),s[4]||(s[4]=p('<h2 id="概要" tabindex="-1">概要 <a class="header-anchor" href="#概要" aria-label="Permalink to &quot;概要&quot;">​</a></h2><p><strong>uroboroSQL</strong>では、SQL実行時のイベントをリスニングするための仕組みとして、<code>EventListenerHolder</code>と<code>EventSubscriber</code>を提供しています。これらを利用することで、SQL実行前後の処理をフックし、ロギングやメトリクス収集などのクロスカッティングな処理を実装できます。</p><h2 id="eventlistenerholder" tabindex="-1">EventListenerHolder <a class="header-anchor" href="#eventlistenerholder" aria-label="Permalink to &quot;EventListenerHolder&quot;">​</a></h2><p><code>EventListenerHolder</code>は、複数の<code>EventSubscriber</code>を管理するコンテナクラスです。SQL実行時のイベントを登録されたすべてのサブスクライバーに通知します。</p><h3 id="主な機能" tabindex="-1">主な機能 <a class="header-anchor" href="#主な機能" aria-label="Permalink to &quot;主な機能&quot;">​</a></h3><ul><li>イベントサブスクライバーの登録・削除、イベントサブスクライバー一覧の取得</li><li>登録されたすべてのサブスクライバーへのイベント通知</li><li>イベント処理の順序制御</li></ul><h2 id="eventsubscriber" tabindex="-1">EventSubscriber <a class="header-anchor" href="#eventsubscriber" aria-label="Permalink to &quot;EventSubscriber&quot;">​</a></h2><p><code>EventSubscriber</code>は、SQL実行時の各種イベントを受け取るためのインターフェースです。以下のようなイベントをハンドリングできます。</p><h3 id="対応イベント" tabindex="-1">対応イベント <a class="header-anchor" href="#対応イベント" aria-label="Permalink to &quot;対応イベント&quot;">​</a></h3><h4 id="sql実行関連" tabindex="-1">SQL実行関連 <a class="header-anchor" href="#sql実行関連" aria-label="Permalink to &quot;SQL実行関連&quot;">​</a></h4><table tabindex="0"><thead><tr><th>イベント</th><th>説明</th></tr></thead><tbody><tr><td><strong>AfterInitializeExecutionContext</strong></td><td>ExecutionContext初期化後</td></tr><tr><td><strong>BeforeSetParameter</strong></td><td>パラメータ設定前</td></tr><tr><td><strong>BeforeTransformSql</strong></td><td>SQL変換前</td></tr><tr><td><strong>BeforeParseSql</strong></td><td>SQLパース前</td></tr><tr><td><strong>AfterCreatePreparedStatement</strong></td><td>PreparedStatement生成後</td></tr><tr><td><strong>AfterCreateCallableStatement</strong></td><td>CallableStatement生成後</td></tr><tr><td><strong>AfterSqlQuery</strong></td><td>SQLQuery実行後</td></tr><tr><td><strong>AfterSqlUpdate</strong></td><td>SQLUpdate実行後</td></tr><tr><td><strong>AfterSqlBatch</strong></td><td>SQLBatch実行後</td></tr><tr><td><strong>AfterProcedure</strong></td><td>Procedure実行後</td></tr><tr><td><strong>AfterGetOutParameter</strong></td><td>出力パラメータ取得後</td></tr></tbody></table><ul><li>SqlAgent#query/update/batch 実行時イベントの発生順序は以下になります。</li></ul>',12)),(i(),h(d,null,{default:t(()=>[e(r,{id:"mermaid-158",class:"mermaid",graph:"flowchart%20TB%0AAfterInitializeExecutionContext(%22AfterInitializeExecutionContext%3Cbr%3E%EF%BC%88ExecutionContext%E5%88%9D%E6%9C%9F%E5%8C%96%E5%BE%8C%EF%BC%89%22)%0ABeforeSetParameter(%22BeforeSetParameter%3Cbr%3E%EF%BC%88%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E8%A8%AD%E5%AE%9A%E5%89%8D%EF%BC%89%22)%0ABeforeTransformSql(%22BeforeTransformSql%3Cbr%3E%EF%BC%88SQL%E5%A4%89%E6%8F%9B%E5%89%8D%EF%BC%89%22)%0ABeforeParseSql(%22BeforeParseSql%3Cbr%3E%EF%BC%88SQL%E3%83%91%E3%83%BC%E3%82%B9%E5%89%8D%EF%BC%89%22)%0AAfterCreatePreparedStatement(%22AfterCreatePreparedStatement%3Cbr%3E%EF%BC%88PreparedStatement%E7%94%9F%E6%88%90%E5%BE%8C%EF%BC%89%22)%0AAfterSqlQuery(%22AfterSqlQuery%3Cbr%3E%EF%BC%88SQLQuery%E5%AE%9F%E8%A1%8C%E5%BE%8C%EF%BC%89%22)%0AAfterSqlUpdate(%22AfterSqlUpdate%3Cbr%3E%EF%BC%88SQLUpdate%E5%AE%9F%E8%A1%8C%E5%BE%8C%EF%BC%89%22)%0AAfterSqlBatch(%22AfterSqlBatch%3Cbr%3E%EF%BC%88SQLBatch%E5%AE%9F%E8%A1%8C%E5%BE%8C%EF%BC%89%22)%0A%0AAfterInitializeExecutionContext%20--%3E%20BeforeSetParameter%0ABeforeSetParameter%20--%3E%20BeforeTransformSql%0ABeforeTransformSql%20--%3E%20BeforeParseSql%0ABeforeParseSql%20--%3E%20AfterCreatePreparedStatement%0AAfterCreatePreparedStatement%20--%3E%20AfterSqlQuery%0AAfterCreatePreparedStatement%20--%3E%20AfterSqlUpdate%0AAfterCreatePreparedStatement%20--%3E%20AfterSqlBatch%0A%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[n(" Loading... ",-1)])]),_:1})),s[5]||(s[5]=a("ul",null,[a("li",null,"SqlAgent#procedure 実行時イベントの発生順序は以下になります。")],-1)),(i(),h(d,null,{default:t(()=>[e(r,{id:"mermaid-166",class:"mermaid",graph:"flowchart%20TB%0AAfterInitializeExecutionContext(%22AfterInitializeExecutionContext%3Cbr%3E%EF%BC%88ExecutionContext%E5%88%9D%E6%9C%9F%E5%8C%96%E5%BE%8C%EF%BC%89%22)%0ABeforeSetParameter(%22BeforeSetParameter%3Cbr%3E%EF%BC%88%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E8%A8%AD%E5%AE%9A%E5%89%8D%EF%BC%89%22)%0ABeforeTransformSql(%22BeforeTransformSql%3Cbr%3E%EF%BC%88SQL%E5%A4%89%E6%8F%9B%E5%89%8D%EF%BC%89%22)%0ABeforeParseSql(%22BeforeParseSql%3Cbr%3E%EF%BC%88SQL%E3%83%91%E3%83%BC%E3%82%B9%E5%89%8D%EF%BC%89%22)%0AAfterCreateCallableStatement(%22AfterCreateCallableStatement%3Cbr%3E%EF%BC%88CallableStatement%E7%94%9F%E6%88%90%E5%BE%8C%EF%BC%89%22)%0AAfterProcedure(%22AfterProcedure%3Cbr%3E%EF%BC%88Procedure%E5%AE%9F%E8%A1%8C%E5%BE%8C%EF%BC%89%22)%0AAfterGetOutParameter(%22AfterGetOutParameter%3Cbr%3E%EF%BC%88%E5%87%BA%E5%8A%9B%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%8F%96%E5%BE%97%E5%BE%8C%EF%BC%89%22)%0A%0AAfterInitializeExecutionContext%20--%3E%20BeforeSetParameter%0ABeforeSetParameter%20--%3E%20BeforeTransformSql%0ABeforeTransformSql%20--%3E%20BeforeParseSql%0ABeforeParseSql%20--%3E%20AfterCreateCallableStatement%0AAfterCreateCallableStatement%20--%3E%20AfterProcedure%0AAfterProcedure%20--%3E%20AfterGetOutParameter%0A"})]),fallback:t(()=>[...s[1]||(s[1]=[n(" Loading... ",-1)])]),_:1})),s[6]||(s[6]=p(`<h4 id="entity操作関連" tabindex="-1">Entity操作関連 <a class="header-anchor" href="#entity操作関連" aria-label="Permalink to &quot;Entity操作関連&quot;">​</a></h4><table tabindex="0"><thead><tr><th>イベント</th><th>説明</th></tr></thead><tbody><tr><td><strong>BeforeEntityQuery</strong></td><td>EntityQuery実行前</td></tr><tr><td><strong>AfterEntityQuery</strong></td><td>EntityQuery実行後</td></tr><tr><td><strong>BeforeEntityInsert</strong></td><td>EntityInsert実行前</td></tr><tr><td><strong>AfterEntityInsert</strong></td><td>EntityInsert実行後</td></tr><tr><td><strong>BeforeEntityUpdate</strong></td><td>EntityUpdate実行前</td></tr><tr><td><strong>AfterEntityUpdate</strong></td><td>EntityUpdate実行後</td></tr><tr><td><strong>BeforeEntityDelete</strong></td><td>EntityDelete実行前</td></tr><tr><td><strong>AfterEntityDelete</strong></td><td>EntityDelete実行後</td></tr><tr><td><strong>BeforeEntityBatchInsert</strong></td><td>EntityBatchInsert実行前</td></tr><tr><td><strong>AfterEntityBatchInsert</strong></td><td>EntityBatchInsert実行後</td></tr><tr><td><strong>BeforeEntityBatchUpdate</strong></td><td>EntityBatchUpdate実行前</td></tr><tr><td><strong>AfterEntityBatchUpdate</strong></td><td>EntityBatchUpdate実行後</td></tr><tr><td><strong>BeforeEntityBulkInsert</strong></td><td>EntityBulkInsert実行前</td></tr><tr><td><strong>AfterEntityBulkInsert</strong></td><td>EntityBulkInsert実行後</td></tr></tbody></table><h4 id="トランザクション関連" tabindex="-1">トランザクション関連 <a class="header-anchor" href="#トランザクション関連" aria-label="Permalink to &quot;トランザクション関連&quot;">​</a></h4><table tabindex="0"><thead><tr><th>イベント</th><th>説明</th></tr></thead><tbody><tr><td><strong>AfterBeginTransaction</strong></td><td>トランザクション開始後</td></tr><tr><td><strong>BeforeEndTransaction</strong></td><td>トランザクション終了前</td></tr><tr><td><strong>BeforeCommit</strong></td><td>コミット前</td></tr><tr><td><strong>AfterCommit</strong></td><td>コミット後</td></tr><tr><td><strong>BeforeRollback</strong></td><td>ロールバック前</td></tr><tr><td><strong>AfterRollback</strong></td><td>ロールバック後</td></tr></tbody></table><h2 id="uroborosqlで提供されているサブスクライバー" tabindex="-1"><strong>uroboroSQL</strong>で提供されているサブスクライバー <a class="header-anchor" href="#uroborosqlで提供されているサブスクライバー" aria-label="Permalink to &quot;**uroboroSQL**で提供されているサブスクライバー&quot;">​</a></h2><p><strong>uroboroSQL</strong>では、以下の<code>EventSubscriber</code>実装が標準で提供されています。</p><table tabindex="0"><thead><tr><th>サブスクライバ</th><th>説明</th></tr></thead><tbody><tr><td><a href="#secretcolumneventsubscriber"><strong>SecretColumnEventSubscriber</strong></a></td><td>指定したカラムの値を自動的に暗号化/復号化します</td></tr><tr><td><a href="#wrapcontexteventsubscriber"><strong>WrapContextEventSubscriber</strong></a></td><td>ExecutionContextをラップして機能を拡張します</td></tr><tr><td><a href="#auditlogeventsubscriber"><strong>AuditLogEventSubscriber</strong></a></td><td>SQL実行の監査ログを出力します</td></tr><tr><td><a href="#debugeventsubscriber"><strong>DebugEventSubscriber</strong></a></td><td>SQL実行のデバッグログを出力します</td></tr><tr><td><a href="#dumpresulteventsubscriber"><strong>DumpResultEventSubscriber</strong></a></td><td>クエリ結果をダンプ形式で出力します</td></tr><tr><td><a href="#replcommandlogeventsubscriber"><strong>ReplCommandLogEventSubscriber</strong></a></td><td>REPL(対話型SQL実行環境)でのコマンド実行ログを出力します</td></tr></tbody></table><h3 id="secretcolumneventsubscriber" tabindex="-1">SecretColumnEventSubscriber <a class="header-anchor" href="#secretcolumneventsubscriber" aria-label="Permalink to &quot;SecretColumnEventSubscriber&quot;">​</a></h3><p>DBアクセス時に機密カラムの値を暗号化/復号化するサブスクライバーです。<br> このサブスクライバーを使用することで、DBの暗号化の仕組みを利用せずにカラム単位での値の暗号化・復号化ができます。</p><h4 id="主な機能-1" tabindex="-1"><strong>主な機能:</strong> <a class="header-anchor" href="#主な機能-1" aria-label="Permalink to &quot;**主な機能:**&quot;">​</a></h4><ul><li><a href="https://docs.oracle.com/javase/jp/11/docs/api/java.base/javax/crypto/package-summary.html" target="_blank" rel="noreferrer">Javaの暗号化の仕組み</a> を使用して、指定カラムの暗号化・復号化を行います。 <ul><li>INSERT/UPDATE実行時に指定カラムの値を暗号化</li><li>SELECT実行時に指定カラムの値を復号化</li></ul></li></ul><h4 id="パラメータ" tabindex="-1">パラメータ: <a class="header-anchor" href="#パラメータ" aria-label="Permalink to &quot;パラメータ:&quot;">​</a></h4><table tabindex="0"><thead><tr><th>パラメータ名</th><th>型</th><th>必須</th><th>デフォルト値</th><th>説明</th></tr></thead><tbody><tr><td><strong>keyStoreFilePath</strong></td><td>String</td><td>○</td><td>-</td><td>秘密鍵を格納したKeyStoreファイルのパス<br>KeyStoreはJCEKSタイプであること</td></tr><tr><td><strong>alias</strong></td><td>String</td><td>○</td><td>-</td><td>KeyStore内で秘密鍵が格納されている場所を示すエイリアス名</td></tr><tr><td><strong>storePassword</strong></td><td>String</td><td>○</td><td>-</td><td>KeyStoreにアクセスするためのストアパスワード<br>Base64エンコードした値を指定する</td></tr><tr><td><strong>cryptColumnNames</strong></td><td>List&lt;String&gt;</td><td>○</td><td>-</td><td>暗号化、復号化を行うカラム名のリスト<br>カラム名はスネークケース（大文字）で指定する<br>cryptColumnNames で指定したカラム名はcryptParamKeysにも追加される</td></tr><tr><td><strong>cryptParamKeys</strong></td><td>List&lt;String&gt;</td><td>○</td><td>-</td><td>暗号化、復号化を行うパラメータ名のリスト<br>パラメータ名はキャメルケースで指定する</td></tr><tr><td><strong>charset</strong></td><td>String</td><td></td><td>UTF-8</td><td>暗号化/復号化時に使用するキャラクタセット</td></tr><tr><td><strong>transformationType</strong></td><td>String</td><td></td><td>AES/ECB/PKCS5Padding</td><td>変換の名前（例: AES/GCM/NoPadding）。標準の変換名については、<a href="https://docs.oracle.com/javase/jp/11/docs/specs/security/standard-names.html#cipher-algorithm-names" target="_blank" rel="noreferrer">Java暗号化アーキテクチャー標準アルゴリズム名</a>のドキュメントを参照</td></tr><tr><td><strong>skip</strong></td><td>boolean</td><td></td><td>false</td><td>イベント処理をスキップするかどうか</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">機密カラムの命名</p><p>SecretColumnEventSubscriber では機密情報を格納するカラムをカラム名で特定します。<br> そのためカラム名が同一で、暗号化するカラムと暗号化しないカラムが混在している場合は対応できません。<br> 機密情報を格納するカラムの名前は一意に識別できるような命名を行ってください。</p></div><h3 id="wrapcontexteventsubscriber" tabindex="-1">WrapContextEventSubscriber <a class="header-anchor" href="#wrapcontexteventsubscriber" aria-label="Permalink to &quot;WrapContextEventSubscriber&quot;">​</a></h3><p>発行するSQL文字列の前後をラップするサブスクライバーです。</p><h4 id="主な機能-2" tabindex="-1"><strong>主な機能:</strong> <a class="header-anchor" href="#主な機能-2" aria-label="Permalink to &quot;**主な機能:**&quot;">​</a></h4><ul><li>SQL発行をフックし、発行されるSQLの前後に文字列を付与します。主に検索SQLをページングに対応するために一律limit句やoffset句を追加するような用途を想定しています。</li><li>SQL変換前にSQLの加工を行うため、バインドパラメータや置換文字列も利用できます。</li></ul><h4 id="パラメータ-1" tabindex="-1">パラメータ: <a class="header-anchor" href="#パラメータ-1" aria-label="Permalink to &quot;パラメータ:&quot;">​</a></h4><table tabindex="0"><thead><tr><th>パラメータ名</th><th>型</th><th>必須</th><th>デフォルト値</th><th>説明</th></tr></thead><tbody><tr><td><strong>wrappedSqlBeginParts</strong></td><td>String</td><td></td><td>-</td><td>SQL文の前に追加する文字列<br>例: <code>SELECT * FROM (</code></td></tr><tr><td><strong>wrappedSqlEndParts</strong></td><td>String</td><td></td><td>-</td><td>SQL文の後に追加する文字列<br>例: <code>) LIMIT /*pageSize*/100 OFFSET /*pageSize * (pageCount - 1)*/0</code></td></tr><tr><td><strong>wrapIgnorePattern</strong></td><td>String</td><td></td><td>-</td><td>Wrapを無視するSQLのパターン（正規表現）<br>このパターンにマッチするSQLはWrap処理をスキップする</td></tr></tbody></table><h3 id="auditlogeventsubscriber" tabindex="-1">AuditLogEventSubscriber <a class="header-anchor" href="#auditlogeventsubscriber" aria-label="Permalink to &quot;AuditLogEventSubscriber&quot;">​</a></h3><p>SQL実行の監査ログを記録するためのサブスクライバーです。SQL実行前後の情報を構造化されたログとして出力します。<br> AuditLogは ログ名 : <code>jp.co.future.uroborosql.event.auditlog</code> に debugレベルで出力されます。</p><h4 id="主な機能-3" tabindex="-1"><strong>主な機能:</strong> <a class="header-anchor" href="#主な機能-3" aria-label="Permalink to &quot;**主な機能:**&quot;">​</a></h4><ul><li>SQL実行時刻、実行時間の記録</li><li>実行されたSQL文とバインドパラメータの記録</li><li>実行結果(件数、エラー情報など)の記録</li></ul><h4 id="パラメータ-2" tabindex="-1">パラメータ: <a class="header-anchor" href="#パラメータ-2" aria-label="Permalink to &quot;パラメータ:&quot;">​</a></h4><table tabindex="0"><thead><tr><th>パラメータ名</th><th>型</th><th>必須</th><th>デフォルト値</th><th>説明</th></tr></thead><tbody><tr><td><strong>funcIdKey</strong></td><td>String</td><td></td><td>_funcId</td><td>バインドパラメータから機能IDを取得する際のキー名<br>ログに記録する機能IDの取得に使用</td></tr><tr><td><strong>userNameKey</strong></td><td>String</td><td></td><td>_userName</td><td>バインドパラメータからユーザ名を取得する際のキー名<br>ログに記録するユーザ名の取得に使用</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">注意事項</p><p>AuditLogEventSubscriber で件数を取得するためにはResultSetの種類が <code>ResultSet#TYPE_SCROLL_INSENSITIVE</code> または <code>ResultSet#TYPE_SCROLL_SENSITIVE</code> である必要があります。<br><code>ResultSet#TYPE_FORWARD_ONLY</code> の場合は 件数は常に -1 となります。</p></div><h3 id="debugeventsubscriber" tabindex="-1">DebugEventSubscriber <a class="header-anchor" href="#debugeventsubscriber" aria-label="Permalink to &quot;DebugEventSubscriber&quot;">​</a></h3><p>開発時のデバッグ用ログを出力するサブスクライバーです。SQL実行の詳細な情報をコンソールに出力します。<br> デバッグ用ログは ログ名 : <code>jp.co.future.uroborosql.event.debug</code> に debugレベルとtraceレベルで出力されます。</p><h4 id="主な機能-4" tabindex="-1"><strong>主な機能:</strong> <a class="header-anchor" href="#主な機能-4" aria-label="Permalink to &quot;**主な機能:**&quot;">​</a></h4><ul><li>トランザクション開始・終了の表示（debug）</li><li>バインドパラメータの詳細表示（debug）</li><li>発行したSQL名の表示（debug）</li><li>発行したSQL文の表示（trace）</li></ul><h3 id="dumpresulteventsubscriber" tabindex="-1">DumpResultEventSubscriber <a class="header-anchor" href="#dumpresulteventsubscriber" aria-label="Permalink to &quot;DumpResultEventSubscriber&quot;">​</a></h3><p>クエリ結果をダンプ形式で出力するサブスクライバーです。SELECT文の実行結果を表形式で見やすく表示します。<br> クエリ結果ダンプ結果ログは ログ名 : <code>jp.co.future.uroborosql.event.dumpresult</code> に debugレベルで出力されます。</p><h4 id="主な機能-5" tabindex="-1"><strong>主な機能:</strong> <a class="header-anchor" href="#主な機能-5" aria-label="Permalink to &quot;**主な機能:**&quot;">​</a></h4><ul><li>クエリ結果の表形式表示</li></ul><div class="warning custom-block"><p class="custom-block-title">注意事項</p><p>DumpResultEventSubscriber によるクエリ結果の取得にはResultSetの種類が <code>ResultSet#TYPE_SCROLL_INSENSITIVE</code> または <code>ResultSet#TYPE_SCROLL_SENSITIVE</code> である必要があります。<br><code>ResultSet#TYPE_FORWARD_ONLY</code> の場合もクエリ結果は出力されますが、このサブスクライバーが結果セットを先頭から最後まで読み進めるため、 処理後にはカーソルが末尾に到達し、アプリケーション側で同じ <code>ResultSet</code> を使った後続の検索・取得処理は行えなくなります（結果セットが消費されます）</p></div><h3 id="replcommandlogeventsubscriber" tabindex="-1">ReplCommandLogEventSubscriber <a class="header-anchor" href="#replcommandlogeventsubscriber" aria-label="Permalink to &quot;ReplCommandLogEventSubscriber&quot;">​</a></h3><p>REPL(対話型SQL実行環境)でのコマンド実行ログを記録するサブスクライバーです。<br> コマンド実行ログは ログ名 : <code>jp.co.future.uroborosql.event.replcommand</code> に debugレベルで出力されます。</p><h4 id="主な機能-6" tabindex="-1"><strong>主な機能:</strong> <a class="header-anchor" href="#主な機能-6" aria-label="Permalink to &quot;**主な機能:**&quot;">​</a></h4><ul><li>REPLコマンドの実行履歴記録</li></ul><h2 id="カスタムeventsubscriberの作成" tabindex="-1">カスタムEventSubscriberの作成 <a class="header-anchor" href="#カスタムeventsubscriberの作成" aria-label="Permalink to &quot;カスタムEventSubscriberの作成&quot;">​</a></h2><p><strong>uroboroSQL</strong>では、<code>EventSubscriber</code>インターフェースを実装することで、独自のイベント処理を追加できます。<br> ここでは、カスタムサブスクライバーを作成する方法を解説します。</p><h3 id="基本的な実装手順" tabindex="-1">基本的な実装手順 <a class="header-anchor" href="#基本的な実装手順" aria-label="Permalink to &quot;基本的な実装手順&quot;">​</a></h3><h4 id="_1-eventsubscriberインターフェースの実装" tabindex="-1">1. EventSubscriberインターフェースの実装 <a class="header-anchor" href="#_1-eventsubscriberインターフェースの実装" aria-label="Permalink to &quot;1. EventSubscriberインターフェースの実装&quot;">​</a></h4><p><code>EventSubscriber</code>を継承し、必要なイベントメソッドをオーバーライドします。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomEventSubscriber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventSubscriber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Logger LOG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LoggerFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLogger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CustomEventSubscriber.class);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // EventSubscriberが提供する各イベントのリスナー登録用メソッドにリスナーを登録</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		    afterSqlQueryListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">afterSqlQuery);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 初期化処理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CustomEventSubscriber initialized&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> afterSqlQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AfterSqlQueryEvent </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">evt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Execute Query - sqlName:{} executed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, evt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSqlName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_2-sqlconfigへの登録" tabindex="-1">2. SqlConfigへの登録 <a class="header-anchor" href="#_2-sqlconfigへの登録" aria-label="Permalink to &quot;2. SqlConfigへの登録&quot;">​</a></h4><p>作成したサブスクライバーを<code>SqlConfig</code>に登録します。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SqlConfig config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UroboroSQL.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jdbc:h2:mem:test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sa&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventListenerHolder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventSubscriber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomEventSubscriber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="eventsubscriber実装例-共通項目自動パラメータバインド" tabindex="-1">EventSubscriber実装例（共通項目自動パラメータバインド） <a class="header-anchor" href="#eventsubscriber実装例-共通項目自動パラメータバインド" aria-label="Permalink to &quot;EventSubscriber実装例（共通項目自動パラメータバインド）&quot;">​</a></h3><p>アプリケーションで使用する各テーブルに共通項目（登録日時、更新日時など）が定義されている場合、 INSERT文やUPDATE文を実行する際には、毎回これらの共通項目に対するパラメータを指定する必要があります。</p><p>このような共通項目へのパラメータ設定を個別に行うと、実装が煩雑になるだけでなく、 実装漏れや記述ミスにより正しく値が設定されないといった問題が発生しやすくなります。</p><p>このような共通項目へのパラメータ設定は、<code>EventSubscriber</code> を利用することで自動化できます。 <code>EventSubscriber</code> のイベントはSQL実行のたびに呼び出されるため、イベント内で共通項目のパラメータを設定することで、 すべてのSQL実行時に自動的にパラメータがバインドされます。</p><ul><li>共通項目自動パラメータバインドイベントサブスクライバー実装例</li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 共通項目自動パラメータバインドイベントサブスクライバー</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> **/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoParameterBindEventSubscriber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventSubscriber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // SQL API 用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      beforeParseSqlListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">onBeforeParseSql);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // DAO API 用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      beforeEntityInsertListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindInsertParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEntity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      beforeEntityBulkInsertListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindInsertParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEntity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      beforeEntityBatchInsertListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindInsertParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEntity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      beforeEntityUpdateListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindUpdateParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEntity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      beforeEntityBatchUpdateListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindUpdateParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEntity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * SQLパース前のイベントを処理する.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> イベント</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onBeforeParseSql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BeforeParseSqlEvent </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSqlKind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INSERT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             MERGE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             UPDATE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             BATCH_INSERT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             BATCH_UPDATE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             BULK_INSERT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             ENTITY_BATCH_INSERT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             ENTITY_BULK_INSERT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             ENTITY_INSERT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             ENTITY_UPDATE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ExecutionContext ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                LocalDateTime now </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">paramIfAbsent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;createDatetime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, now);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">paramIfAbsent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;updateDatetime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, now);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 登録用のパラメータをバインドする.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> entity</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> エンティティ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindInsertParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">entity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // DAOクラスがEntityModel抽象クラスを継承し、EntityModelクラスに共通項目のフィールドが定義されている、とします。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EntityModel model)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      LocalDateTime now </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCreateDatetime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(now);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUpdateDatetime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(now);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 更新用のパラメータをバインドする.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> entity</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> エンティティ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindUpdateParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">entity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // DAOクラスがEntityModel抽象クラスを継承し、EntityModelクラスに共通項目のフィールドが定義されている、とします。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EntityModel model)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUpdateDatetime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div>`,55))])}const C=E(b,[["render",c]]);export{S as __pageData,C as default};
