import{_ as t,C as n,o as h,c as k,j as a,a as r,E as e,a2 as i}from"./chunks/framework.DuVu33VI.js";const F=JSON.parse('{"title":"2WaySQL","description":"","frontmatter":{"head":[["meta",{"name":"og:title","content":"2WaySQL"}],["meta",{"name":"og:url","content":"/uroborosql-doc/background/"}]]},"headers":[],"relativePath":"background/index.md","filePath":"background/index.md"}'),d={name:"background/index.md"},c={class:"warning custom-block"};function o(b,s,g,E,m,y){const l=n("CopyOrDownloadAsMarkdownButtons"),p=n("Badge");return h(),k("div",null,[s[2]||(s[2]=a("div",{style:{display:"none"},hidden:"true","aria-hidden":"true"},"Are you an LLM? You can read better optimized documentation at /uroborosql-doc/background.md for this page in Markdown format",-1)),s[3]||(s[3]=a("h1",{id:"_2waysql",tabindex:"-1"},[r("2WaySQL "),a("a",{class:"header-anchor",href:"#_2waysql","aria-label":'Permalink to "2WaySQL"'},"​")],-1)),e(l),s[4]||(s[4]=i(`<p><strong>uroboroSQL</strong>の基本操作について説明する前に<strong>uroboroSQL</strong>を利用する上で必要になる項目について説明します。</p><h2 id="_2waysqlとは" tabindex="-1">2WaySQLとは <a class="header-anchor" href="#_2waysqlとは" aria-label="Permalink to &quot;2WaySQLとは&quot;">​</a></h2><p>2WaySQLは普通のSQL文をファイルに保存したものです。そのままSQLクライアントツールで実行することもできますし、<strong>uroboroSQL</strong>で読み込んで実行することも出来ます。<br> （２つの実行方法があることから<strong>2Way</strong>SQLと呼ばれます）</p><h2 id="バインドパラメータ" tabindex="-1">バインドパラメータ (<code>/* */</code>) <a class="header-anchor" href="#バインドパラメータ" aria-label="Permalink to &quot;バインドパラメータ (\`/* */\`)&quot;">​</a></h2><p>SQLにバインドするパラメータを <code>/*parameterName*/</code>の形式で指定することができます。<br><code>parameterName</code> はBeanのフィールドとの親和性を考慮し、キャメルケースで記述することが慣例となっています。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  department</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dept_no    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*deptNo*/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dept_name  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*deptName*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Sales&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上の例では、<code>/*deptNo*/</code>, <code>/*deptName*/</code> がバインドパラメータで、<strong>uroboroSQL</strong>から実行される際はこの部分が<code>?</code>に置き換わり、後ろの<code>10</code>や<code>&#39;Sales&#39;</code>が削除されます。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  department</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dept_no    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ?</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*deptNo*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dept_name  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ?</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*deptName*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="in句の利用方法" tabindex="-1">IN句の利用方法 <a class="header-anchor" href="#in句の利用方法" aria-label="Permalink to &quot;IN句の利用方法&quot;">​</a></h3><p>List型の値をIN句のバインドパラメータとして指定することもできます。</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>IN句にバインドパラメータを指定する場合、バインドパラメータの後ろに<code>()</code>を記述する必要があります。</p></div><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF genderList != null*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gender</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  in</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*genderList*/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;M&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上の例に<code>genderList</code>として{&quot;M&quot;, &quot;F&quot;}を指定すると以下のように変換されます。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF genderList != null*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gender</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (?, ?)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*genderList*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="like句の利用方法" tabindex="-1">LIKE句の利用方法 <a class="header-anchor" href="#like句の利用方法" aria-label="Permalink to &quot;LIKE句の利用方法&quot;">​</a></h3><p>LIKE句に対してバインドパラメータを使用する場合は、以下のように<a href="./el.html#SqlFunction-sf">SqlFunction</a>を使って記述してください。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF firstName != null*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> like</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /*SF.contains(firstName)*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> escape </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*#ESC_CHAR*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF lastName != null*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  like</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /*SF.startsWith(lastName)*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> escape </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*#ESC_CHAR*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上の例で、バインドパラメータ <code>firstName</code>に<code>a</code>, <code>lastName</code>に<code>D</code>を指定した場合は以下のようになります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%a%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> escape </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;D%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> escape </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上の例で、ワイルドカードを含む例としてバインドパラメータ <code>firstName</code>に<code>a%</code>, <code>lastName</code>に<code>D_</code>を指定した場合は以下のようになります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%a$%%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> escape </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> -- %がエスケープされる</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;D$_%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> escape </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- _がエスケープされる</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ワイルドカード（<code>%</code>や<code>_</code>）を含む文字列がバインドパラメータに指定された場合でも、<a href="./el.html#SqlFunction-sf">SqlFunction</a>を利用することで文字列のエスケープ処理が適切に行われます。</p></div>`,22)),a("div",c,[s[1]||(s[1]=a("p",{class:"custom-block-title"},"WARNING",-1)),a("p",null,[s[0]||(s[0]=i('エスケープキャラクタ（上記の例では<code>$</code>）はDB毎の設定（<a href="./../configuration/dialect.html#dialect">Dialect</a>）によって変わります。<br> 現在の設定では、Oracleの場合は<code>\\</code>, その他のDBでは<code>$</code>となります。<br><code>\\</code>や<code>$</code>のかわりに<code>/*#ESC_CHAR*/</code>と記載することでDB毎の設定を気にせずにエスケープ文字を指定することができます。',18)),e(p,{text:"0.14.0+",vertical:"middle"})])]),s[5]||(s[5]=i(`<h2 id="バインド出来るパラメータの型" tabindex="-1">バインド出来るパラメータの型 <a class="header-anchor" href="#バインド出来るパラメータの型" aria-label="Permalink to &quot;バインド出来るパラメータの型&quot;">​</a></h2><p>バインドパラメータに指定できるJava型は以下になります。</p><ul><li>プリミティブ型とそのラッパー型（ただし char と java.lang.Character は除く）</li><li>java.math.BigDecimal</li><li>java.math.BigInteger</li><li>java.lang.String</li><li>byte[]</li><li>java.sql.Date</li><li>java.sql.Time</li><li>java.sql.Timestamp</li><li>java.sql.Array</li><li>java.sql.Ref</li><li>java.sql.Blob</li><li>java.sql.Clob</li><li>java.sql.SQLXML</li><li>java.sql.Struct</li><li>列挙型(enum)</li><li>java.util.Date</li><li>java.util.Optional</li><li>java.util.OptionalInt</li><li>java.util.OptionalLong</li><li>java.util.OptionalDouble</li><li>java.time.LocalDateTime</li><li>java.time.OffsetDateTime</li><li>java.time.ZonedDateTime</li><li>java.time.LocalDate</li><li>java.time.LocalTime</li><li>java.time.OffsetTime</li><li>java.time.Year</li><li>java.time.YearMonth</li><li>java.time.MonthDay</li><li>java.time.Month</li><li>java.time.DayOfWeek</li></ul><h2 id="置換文字列" tabindex="-1">置換文字列 (<code>/*$ */</code> , <code>/*# */</code>) <a class="header-anchor" href="#置換文字列" aria-label="Permalink to &quot;置換文字列 (\`/*$ */\` , \`/*# */\`)&quot;">​</a></h2><p>置換文字列を使うとSQLを動的に変更することができます。</p><p>置換文字列は <code>/*$parameterName*/</code> もしくは <code>/*#parameterName*/</code>と記述します。<br><code>/*#parameterName*/</code> と記述した場合は、置換文字列の前後を<code>&#39;</code>(シングルクォート)で囲みます。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /*$tableName*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  gender  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*#gender*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上の例では、<code>tableName</code>や<code>gender</code>に設定した値でSQLが置換されます。</p><ul><li><code>tableName</code>に<code>employee</code>, <code>gender</code>に<code>M</code>を設定した場合</li></ul><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  gender  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;M&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>という風に置換されたSQLが実行されることになります。</p><div class="danger custom-block"><p class="custom-block-title">注意</p><p>置換文字列はSQLインジェクションなど脆弱性の原因となる可能性があります。十分に注意を払ったうえで利用してください</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>置換文字列はSQLインジェクションを防ぐため、変換の際にシングルクォート<code>&#39;</code>を<code>&#39;&#39;</code>にエスケープします</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>置換文字列はバインドパラメータとしてではなく実行されるSQLを構築する時点で置換される点に注意してください。<br> データベースによってはSQL文が動的に変わることで解析結果のキャッシュが適用されず、<br> 解析処理が都度実行されることでCPUに負荷をかける可能性があります。</p></div><h2 id="条件分岐-if-elif-else-end" tabindex="-1">条件分岐 ( <code>/*IF*/</code>, <code>/*ELIF*/</code>, <code>/*ELSE*/</code>, <code>/*END*/</code> ) <a class="header-anchor" href="#条件分岐-if-elif-else-end" aria-label="Permalink to &quot;条件分岐 ( \`/*IF*/\`, \`/*ELIF*/\`, \`/*ELSE*/\`, \`/*END*/\` )&quot;">​</a></h2><p><code>/*IF*/</code>, <code>/*ELIF*/</code>, <code>/*ELSE*/</code>, <code>/*END*/</code> を使用してSQLを動的に変更することができます。</p><h3 id="記述方法" tabindex="-1">記述方法 <a class="header-anchor" href="#記述方法" aria-label="Permalink to &quot;記述方法&quot;">​</a></h3><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF [評価式]*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- IFの評価式が真の場合に適用されるSQL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELIF [評価式]*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- ELIFの評価式が真の場合に適用されるSQL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELSE*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- IF,ELIFの評価式が偽の場合に適用されるSQL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>/*IF*/</code>, <code>/*ELIF*/</code>の評価式として式言語を利用します。 （ 式言語の説明は<a href="./el.html#式言語">こちら</a> )<br> また、標準でSF関数(<em>S</em>tring <em>F</em>unction)を使うことができます。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF SF.isNotEmpty(birthDateFrom) and SF.isNotEmpty(birthDateTo)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  between</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*birthDateFrom*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1990-01-01&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  and</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*birthDateTo*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1999-12-31&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELIF SF.isNotEmpty(birthDateFrom)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /*birthDateFrom*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1990-01-01&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELIF SF.isNotEmpty(birthDateTo)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /*birthDateTo*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1999-12-31&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELSE*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>上の例ではIFの評価式として<code>SF.isNotEmpty()</code>を使用してバインドパラメータが<code>null</code>または<code>&quot;&quot;</code>でないことを評価しています。</p><div class="tip custom-block"><p class="custom-block-title">評価式に渡されるバインドパラメータの型</p><p><a href="#バインド出来るパラメータの型">バインド出来るパラメータの型</a> にもあるようにバインドパラメータには色々なJava型のオブジェクトを設定することができます。<br> 評価式の中ではバインドパラメータをオブジェクトとして扱うことができます。<br> 例えば、バインドパラメータ <code>now_date</code> に LocalDate型のオブジェクト <code>java.time.LocalDate.now()</code> をバインドした場合、評価式の中では<br><code>/*IF now_date != null and now_date.getMonth().getValue() == 3 */ -- 現在の月が3月だったら</code><br> のようなLocalDate型のインスタンスメソッドを呼び出した結果で評価を行うことが出来ます。<br> 上記の場合、式言語のプロパティアクセスを利用して<br><code>/*IF now_date != null and now_date.month.value == 3 */ -- 現在の月が3月だったら</code><br> という書き方も出来ます。</p></div><p>バインドパラメータとして<code>birthDateFrom</code>に<code>2000-01-01</code>, <code>birthDateTo</code>に<code>2010-12-31</code>を指定した場合、生成されるSQLは以下のようになります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  between</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ?</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*birthDateFrom*/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ?</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*birthDateTo*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>最後にバインドパラメータが評価され、実行されるSQLが以下になります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  between</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;2000-01-01&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*birthDateFrom*/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;2010-12-31&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*birthDateTo*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ここで<code>emp.birth_date</code>の前にあった<code>and</code>が消えていることに注目してください。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><strong>uroboroSQL</strong>では動的SQLを生成する際、WHERE句の後ろに<code>and</code>や<code>or</code>が来る場合はそれを削除してSQL文として正しい状態にします</p></div><p>ただし、上の加工前SQLのようにSQL文として不正な状態になってしまうのでSQLクライアントツールからは実行できないという欠点もあります。<br> このようにSQL文として不正になることを防ぐために、WHERE句のあとに他に影響を与えない評価を入れる方法があります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  //</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 必ずtrueとなる評価を入れる</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF SF.isNotEmpty(birthDateFrom) and SF.isNotEmpty(birthDateTo)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  between</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*birthDateFrom*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1990-01-01&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  and</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*birthDateTo*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1999-12-31&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELIF SF.isNotEmpty(birthDateFrom)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /*birthDateFrom*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1990-01-01&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELIF SF.isNotEmpty(birthDateTo)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /*birthDateTo*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1999-12-31&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*ELSE*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="範囲の有効化-begin-end" tabindex="-1">範囲の有効化 ( <code>/*BEGIN*/</code>, <code>/*END*/</code> ) <a class="header-anchor" href="#範囲の有効化-begin-end" aria-label="Permalink to &quot;範囲の有効化 ( \`/*BEGIN*/\`, \`/*END*/\` )&quot;">​</a></h2><p><code>/*BEGIN*/</code>, <code>/*END*/</code> で囲まれた範囲は、その中の<code>/*IF*/</code>, <code>/*ELIF*/</code>のうち、どれか1つでも真(true)になった場合に出力されます。<br> 範囲内の全ての評価式が偽（false）の場合、<code>/*BEGIN*/</code>, <code>/*END*/</code> で囲まれた範囲は出力されません。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*BEGIN*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF SF.isNotEmpty(firstName)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*firstName*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Bob&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF SF.isNotEmpty(lastName)*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*lastName*/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Smith&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>上の例で、バインドパラメータ <code>firstName</code>に<code>Willson</code>, <code>lastName</code>に<code>null</code>を指定した場合は以下のようになります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ?</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*firstName*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>バインドパラメータ <code>firstName</code>, <code>lastName</code>ともに<code>null</code>を指定した場合は以下のようになります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>/*BEGIN*/</code>,<code>/*END*/</code>で囲まれた<code>where</code>が出力されていないことがわかります。</p><h2 id="sql-id" tabindex="-1">SQL_ID <a class="header-anchor" href="#sql-id" aria-label="Permalink to &quot;SQL_ID&quot;">​</a></h2><p>発行するSQLに <code>/* _SQL_ID_ */</code> という記述があると、そのSQLを発行する際に <code>_SQL_ID_</code> の部分をSQL名やEntityを特定するための文字列に置換します。<br> これにより、ログに出力されるSQLやDBに記録されるSQL発行結果を確認することで、どのSQLが発行されたのかを追跡しやすくなります。</p><ul><li>employee/select_employee.sql</li></ul><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* _SQL_ID_ */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp_no</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  emp_no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  first_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  last_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  birth_date</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gender</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  gender</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lock_version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lock_version</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">（以下略）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>というSQLがあるとき、実際に発行されたSQLは以下のようになります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* employee/select_employee */</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- _SQL_ID_ が SQL名に置換されている</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp_no</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  emp_no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  first_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  last_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">birth_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  birth_date</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gender</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  gender</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">emp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lock_version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lock_version</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">（以下略）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="tip custom-block"><p class="custom-block-title"><code>SQL_ID</code>の置換文字列指定</p><p><code>SQL_ID</code> の置換文字列のデフォルト設定は<code>_SQL_ID_</code>ですが、これは SqlAgentProviderの設定で変更することができます。<br> 設定方法については <a href="./../configuration/sql-agent-provider.html#sql-idの置換文字列設定-sqlagentprovider-setsqlidkeyname">SQL_IDの置換文字列設定</a> を参照してください。</p></div><div class="tip custom-block"><p class="custom-block-title"><code>SQL_ID</code>の記述場所</p><p><code>SQL_ID</code> はSQL中のどこに記述しても問題ありません。<br> ただし、ログやSQL発行結果で確認することが目的であるため、SQLの最初の予約語の後に記述することが慣例となっています。<br> （文の先頭に記述した場合、DBの種類によっては不要なコメントとして除去されることがあるため、予約語の後ろに記述します）<br> 具体的には <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>WITH</code> の後ろに記述します。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* _SQL_ID_ */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cte_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cte_name;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><p>エンティティクラスを指定したSQL発行では、エンティティクラス名がSQL名として使用されます。</p><h2 id="不要なカンマの除去" tabindex="-1">不要なカンマの除去 <a class="header-anchor" href="#不要なカンマの除去" aria-label="Permalink to &quot;不要なカンマの除去&quot;">​</a></h2><p>IF分岐を使って動的なSQLを構築する場合、カンマの有無が問題になる場合があります。 以下のSQLを例として説明します。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF detail*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  first_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  last_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  birth_date</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  gender</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  emp_no</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">order by</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*IF detail*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  birth_date</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*END*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  emp_no</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ここでバインドパラメータ<code>detail</code>に<code>true</code>を指定した場合、生成されるSQLは以下になります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  first_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  last_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  birth_date</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  gender</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  emp_no</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">order by</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  birth_date</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  emp_no</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>このSQLでは<code>select</code>の直後や<code>order by</code>の直後にカンマが出現しておりSQL文として不正であるため、SQLの実行に失敗します。<br> これを避けるため<strong>uroboroSQL</strong>では、生成後のSQLに含まれる不要なカンマを除去するようになっています。</p><p>実際に生成されるSQLは以下になります。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  first_name     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 先頭のカンマが除去される</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  last_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  birth_date</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  gender</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  emp_no</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  employee  emp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">order by</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  birth_date     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 先頭のカンマが除去される</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  emp_no</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>カンマが除去されるのは、以下の予約語の直後にカンマが出現した場合です（大文字小文字の区別無し）。</p><ul><li>SELECT</li><li>ORDER BY</li><li>GROUP BY</li><li>(</li><li>SET</li></ul>`,57))])}const D=t(d,[["render",o]]);export{F as __pageData,D as default};
