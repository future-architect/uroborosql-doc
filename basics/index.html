<!DOCTYPE html>
<html lang="ja">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Description-->
    
        <meta name="description" content="uroboroSQLの公式ドキュメントサイトです。">
    

    <!--Author-->
    
        <meta name="author" content="Future Architect">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="基本操作">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="uroboroSQL ドキュメント">

    <!--Page Cover-->
    
        <meta property="og:image" content="/uroborosql-doc/images/logo.png">
    

    <!-- Title -->
    
    <title>基本操作 - uroboroSQL ドキュメント</title>

    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="/css/main.css"> -->
    <link rel="stylesheet" href="/uroborosql-doc/css/main.css">

    <!--[if lt IE 8]>
        <script src="/uroborosql-doc/js/ie/html5shiv.js"></script>
    <![endif]-->

    <!--[if lt IE 8]>
        <link rel="stylesheet" href="/uroborosql-doc/sass/ie8.css">
    <![endif]-->

    <!--[if lt IE 9]>
        <link rel="stylesheet" href="/uroborosql-doc/sass/ie9.css">
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet">
    <link rel="shortcut icon" href="/uroborosql-doc/favicon.ico">

    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer>
      {lang: 'ja'}
    </script>
    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-93486523-1', 'auto');
        ga('send', 'pageview');

    </script>



</head>


<body>

    <div id="wrapper">

        <!-- Menu -->
        <!-- Header -->
<header id="header">
    <div class="inner">
        <!-- Logo -->
        <a href="/uroborosql-doc/" class="logo">
            <span class="symbol"><img src="/uroborosql-doc//images/logo.png" alt=""></span>
        </a>
        <!-- Nav -->
        <nav>
            <ul>
                <li><a href="#menu">Menu</a></li>
            </ul>
        </nav>
    </div>
</header>
<!-- Menu -->
<nav id="menu">
    <h2>Menu</h2>
    <form id="search-form">
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off">
        <i class="fa fa-times" onclick="resetSearch()"></i>
    </form>
    <div id="local-search-result"></div>
    <p class="no-result">No results found</p>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
    <script src="/uroborosql-doc/js/search.js"></script>
    <script>
    var path = "/uroborosql-doc//search.xml";
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>
    <ul id="menu-agenda">
        <li><a href="/uroborosql-doc/why_uroborosql/">Why uroboroSQL?</a></li>
        <li><a href="/uroborosql-doc/getting_started/">Getting Started</a></li>
        <li><a href="/uroborosql-doc/basics/">基本操作</a></li>
        <li><a href="/uroborosql-doc/advanced/">高度な操作</a></li>
        <li><a href="/uroborosql-doc/developer_guide/">開発者ガイド</a></li>
        <li><a href="/uroborosql-doc/license/">License</a></li>
        <li><a href="/uroborosql-doc/about_uroborosql/">uroboroSQLについて</a></li>
    </ul>
</nav>

        <div id="main">
            <div class="inner">

                <!-- Main Content -->
                

    <h1>基本操作</h1>



<!-- Gallery -->


<!-- Content -->
<hr>
<ul>
<li><a href="#前提知識">前提知識</a><ul>
<li><a href="#2WaySQL">2WaySQL</a></li>
<li><a href="#OGNL式言語">OGNL式言語</a></li>
</ul>
</li>
<li><a href="#基本操作">基本操作</a><ul>
<li><a href="#DB接続">DB接続</a></li>
<li><a href="#SqlAgentインスタンスの取得">SqlAgentインスタンスの取得</a></li>
<li><a href="#SQLファイルの管理">SQLファイルの管理</a></li>
<li><a href="#共通API">共通API</a></li>
<li><a href="#検索">検索</a></li>
<li><a href="#更新">更新</a></li>
<li><a href="#バッチ更新">バッチ更新</a></li>
<li><a href="#プロシージャの実行">プロシージャの実行</a></li>
<li><a href="#DAOインタフェース">DAOインタフェース</a></li>
</ul>
</li>
<li><a href="#トランザクション">トランザクション</a><ul>
<li><a href="#トランザクションの開始と終了">トランザクションの開始と終了</a></li>
<li><a href="#コミットとロールバック">コミットとロールバック</a></li>
<li><a href="#セーブポイント">セーブポイント</a></li>
</ul>
</li>
</ul>
<hr>
<p>この章では、uroboroSQLの基本操作をまとめています。</p>
<h2 id="前提知識"><a href="#前提知識" class="headerlink" title="前提知識"></a>前提知識</h2><p>基本操作について説明する前にuroboroSQLを利用する上で必要になる以下の２つの項目について説明します。</p>
<ul>
<li><a href="#2WaySQL">2WaySQL</a></li>
<li><a href="#OGNL式言語">OGNL式言語</a></li>
</ul>
<h2 id="2WaySQL"><a href="#2WaySQL" class="headerlink" title="2WaySQL"></a>2WaySQL</h2><p>2WaySQLは普通のSQL文をファイルに保存したものです。<br>そのままSQLクライアントツールで実行することもできますし、uroboroSQLで読み込んで実行することも出来ます。<br>（２つの実行方法があることから<strong>2Way</strong>SQLと呼ばれます）</p>
<h3 id="基本文法"><a href="#基本文法" class="headerlink" title="基本文法"></a>基本文法</h3><h3 id="バインドパラメータ"><a href="#バインドパラメータ" class="headerlink" title="バインドパラメータ"></a>バインドパラメータ</h3><p>SQLにバインドするパラメータを <code>/*parameter name*/</code>の形式で指定することができます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  DEPARTMENT</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  DEPT_NO    =  <span class="comment">/*dept_no*/</span><span class="number">10</span></span><br><span class="line"><span class="keyword">AND</span>  DEPT_NAME  =  <span class="comment">/*dept_name*/</span><span class="string">'Sales'</span></span><br></pre></td></tr></table></figure>
<p>上の例では、<code>/*dept_no*/</code>, <code>/*dept_name*/</code> がバインドパラメータで、uroboroSQLから実行される際はこの部分が<code>?</code>に置き換わり、後ろの<code>10</code>や<code>&#39;Sales&#39;</code>が削除されます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  DEPARTMENT</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  DEPT_NO    =  ?<span class="comment">/*dept_no*/</span></span><br><span class="line"><span class="keyword">AND</span>  DEPT_NAME  =  ?<span class="comment">/*dept_name*/</span></span><br></pre></td></tr></table></figure>
<p>List型の値をIN句のバインドパラメータとして指定することもできます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="comment">/*IF gender_list != null*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.GENDER  <span class="keyword">IN</span>  <span class="comment">/*gender_list*/</span>(<span class="string">'M'</span>)</span><br><span class="line"><span class="comment">/*END*/</span></span><br></pre></td></tr></table></figure>
<p>上の例に<code>gender_list</code>として{“M”, “F”}を指定すると以下のように変換されます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="comment">/*IF gender_list != null*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.GENDER  <span class="keyword">IN</span>  (?, ?)<span class="comment">/*gender_list*/</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br></pre></td></tr></table></figure>
<p>バインドパラメータに指定できるJava型は以下になります。</p>
<h4 id="バインド出来るパラメータの型"><a href="#バインド出来るパラメータの型" class="headerlink" title="バインド出来るパラメータの型"></a>バインド出来るパラメータの型</h4><ul>
<li>プリミティブ型とそのラッパー型（ただし char と java.lang.Character は除く）</li>
<li>java.math.BigDecimal</li>
<li>java.math.BigInteger</li>
<li>java.lang.String</li>
<li>byte[]</li>
<li>java.sql.Date</li>
<li>java.sql.Time</li>
<li>java.sql.Timestamp</li>
<li>java.sql.Array</li>
<li>java.sql.Ref</li>
<li>java.sql.Blob</li>
<li>java.sql.Clob</li>
<li>java.sql.SQLXML</li>
<li>java.sql.Struct</li>
<li>列挙型(enum)</li>
<li>java.util.Date</li>
<li>java.util.Optional</li>
<li>java.util.OptionalInt</li>
<li>java.util.OptionalLong</li>
<li>java.util.OptionalDouble</li>
<li>java.time.LocalDateTime</li>
<li>java.time.OffsetDateTime</li>
<li>java.time.ZonedDateTime</li>
<li>java.time.LocalDate</li>
<li>java.time.LocalTime</li>
<li>java.time.OffsetTime</li>
<li>java.time.Year</li>
<li>java.time.YearMonth</li>
<li>java.time.MonthDay</li>
<li>java.time.Month</li>
<li>java.time.DayOfWeek</li>
</ul>
<h3 id="置換文字列"><a href="#置換文字列" class="headerlink" title="置換文字列"></a>置換文字列</h3><p>置換文字列を使うと動的に変更することができます。</p>
<p>置換文字列は <code>/*$parameter name*/</code> もしくは <code>/*#parameter name*/</code>と記述します。<br> <code>/*#parameter name*/</code> と記述した場合は、置換文字列の前後を<code>&#39;</code>(シングルクォート)で囲みます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span>    <span class="comment">/*$table_name*/</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  GENDER  =  <span class="comment">/*#gender*/</span></span><br></pre></td></tr></table></figure>
<p>上の例では、<code>table_name</code>や<code>gender</code>に設定した値でSQLが置換されます。</p>
<blockquote>
<p>置換文字列はバインドパラメータではなく発行されるSQLを構築する時点で置換される点に注意してください。<br>データベースによってはSQL文が動的に変わることで解析結果のキャッシュが適用されず、<br>解析処理が都度実行されることでCPUに負荷をかける可能性があります。</p>
</blockquote>
<ul>
<li><code>table_name</code>に<code>employee</code>, <code>gender</code>に<code>M</code>を設定した場合<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span>  employee</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  GENDER  =  <span class="string">'M'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>という風に置換されたSQLが発行されることになります。</p>
<blockquote>
<p>置換文字列はSQLインジェクションを防ぐため、変換の際にシングルクォート<code>&#39;</code>を<code>&#39;&#39;</code>にエスケープします。__</p>
</blockquote>
<h3 id="条件分岐"><a href="#条件分岐" class="headerlink" title="条件分岐"></a>条件分岐</h3><p>/*IF*/, /*ELIF*/, /*ELSE*/, /*END*/ を使用してSQLを動的に変更することができます。</p>
<p>IF, ELIF の評価式としてOGNL式言語を利用します。<br>（ OGNL式言語の説明は<a href="#OGNL式言語">こちら</a> )<br>また、標準でSF関数(<em>S</em>tring <em>F</em>unction)を使うことができます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="comment">/*IF SF.isNotEmpty(birth_date_from) and SF.isNotEmpty(birth_date_to)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.BIRTH_DATE  <span class="keyword">BETWEEN</span>  <span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span>  <span class="keyword">AND</span>  <span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></span><br><span class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_from)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.BIRTH_DATE  &gt;=    <span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span></span><br><span class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_to)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.BIRTH_DATE  &lt;    <span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></span><br><span class="line"><span class="comment">/*ELSE*/</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br></pre></td></tr></table></figure>
<p>上の例ではIFの評価式として<code>SF.isNotEmpty()</code>を使用してバインドパラメータが<code>null</code>または<code>&quot;&quot;</code>でないことを評価しています。</p>
<p>バインドパラメータとして<code>birth_date_from</code>に<code>2000-01-01</code>, <code>birth_date_to</code>に<code>2010-12-31</code>を指定した場合、生成されるSQLは以下のようになります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  EMP.BIRTH_DATE  <span class="keyword">BETWEEN</span>  ?<span class="comment">/*birth_date_from*/</span>  <span class="keyword">AND</span>  ?<span class="comment">/*birth_date_to*/</span></span><br></pre></td></tr></table></figure>
<p>そしてバインドパラメータが解決された結果、以下のSQLが実行されます。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  EMP.BIRTH_DATE  <span class="keyword">BETWEEN</span>  <span class="string">'2000-01-01'</span><span class="comment">/*birth_date_from*/</span>  <span class="keyword">AND</span>  <span class="string">'2010-12-31'</span><span class="comment">/*birth_date_to*/</span></span><br></pre></td></tr></table></figure></p>
<p>ここでEMP.BIRTH_DATEの前にあった<code>AND</code>が消えていることに注目してください。<br>uroboroSQLでは動的SQLを生成する際、WHERE句の後ろに<code>AND</code>や<code>OR</code>が来る場合はそれを削除してSQL文として正しい状態にします。</p>
<p>ただし、上の加工前SQLのようにSQL文として不正な状態になってしまうのでSQLクライアントツールからは実行できないという欠点もあります。<br>このようにSQL文として不正になることを防ぐために、WHERE句のあとに他に影響を与えない評価を入れる方法があります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  <span class="number">1</span>        =    <span class="number">1</span>  // &lt;<span class="comment">-- 必ずtrueとなる評価を入れる</span></span><br><span class="line"><span class="comment">/*IF SF.isNotEmpty(birth_date_from) and SF.isNotEmpty(birth_date_to)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.BIRTH_DATE  <span class="keyword">BETWEEN</span>  <span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span>  <span class="keyword">AND</span>  <span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></span><br><span class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_from)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.BIRTH_DATE  &gt;=    <span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span></span><br><span class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_to)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.BIRTH_DATE  &lt;    <span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></span><br><span class="line"><span class="comment">/*ELSE*/</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br></pre></td></tr></table></figure>
<h3 id="範囲の有効化"><a href="#範囲の有効化" class="headerlink" title="範囲の有効化"></a>範囲の有効化</h3><p>/*BEGIN*/, /*END*/ で囲まれた範囲は、その中の/*IF*/, /*ELIF*/のうち、どれか1つでも真(true)になった場合に出力されます。<br>範囲内の全ての評価式が偽（false）の場合、/*BEGIN*/, /*END*/ で囲まれた範囲は出力されません。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="comment">/*BEGIN*/</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="comment">/*IF SF.isNotEmpty(first_name)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.FIRST_NAME  =  <span class="comment">/*first_name*/</span><span class="string">'Bob'</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br><span class="line"><span class="comment">/*IF SF.isNotEmpty(last_name)*/</span></span><br><span class="line"><span class="keyword">AND</span>  EMP.LAST_NAME  =  <span class="comment">/*last_name*/</span><span class="string">'Smith'</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br></pre></td></tr></table></figure>
<p>上の例で、バインドパラメータ <code>first_name</code>に<code>Willson</code>, <code>last_name</code>に<code>null</code>を指定した場合は以下のようになります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  EMP.FIRST_NAME  =  ?<span class="comment">/*first_name*/</span></span><br></pre></td></tr></table></figure>
<p>バインドパラメータ <code>first_name</code>, <code>last_name</code>ともに<code>null</code>を指定した場合は以下のようになります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  *</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br></pre></td></tr></table></figure>
<p>/*BEGIN*/,/*END*/で囲まれたWHEREが出力されていないことがわかります。</p>
<h3 id="不要なカンマの除去"><a href="#不要なカンマの除去" class="headerlink" title="不要なカンマの除去"></a>不要なカンマの除去</h3><p>IF分岐を使って動的なSQLを構築する場合、カンマの有無が問題になる場合があります。<br>例えば以下のSQLでバインドパラメータ<code>detail=true</code>が指定された場合、<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="comment">/*IF detail*/</span></span><br><span class="line">,  FIRST_NAME</span><br><span class="line">,  LAST_NAME</span><br><span class="line">,  BIRTH_DATE</span><br><span class="line">,  GENDER</span><br><span class="line"><span class="comment">/*END*/</span></span><br><span class="line">,  EMP_NO</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line"><span class="comment">/*IF detail*/</span></span><br><span class="line">,  BIRTH_DATE</span><br><span class="line"><span class="comment">/*END*/</span></span><br><span class="line">,  EMP_NO</span><br></pre></td></tr></table></figure></p>
<p>生成されるSQLは以下になります。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">,  FIRST_NAME</span><br><span class="line">,  LAST_NAME</span><br><span class="line">,  BIRTH_DATE</span><br><span class="line">,  GENDER</span><br><span class="line">,  EMP_NO</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">,  BIRTH_DATE</span><br><span class="line">,  EMP_NO</span><br></pre></td></tr></table></figure></p>
<p>ここで<code>SELECT句</code>の直後や<code>ORDER BY句</code>の直後にカンマがあるとSQL文として不正になり、SQLの実行に失敗します。<br>これを避けるためuroboroSQLでは、生成後のSQLに含まれる不要なカンマを除去するようになっています。</p>
<p>実際に生成されるSQLは以下になります。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  FIRST_NAME     <span class="comment">-- 先頭のカンマが除去される</span></span><br><span class="line">,  LAST_NAME</span><br><span class="line">,  BIRTH_DATE</span><br><span class="line">,  GENDER</span><br><span class="line">,  EMP_NO</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  EMPLOYEE  EMP</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">  BIRTH_DATE     <span class="comment">-- 先頭のカンマが除去される</span></span><br><span class="line">,  EMP_NO</span><br></pre></td></tr></table></figure></p>
<p>カンマが除去されるのは、以下の予約語の直後にカンマが出現した場合です。</p>
<ul>
<li>SELECT</li>
<li>ORDER BY</li>
<li>GROUP BY</li>
<li>(</li>
<li>SET</li>
</ul>
<h2 id="OGNL式言語"><a href="#OGNL式言語" class="headerlink" title="OGNL式言語"></a>OGNL式言語</h2><p>uroboroSQLでは、条件分岐の式として<a href="https://github.com/jkuhnert/ognl" target="_blank" rel="noopener">OGNL式言語</a>を利用することができます。<br>条件分岐の式として使用する場合、評価結果が真偽値(true/false)になるように記述してください。</p>
<p>以下にOGNLの基本文法を提示します。<br>OGNL文法の詳細は<a href="https://commons.apache.org/proper/commons-ognl/language-guide.html" target="_blank" rel="noopener">こちら</a>を参照してください。</p>
<h3 id="リテラル"><a href="#リテラル" class="headerlink" title="リテラル"></a>リテラル</h3><p>以下のリテラルが使用できます。</p>
<ul>
<li>“a”(java.lang.String)</li>
<li>‘a’(char)</li>
<li>1(int)</li>
<li>1L(long)</li>
<li>0.1F(float)</li>
<li>0.1D(double)</li>
<li>0.1B(java.math.BigDecimal)</li>
<li>1H(java.math.BigInteger)</li>
<li>true, false(Boolean)</li>
<li>null</li>
</ul>
<h3 id="演算子"><a href="#演算子" class="headerlink" title="演算子"></a>演算子</h3><p>以下の演算子が使用できます。</p>
<h4 id="算術演算子"><a href="#算術演算子" class="headerlink" title="算術演算子"></a>算術演算子</h4><ul>
<li>e1 + e2(足し算)</li>
<li>e1 - e2 (引き算)</li>
<li>e1 * e2 (掛け算)</li>
<li>e1 / e2 (割り算)</li>
<li>e1 % e2 (余り)</li>
</ul>
<h4 id="比較演算子"><a href="#比較演算子" class="headerlink" title="比較演算子"></a>比較演算子</h4><ul>
<li>e1 eq e2, e1 == e2 (等しい)  <ul>
<li>e1・e2のいずれかがnullの場合、両方ともnullの時のみe1とe2は等しい</li>
<li>e1・e2が同じオブジェクトの場合、またはequals()メソッドにより等しいと判断される場合、e1とe2は等しい</li>
<li>e1・e2が数値の場合、倍精度浮動小数点数が等しい時のみe1とe2は等しい</li>
<li>その以外の場合、e1とe2は等しくない</li>
</ul>
</li>
<li>e1 neq e2, e1 != e2 (等しくない)</li>
<li>e1 lt e2, e1 &lt; e2 (小なり)</li>
<li>e1 lte e2, e1 &lt;= e2 (小なりイコール)</li>
<li>e1 gt e2, e1 &gt; e2 (大なり)</li>
<li>e1 gte e2, e1 &gt;= e2 (大なりイコール)</li>
</ul>
<h4 id="論理演算子"><a href="#論理演算子" class="headerlink" title="論理演算子"></a>論理演算子</h4><ul>
<li>e1 or e2, e1 || e2 (論理和)</li>
<li>e1 and e2, e1 &amp;&amp; e2 (論理積)</li>
<li>not e, ! e (論理否定)</li>
</ul>
<h4 id="連結演算子"><a href="#連結演算子" class="headerlink" title="連結演算子"></a>連結演算子</h4><ul>
<li>e1 + e2 (文字列連結)</li>
</ul>
<h4 id="メソッド・フィールドの呼び出し"><a href="#メソッド・フィールドの呼び出し" class="headerlink" title="メソッド・フィールドの呼び出し"></a>メソッド・フィールドの呼び出し</h4><p>以下のようにメソッド・フィールドの呼び出しができます。</p>
<ul>
<li>e.method(args) (メソッドの呼び出し)</li>
<li>e.property (フィールドの呼び出し)</li>
</ul>
<h4 id="StringFunction-SF"><a href="#StringFunction-SF" class="headerlink" title="StringFunction(SF)"></a>StringFunction(SF)</h4><p>uroboroSQLではOGNL式を利用する際、標準でStringFunction（SF）を使用することができます。<br>OGNL式と合わせてStringFunctionクラスのメソッドを呼び出すことができます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*IF SF.isNotEmpty(emp_no)*/</span></span><br><span class="line">   <span class="comment">-- emp_noがnull または ""でない場合に処理される</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br></pre></td></tr></table></figure>
<p>StringFunctionが提供するメソッドの一覧です。</p>
<table>
<thead>
<tr>
<th style="text-align:left">メソッド名</th>
<th style="text-align:left">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">booean SF.isEmpty(String str)</td>
<td style="text-align:left">対象文字列が空文字であること判定する</td>
</tr>
<tr>
<td style="text-align:left">boolean SF.isNotEmpty(String str)</td>
<td style="text-align:left">対象文字列が空文字でないことを判定する</td>
</tr>
<tr>
<td style="text-align:left">boolean SF.isBlank(String str)</td>
<td style="text-align:left">対象文字列が空文字、もしくは空白であること判定する</td>
</tr>
<tr>
<td style="text-align:left">boolean SF.isNotBlank(String str)</td>
<td style="text-align:left">対象文字列が空文字、もしくは空白でないこと判定する</td>
</tr>
<tr>
<td style="text-align:left">String SF.trim(String str)</td>
<td style="text-align:left">文字列の前後の空白を除去する。nullを渡した場合は結果もnullとなる</td>
</tr>
<tr>
<td style="text-align:left">String SF.trimToEmpty(String str)</td>
<td style="text-align:left">文字列の前後の空白を除去する。nullを渡した場合は空文字となる</td>
</tr>
<tr>
<td style="text-align:left">String SF.left(String str, int len)</td>
<td style="text-align:left">文字列の先頭から指定した文字数の文字列を取得する</td>
</tr>
<tr>
<td style="text-align:left">String SF.right(String str, int len)</td>
<td style="text-align:left">文字列の最後から指定した文字数の文字列を取得する</td>
</tr>
<tr>
<td style="text-align:left">String SF.mid(String str, int pos, int len)</td>
<td style="text-align:left">文字列の指定した位置から指定した文字数の文字列を取得する</td>
</tr>
<tr>
<td style="text-align:left">String SF.rightPad(String str, int size)</td>
<td style="text-align:left">文字列の末尾に空白を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String SF.rightPad(String str, int size, char padChar)</td>
<td style="text-align:left">文字列の末尾に指定した埋め込み文字を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String SF.leftPad(String str, int size)</td>
<td style="text-align:left">文字列の先頭に空白を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String SF.leftPad(String str, int size, char padChar)</td>
<td style="text-align:left">文字列の先頭に指定した埋め込み文字を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String[] SF.split(String str)</td>
<td style="text-align:left">文字列を空白で区切って配列に格納します。<br>nullが入力された場合はnullを返します</td>
</tr>
<tr>
<td style="text-align:left">String[] SF.split(String str, char separatorChar)</td>
<td style="text-align:left">文字列を指定した区切り文字で区切って配列に格納します。<br>nullが入力された場合はnullを返します</td>
</tr>
<tr>
<td style="text-align:left">String[] SF.split(String str, String separatorChars, int max)</td>
<td style="text-align:left">文字列を指定した区切り文字で区切って配列に格納します。<br>nullが入力された場合はnullを返します</td>
</tr>
<tr>
<td style="text-align:left">String SF.capitalize(String str)</td>
<td style="text-align:left">文字列の先頭文字を大文字にする</td>
</tr>
<tr>
<td style="text-align:left">String SF.uncapitalize(String str)</td>
<td style="text-align:left">文字列の先頭を小文字にする</td>
</tr>
</tbody>
</table>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>uroboroSQLを利用した基本的なDB操作を説明します。</p>
<h3 id="DB接続"><a href="#DB接続" class="headerlink" title="DB接続"></a>DB接続</h3><p>まず最初にSQLを発行するDBへの接続を行います。<br>DBに接続するためには<code>SqlConfig</code>インタフェースのインスタンスを生成する必要があります。</p>
<p><code>SqlConfig</code>インスタンスは<code>UroboroSQL</code>クラスのビルダーメソッドを使用して生成します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JDBC接続を行うSqlConfigの生成</span></span><br><span class="line"><span class="comment">// SqlConfig config = UroboroSQL.builder(url, user, password).build();</span></span><br><span class="line">SqlConfig config = UroboroSQL.builder(<span class="string">"jdbc:h2:mem:uroborosql"</span>, <span class="string">"sa"</span>, <span class="string">""</span>).build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// DataSourceを使用したDB接続を行うSqlConfigの生成</span></span><br><span class="line"><span class="comment">// SqlConfig config = UroboroSQL.builder(datasource).build();</span></span><br><span class="line">Context context = <span class="keyword">new</span> InitialContext();</span><br><span class="line">DataSource dataSource = context.lookup(<span class="string">"java:comp/env/jdbc/datasource"</span>);</span><br><span class="line">SqlConfig config = UroboroSQL.builder(dataSource).build();</span><br></pre></td></tr></table></figure>
<p><code>UroboroSQL</code>クラスを使って<code>SqlConfig</code>インスタンスを生成する際、uroboroSQLの動作を変更する各種の設定も合わせて行うことができます。<br>設定の詳細については<a href="../advanced">高度な操作</a>を参照してください。</p>
<blockquote>
<p><code>SqlConfig</code>インスタンスはアプリケーションで接続先毎に１つ保持するようにしてください。<br>SQL発行の都度生成すると、不要なインスタンスの生成やSQLロード処理が実行されます。</p>
</blockquote>
<h3 id="SqlAgentインスタンスの取得"><a href="#SqlAgentインスタンスの取得" class="headerlink" title="SqlAgentインスタンスの取得"></a>SqlAgentインスタンスの取得</h3><p>次にすべての操作の基点となる<code>SqlAgent</code>インタフェースのインスタンスを取得します。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  <span class="comment">// この中でSQLの操作を行う</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>SQLの操作はすべてこの<code>SqlAgent</code>インスタンスを使って行うことになります。</p>
<p><code>SqlAgent</code>インタフェースは<code>java.lang.AutoClosable</code>インタフェースを実装しており、上の例のように<code>try-with-resources</code>の中で宣言することで、終了時に自動的にclose処理が呼び出され、中で保持しているConnectionなどのリソースオブジェクトも正しくクローズされます。</p>
<h3 id="SQLファイルの管理"><a href="#SQLファイルの管理" class="headerlink" title="SQLファイルの管理"></a>SQLファイルの管理</h3><p>uroboroSQLではSQL文の書かれたファイルのパスを指定してSQLを実行することができます。<br>その際、SQLファイルはクラスパスから参照できる場所に配置されている必要があります。</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line"><span class="code">    └─main</span></span><br><span class="line"><span class="code">        └─resources</span></span><br><span class="line"><span class="code">            └─sql</span></span><br><span class="line"><span class="code">                ├─department</span></span><br><span class="line"><span class="code">                │    ├─insert_department.sql</span></span><br><span class="line"><span class="code">                │    └─select_department.sql</span></span><br><span class="line"><span class="code">                └─employee</span></span><br><span class="line"><span class="code">                     ├─insert_employee.sql</span></span><br><span class="line"><span class="code">                     └─select_employee.sql</span></span><br></pre></td></tr></table></figure>
<p>上のようなフォルダ構成の場合で、<code>src/main/resources/</code>がクラスパスに指定されている場合、<br>その下のsqlフォルダをルートフォルダとした相対パスでSQLファイルを指定することができます。  </p>
<p>それぞれのSQLファイルは以下のような<code>SQL名</code>となります</p>
<ul>
<li><code>insert_department.sql</code> -&gt; <code>department/insert_department</code></li>
<li><code>select_department.sql</code> -&gt; <code>department/select_department</code></li>
<li><code>insert_employee.sql</code> -&gt; <code>employee/insert_employee</code></li>
<li><code>select_employee.sql</code> -&gt; <code>employee/select_employee</code></li>
</ul>
<p>また、SQLファイルはjarの中にリソースとして含めることもできます。<br>その場合、リソースのルート直下のsqlフォルダをルートフォルダとした相対パスでSQLファイルを指定することができます。<br>SQLファイルのルートフォルダ（初期値：sql)は変更することができます。<br>変更方法の詳細は <a href="../advanced/#SQLファイルルートフォルダの設定">SQLファイルルートフォルダの設定</a> を参照してください。</p>
<h3 id="共通API"><a href="#共通API" class="headerlink" title="共通API"></a>共通API</h3><p>検索(<code>SqlQuery</code>)、更新(<code>SqlUpdate</code>)、バッチ更新(<code>SqlBatch</code>)、プロシージャ実行(<code>Procedure</code>)を行うクラスは、バインドパラメータや置換文字列の設定を行うためのAPI(<code>SqlFluent</code>)を実装しています。</p>
<p>バインドパラメータや置換文字列の設定はこのAPIを利用して設定を行ってください。<br>流れるAPI(Fluent API)を採用しているため、値の設定は連続して行うことができるようになっています。</p>
<p>パラメータ設定例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; department = agent.query(<span class="string">"department/select_department"</span>)</span><br><span class="line">  .param(<span class="string">"dept_no"</span>, <span class="number">1001</span>)</span><br><span class="line">  .param(<span class="string">"dept_name"</span>, <span class="string">"sales"</span>)</span><br><span class="line">  .first();</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">主なメソッド</th>
<th style="text-align:left">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SqlQuery#param(String key, Object value)</td>
<td style="text-align:left">バインドパラメータや置換文字列として使用するキーと値のセットを設定する</td>
</tr>
<tr>
<td style="text-align:left">SqlQuery#paramList(String key, Object… value)</td>
<td style="text-align:left">IN句のバインドパラメータに使用するキーと値のセットを設定する</td>
</tr>
<tr>
<td style="text-align:left">SqlQuery#paramMap(Map&lt;String, ?&gt; paramMap)</td>
<td style="text-align:left">引数のMapのKey/Valueのセットをパラメータに設定する</td>
</tr>
<tr>
<td style="text-align:left">SqlQuery#paramBean(Object bean)</td>
<td style="text-align:left">引数として渡されたObjectのフィールド名と値のセットをパラメータに設定する</td>
</tr>
</tbody>
</table>
<p>他にもパラメータの型に応じたパラメータ設定メソッドが提供されています。</p>
<h3 id="検索"><a href="#検索" class="headerlink" title="検索"></a>検索</h3><p>SQLを検索する方法は大きく２つあります。</p>
<ol>
<li><code>SQL名</code>を指定して検索</li>
<li><code>SQL文の文字列</code>を指定して検索</li>
</ol>
<p>1つ目の<code>SQL名</code>を指定する場合は、<a href="#SQLファイルの管理">SQLファイルの管理</a>で説明した<code>SQL名</code>を用いてSQLファイルを指定し、<code>SqlQuery</code>インタフェースのインスタンスを取得します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 検索結果の先頭１件をMapで取得</span></span><br><span class="line">Map&lt;String, Object&gt; employee = agent.query(<span class="string">"employee/select_employee"</span>)</span><br><span class="line">    .param(<span class="string">"emp_no"</span>, <span class="number">1001</span>)</span><br><span class="line">    .first();</span><br></pre></td></tr></table></figure>
<p>2つ目の<code>SQL文の文字列</code>を指定する場合は、<code>SqlAgent#queryWith(&quot;[SQL文字列]&quot;)</code>を使用して<code>SqlQuery</code>インタフェースのインスタンスを取得します。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// employeeテーブルの各行の名前の一覧を取得</span></span><br><span class="line">List&lt;String&gt; names = agent.queryWith(<span class="string">"select first_name, last_name where employee"</span>)</span><br><span class="line">    .stream()</span><br><span class="line">    .map(row -&gt; row.get(<span class="string">"first_name"</span>) + <span class="string">" "</span> + row.get(<span class="string">"last_name"</span>))</span><br><span class="line">    .collect(Collectors.toList());</span><br></pre></td></tr></table></figure></p>
<p><code>SQLQuery</code>インタフェースの主なAPIは以下になります。</p>
<h3 id="検索結果の取得"><a href="#検索結果の取得" class="headerlink" title="検索結果の取得"></a>検索結果の取得</h3><p>uroboroSQLを利用すると検索結果をいろいろな形で取得できます。<br>下記のSQLを例に説明します。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- department/select_department.sql</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="comment">/* _SQL_ID_ */</span></span><br><span class="line">  DEPT.DEPT_NO  <span class="keyword">AS</span>  DEPT_NO</span><br><span class="line">,  DEPT.DEPT_NAME  <span class="keyword">AS</span>  DEPT_NAME</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  DEPARTMENT  DEPT</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  <span class="number">1</span>        =  <span class="number">1</span></span><br><span class="line"><span class="comment">/*IF SF.isNotEmpty(dept_no)*/</span></span><br><span class="line"><span class="keyword">AND</span>  DEPT.DEPT_NO  =  <span class="comment">/*dept_no*/</span><span class="number">1</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br><span class="line"><span class="comment">/*IF SF.isNotEmpty(dept_name)*/</span></span><br><span class="line"><span class="keyword">AND</span>  DEPT.DEPT_NAME  =  <span class="comment">/*dept_name*/</span><span class="string">'sample'</span></span><br><span class="line"><span class="comment">/*END*/</span></span><br></pre></td></tr></table></figure>
<h3 id="リスト取得-collect"><a href="#リスト取得-collect" class="headerlink" title="リスト取得(collect)"></a>リスト取得(collect)</h3><ul>
<li>List&lt;Map&lt;String, Object&gt;&gt; SqlQuery#collect()</li>
<li>List&lt;Map&lt;String, Object&gt;&gt; SqlQuery#collect(CaseFormat)</li>
<li>List&lt;T&gt; SqlQuery#collect(Class&lt;T&gt;)</li>
</ul>
<p>検索結果をMapやエンティティクラスのListとして取得します。</p>
<p>個々のMapにはキー：カラムラベル名、値：カラムの値　の形で1行分のデータが格納されます。  </p>
<blockquote>
<p><code>SqlQuery#collect()</code>では検索結果をすべてメモリ上に格納するため、大量データの検索を行う場合は後述の<code>SqlQuery#strem()</code>の利用を検討してください。</p>
</blockquote>
<p>例 (引数なし)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  List&lt;Map&lt;String, Object&gt;&gt; departments =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).collect();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果(departments)</span></span><br><span class="line">[</span><br><span class="line"> &#123;<span class="string">"DEPT_NO"</span>=<span class="number">1001</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"sales"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"DEPT_NO"</span>=<span class="number">1002</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"export"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"DEPT_NO"</span>=<span class="number">1003</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"accounting"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"DEPT_NO"</span>=<span class="number">1004</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"personnel"</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>引数にCaseFormatを指定することで、Mapのキー名の書式を変更することができます。</p>
<p>例 (CaseFormat指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  List&lt;Map&lt;String, Object&gt;&gt; departments =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).collect(CaseFormat.CAMEL_CASE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果(departments)</span></span><br><span class="line">[</span><br><span class="line"> &#123;<span class="string">"deptNo"</span>=<span class="number">1001</span>, <span class="string">"deptName"</span>=<span class="string">"sales"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"deptNo"</span>=<span class="number">1002</span>, <span class="string">"deptName"</span>=<span class="string">"export"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"deptNo"</span>=<span class="number">1003</span>, <span class="string">"deptName"</span>=<span class="string">"accounting"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"deptNo"</span>=<span class="number">1004</span>, <span class="string">"deptName"</span>=<span class="string">"personnel"</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>CaseFormatを指定しない場合はデフォルトのCaseFormat（初期設定ではUPPER_SNAKE_CASE）で加工した値になります。<br>デフォルトのCaseFormatはSqlConfig生成時に変更することができます。<br>デフォルトCaseFormatの設定の詳細は <a href="../advanced/#SqlAgentの挙動設定">SqlAgentの挙動設定</a> を参照してください。<br>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスのListで取得することができます。</p>
<p>例 (Class指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Entity that can be mapped to department table</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> deptNo;</span><br><span class="line">  <span class="keyword">private</span> String deptName;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDeptNo</span><span class="params">()</span> </span>&#123;　<span class="keyword">return</span> <span class="keyword">this</span>.deptNo;　&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDeptNo</span><span class="params">(<span class="keyword">long</span> deptNo)</span> </span>&#123;　<span class="keyword">this</span>.deptNo = deptNo;　&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getDeptName</span><span class="params">()</span> </span>&#123;　<span class="keyword">return</span> <span class="keyword">this</span>.deptName;　&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDeptName</span><span class="params">(String deptName)</span> </span>&#123;　<span class="keyword">this</span>.deptName = deptName;　&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">・・・</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  List&lt;Department&gt; departments =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).collect(Department.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="先頭取得（first"><a href="#先頭取得（first" class="headerlink" title="先頭取得（first)"></a>先頭取得（first)</h3><ul>
<li>Map&lt;String, Object&gt; SqlQuery#first()</li>
<li>Map&lt;String, Object&gt; SqlQuery#first(CaseFormat)</li>
<li>T SqlQuery#first(Class&lt;T&gt;)</li>
</ul>
<p>検索結果の1件目を取得します。<br>結果を取得できない（検索結果が0件）場合、<code>jp.co.future.uroborosql.exception.DataNotFoundException</code>をスローします。<br>メモリ上には最大1件分のデータしか格納しないため、検索結果が大量になる場合でもメモリ使用量を気にせず呼び出すことができます。</p>
<p>例 (引数なし)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Map&lt;String, Object&gt; department =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).first();</span><br><span class="line">&#125; <span class="keyword">catch</span> (DataNotFoundException ex) &#123;</span><br><span class="line">  ex.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 結果(department)</span></span><br><span class="line"> &#123;<span class="string">"DEPT_NO"</span>=<span class="number">1001</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"sales"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>引数にCaseFormatを指定することで、Mapのキー名の書式を変更することができます。</p>
<p>例 (CaseFormat指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Map&lt;String, Object&gt; department =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).first(CaseFormat.CAMEL_CASE);</span><br><span class="line">&#125; <span class="keyword">catch</span> (DataNotFoundException ex) &#123;</span><br><span class="line">  ex.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果(department)</span></span><br><span class="line"> &#123;<span class="string">"deptNo"</span>=<span class="number">1001</span>, <span class="string">"deptName"</span>=<span class="string">"sales"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p>
<p>例 (Class指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Department department =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).first(Department.class);</span><br><span class="line">&#125; <span class="keyword">catch</span> (DataNotFoundException ex) &#123;</span><br><span class="line">  ex.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="先頭取得（findFirst"><a href="#先頭取得（findFirst" class="headerlink" title="先頭取得（findFirst)"></a>先頭取得（findFirst)</h3><ul>
<li>Optional&lt;Map&lt;String, Object&gt;&gt; SqlQuery#findFirst()</li>
<li>Optional&lt;Map&lt;String, Object&gt;&gt; SqlQuery#findFirst(CaseFormat)</li>
<li>Optional&lt;T&gt; SqlQuery#findFirst(Class&lt;T&gt;)</li>
</ul>
<p>検索結果の1件目をOptionalの形式で取得します。<br>メモリ上には最大1件分のデータしか格納しないため、検索結果が大量になる場合でもメモリ使用量を気にせず呼び出すことができます。</p>
<p>例 (引数なし)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Optional&lt;Map&lt;String, Object&gt;&gt; department =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).findFirst();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果(department)</span></span><br><span class="line"> &#123;<span class="string">"DEPT_NO"</span>=<span class="number">1001</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"sales"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>引数にCaseFormatを指定することで、Mapのキー名の書式を変更することができます。</p>
<p>例 (CaseFormat指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Optional&lt;Map&lt;String, Object&gt;&gt; department =</span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).findFirst(CaseFormat.CAMEL_CASE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果(department)</span></span><br><span class="line"> &#123;<span class="string">"deptNo"</span>=<span class="number">1001</span>, <span class="string">"deptName"</span>=<span class="string">"sales"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p>
<p>例 (Class指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Department department = </span><br><span class="line">    agent.query(<span class="string">"department/select_department"</span>).findFirst(Department.class).orElse(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Stream取得-stream"><a href="#Stream取得-stream" class="headerlink" title="Stream取得(stream)"></a>Stream取得(stream)</h3><ul>
<li>Stream&lt;Map&lt;String, Object&gt;&gt; SqlQuery#stream()</li>
<li>Stream&lt;Map&lt;String, Object&gt;&gt; SqlQuery#stream(CaseFormat)</li>
<li>Stream&lt;T&gt; SqlQuery#stream(Class&lt;T&gt;)</li>
<li>Stream&lt;T&gt; SqlQuery#stream(ResultSetConverter&lt;T&gt;)</li>
</ul>
<p>検索結果をJava8で追加された<code>java.util.stream.Stream</code>の形式で取得します。</p>
<p>Streamによる順次読み込みと終端操作までの遅延処理により、メモリ効率の良い操作が可能になります。</p>
<p>例 (引数なし)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  agent.query(<span class="string">"department/select_department"</span>).stream()</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果</span></span><br><span class="line">&#123;<span class="string">"DEPT_NO"</span>=<span class="number">1001</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"sales"</span>&#125;</span><br><span class="line">&#123;<span class="string">"DEPT_NO"</span>=<span class="number">1002</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"export"</span>&#125;</span><br><span class="line">&#123;<span class="string">"DEPT_NO"</span>=<span class="number">1003</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"accounting"</span>&#125;</span><br><span class="line">&#123;<span class="string">"DEPT_NO"</span>=<span class="number">1004</span>, <span class="string">"DEPT_NAME"</span>=<span class="string">"personnel"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>引数にCaseFormatを指定することで、Mapのキー名の書式を変更することができます。</p>
<p>例 (CaseFormat指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  agent.query(<span class="string">"department/select_department"</span>).stream(CaseFormat.PASCAL_CASE)</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果</span></span><br><span class="line">&#123;<span class="string">"DeptNo"</span>=<span class="number">1001</span>, <span class="string">"DeptName"</span>=<span class="string">"sales"</span>&#125;</span><br><span class="line">&#123;<span class="string">"DeptNo"</span>=<span class="number">1002</span>, <span class="string">"DeptName"</span>=<span class="string">"export"</span>&#125;</span><br><span class="line">&#123;<span class="string">"DeptNo"</span>=<span class="number">1003</span>, <span class="string">"DeptName"</span>=<span class="string">"accounting"</span>&#125;</span><br><span class="line">&#123;<span class="string">"DeptNo"</span>=<span class="number">1004</span>, <span class="string">"DeptName"</span>=<span class="string">"personnel"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>引数にエンティティクラスを指定すると、検索結果をエンティティクラスのインスタンスの形で取得することができます。</p>
<p>例 (Class指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  agent.query(<span class="string">"department/select_department"</span>).stream(Department.class)</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>jp.co.future.uroborosql.converter.ResultSetConverter</code>インタフェースを実装したクラスを引数に渡すことで、検索結果により複雑な加工を行うことができます。<br><code>ResultSetConverter</code>はFunctionInterfaceとして提供されているので、lamdbaも利用できます。</p>
<p>例 (ResultSetConverter指定)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  <span class="comment">// ResultSetConverterはlamdbaで指定可能</span></span><br><span class="line">  agent.query(<span class="string">"department/select_department"</span>).stream(rs -&gt; &#123;</span><br><span class="line">    Map&lt;String, Object&gt; row = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    row.put(<span class="string">"deptNo"</span>, rs.getObject(<span class="string">"DEPT_NO"</span>));</span><br><span class="line">    row.put(<span class="string">"deptName"</span>, rs.getObject(<span class="string">"DEPT_NAME"</span>));</span><br><span class="line">    <span class="keyword">return</span> row;</span><br><span class="line">  &#125;).forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 結果</span></span><br><span class="line">&#123;<span class="string">"deptNo"</span>=<span class="number">1001</span>, <span class="string">"deptName"</span>=<span class="string">"sales"</span>&#125;</span><br><span class="line">&#123;<span class="string">"deptNo"</span>=<span class="number">1002</span>, <span class="string">"deptName"</span>=<span class="string">"export"</span>&#125;</span><br><span class="line">&#123;<span class="string">"deptNo"</span>=<span class="number">1003</span>, <span class="string">"deptName"</span>=<span class="string">"accounting"</span>&#125;</span><br><span class="line">&#123;<span class="string">"deptNo"</span>=<span class="number">1004</span>, <span class="string">"deptName"</span>=<span class="string">"personnel"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>【注意】</strong> 戻り値として取得されるStreamインスタンスは内部にResultSetリソースを保持しています。このResultSetはデータを最後まで読み込むかStream#close()が呼ばれた際にリソースのクローズを行います。(Stream#onClose()にResultSetリソースのcloseHandlerが登録されています)<br>そのため、取得したStreamでは全データを扱う終端処理(collectなど)を行うか、try-with-resourcesの利用やStream#close()の明示的な呼び出しによりStreamのクローズを行わないとResultSetリソースがクローズされずカーソルのリークが発生します。</p>
</blockquote>
<p>例 (Streamのクローズ)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  <span class="keyword">try</span> (Stream&lt;Map&lt;String, Object&gt;&gt; stream = agent.query(<span class="string">"department/select_department"</span>).stream()) &#123;</span><br><span class="line">    <span class="comment">// Stream#findFirst() はStream内のResultSetリソースをクローズしないので、try-with-resourcesでStreamをクローズする</span></span><br><span class="line">    stream.findFirst().ifPresent(System.out::println);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ResultSet取得-resultSet"><a href="#ResultSet取得-resultSet" class="headerlink" title="ResultSet取得(resultSet)"></a>ResultSet取得(resultSet)</h3><ul>
<li>ResultSet SqlQuery#resultSet()</li>
</ul>
<p>検索結果を<code>java.sql.ResultSet</code>の形式で取得します。</p>
<blockquote>
<p>ResultSetリソースのクローズは各自で行ってください。</p>
</blockquote>
<p>このAPIは他のフレームワークとの連携など、ResultSetリソースの取得が必要なケースを想定して提供しています。<br>ResultSetリソースの取得が必要でなければ、ResultSetリソースのクローズが管理されている他のAPIの利用を検討してください。</p>
<p>例 (resultSet)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  <span class="keyword">try</span> (ResultSet rs = agent.query(<span class="string">"department/select_department"</span>).resultSet()) &#123;</span><br><span class="line">    <span class="comment">// try-with-resourcesでResultSetをクローズする</span></span><br><span class="line">    <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">      <span class="comment">// ResultSetからの値取得</span></span><br><span class="line">      ・・・</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>DB更新処理(登録/変更/削除)も検索処理と同様<code>SQL名</code>を指定する場合と直接<code>SQL文字列</code>を記述する２つのAPIが提供されています。<br><code>agent#update()</code> もしくは <code>agent#updateWith()</code>を使用してSqlUpdateインタフェースのインスタンスを取得します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// １件挿入(SQL名指定)</span></span><br><span class="line"><span class="keyword">int</span> count = agent.update(<span class="string">"department/insert_department"</span>)</span><br><span class="line">  .param(<span class="string">"dept_no"</span>, <span class="number">1111</span>)</span><br><span class="line">  .param(<span class="string">"dept_name"</span>, <span class="string">"Sales"</span>)</span><br><span class="line">  .count();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新(SQL文字列指定)</span></span><br><span class="line"><span class="keyword">int</span> count = agent.updateWith(<span class="string">"update employee set first_name = /*first_name*/ where emp_no = /*emp_no*/"</span>)</span><br><span class="line">  .param(<span class="string">"emp_no"</span>, <span class="number">1001</span>)</span><br><span class="line">  .param(<span class="string">"first_name"</span>, <span class="string">"Bob"</span>)</span><br><span class="line">  .count();</span><br></pre></td></tr></table></figure>
<p><code>SqlUpdate</code>インタフェースの主なAPIは以下になります。</p>
<h3 id="更新の実行"><a href="#更新の実行" class="headerlink" title="更新の実行"></a>更新の実行</h3><ul>
<li>int SqlUpdate#count()</li>
</ul>
<p>更新処理を行い、登録、更新、削除を行った行数を返します。</p>
<p>例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  <span class="comment">// insert</span></span><br><span class="line">  agent.update(<span class="string">"department/insert_department"</span>)</span><br><span class="line">    .param(<span class="string">"dept_no"</span>, <span class="number">1001</span>)</span><br><span class="line">    .param(<span class="string">"dept_name"</span>, <span class="string">"sales"</span>)</span><br><span class="line">    .count();</span><br><span class="line">  <span class="comment">// update</span></span><br><span class="line">  agent.update(<span class="string">"department/update_department"</span>)</span><br><span class="line">    .param(<span class="string">"dept_no"</span>, <span class="number">1001</span>)</span><br><span class="line">    .param(<span class="string">"dept_name"</span>, <span class="string">"HR"</span>)</span><br><span class="line">    .count();</span><br><span class="line">  <span class="comment">// delete</span></span><br><span class="line">  agent.update(<span class="string">"department/delete_department"</span>)</span><br><span class="line">    .param(<span class="string">"dept_no"</span>, <span class="number">1001</span>)</span><br><span class="line">    .count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="バッチ更新"><a href="#バッチ更新" class="headerlink" title="バッチ更新"></a>バッチ更新</h3><p>大量のデータを一括で更新する場合、通常の更新では都度SQLが発行されるため処理速度が遅く問題になる場合があります。<br>こういったケースに対応するため、uroboroSQLではバッチ更新用のAPIを提供しています。</p>
<p>バッチ更新処理も他と同様<code>SQL名</code>を指定する場合と直接<code>SQL文字列</code>を記述する２つのAPIが提供されています。<br><code>agent#batch()</code> もしくは <code>agent#batchWith()</code>を使用してSqlBatchインタフェースのインスタンスを取得します。</p>
<p>SqlBatchインタフェースでは、SqlFluent インタフェースによるバインドパラメータの設定とは別に<code>java.util.stream.Stream</code>を用いたバッチパラメータの設定を行うAPIが提供されています。</p>
<ul>
<li>SqlBatch SqlBatch#paramStream(Stream&lt;Map&lt;String, Object&gt;&gt;)</li>
</ul>
<p>引数にはバッチの各行にバインドするキーと値のセットを持つMapを返すStreamを設定します。</p>
<h3 id="バッチ更新の実行"><a href="#バッチ更新の実行" class="headerlink" title="バッチ更新の実行"></a>バッチ更新の実行</h3><ul>
<li>int SqlBatch#count()</li>
</ul>
<p>バッチ更新処理を行い、登録、更新、削除を行った行数を返します。</p>
<p>例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// バッチ処理の実行</span></span><br><span class="line"><span class="keyword">int</span> deptCount = agent.batch(<span class="string">"department/insert_department"</span>)</span><br><span class="line">  <span class="comment">// 指定したファイルからMap&lt;String, Object&gt;のStreamを生成し、バッチ処理のパラメータとして指定する</span></span><br><span class="line">  .paramStream(getDataByFile(Paths.get(<span class="string">"data/department.tsv"</span>)))</span><br><span class="line">  .count();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Stream&lt;Map&lt;String, Object&gt;&gt; getDataByFile(<span class="keyword">final</span> Path filePath) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    List&lt;String&gt; lines = Files.readAllLines(filePath);</span><br><span class="line">    String[] header = lines.get(<span class="number">0</span>).split(<span class="string">"\\t"</span>);</span><br><span class="line">    <span class="keyword">return</span> lines.stream()</span><br><span class="line">        .skip(<span class="number">1</span>)</span><br><span class="line">        .map(s -&gt; s.split(<span class="string">"\\t"</span>))</span><br><span class="line">        .map(data -&gt; IntStream.range(<span class="number">0</span>, header.length)</span><br><span class="line">            .&lt;Map&lt;String, Object&gt;&gt; collect(HashMap::<span class="keyword">new</span>, (row, i) -&gt; row.put(header[i], data[i]),</span><br><span class="line">                Map::putAll));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UncheckedIOException(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>data/department.tsv　の内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dept_no  dept_name</span><br><span class="line">1001  sales</span><br><span class="line">1002  export</span><br><span class="line">1003  accounting</span><br><span class="line">1004  personnel</span><br></pre></td></tr></table></figure></p>
<p>バッチパラメータにQueryの結果を指定することで疑似的に<code>SELECT-INSERT</code> / <code>SELECT-UPDATE</code> / <code>SELECT-DELETE</code>を行うことができます。<br>Streamを利用することで検索結果の件数が多い場合でも、少ないメモリ使用量でバッチ処理を行うことができます。</p>
<p>例(SELECT-UPDATE)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> updateCount = agent.batch(<span class="string">"department/update_department"</span>)</span><br><span class="line">  .paramStream(agent.query(<span class="string">"department/select_department"</span>)</span><br><span class="line">    .stream(CaseFormat.LOWER_SNAKE_CASE).map(e -&gt; &#123;</span><br><span class="line">      Map&lt;String, Object&gt; ans = <span class="keyword">new</span> HashMap&lt;&gt;(e);</span><br><span class="line">      ans.replaceAll((k, v) -&gt; v != <span class="keyword">null</span> ? v.toString() + <span class="string">"_after"</span> : <span class="string">"after"</span>);</span><br><span class="line">      <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;))</span><br><span class="line">  .count();</span><br></pre></td></tr></table></figure></p>
<h3 id="バッチSQL発行動作のカスタマイズ"><a href="#バッチSQL発行動作のカスタマイズ" class="headerlink" title="バッチSQL発行動作のカスタマイズ"></a>バッチSQL発行動作のカスタマイズ</h3><p>SqlBatchインタフェースにはバッチSQL発行時の動作を変更するためのAPIが提供されています。</p>
<table>
<thead>
<tr>
<th style="text-align:left">メソッド</th>
<th style="text-align:left">説明</th>
<th style="text-align:left">デフォルト値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">by(BiPredicate&lt;SqlContext, Map&lt;String, Object&gt;&gt;)</td>
<td style="text-align:left">バッチSQLの発行条件を指定します。<br>BiPredicateの結果がtrueの場合にバッチSQLを発行します。</td>
<td style="text-align:left">1000件毎</td>
</tr>
<tr>
<td style="text-align:left">batchWhen(BiConsumer&lt;SqlAgent, SqlContext&gt;)</td>
<td style="text-align:left">バッチSQLの発行タイミングで行う操作を指定します。</td>
<td style="text-align:left">何もしない</td>
</tr>
<tr>
<td style="text-align:left">errorWhen(TriConsumer&lt;SqlAgent, SqlContext, Exception&gt;)</td>
<td style="text-align:left">バッチSQLの発行で例外が発生した時の動作を指定します。</td>
<td style="text-align:left"><code>UroborosqlRuntimeException</code>をスローする</td>
</tr>
</tbody>
</table>
<p>これらのAPIを利用することでより柔軟なSQL発行が可能になります。</p>
<p>例(バッチSQL発行時動作のカスタマイズ)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt; inputData = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">// 中略　入力データ作成</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  agent.batch(<span class="string">"department/insert_department"</span>)</span><br><span class="line">    .paramStream(inputData.stream())</span><br><span class="line">    .by((ctx, row) -&gt; ctx.batchCount() == <span class="number">10</span>)  <span class="comment">// 10件毎にSQL発行</span></span><br><span class="line">    .batchWhen((agent, ctx) -&gt; agent.commit())  <span class="comment">// SQL発行が成功したらコミットする</span></span><br><span class="line">    .errorWhen((agent, ctx, ex) -&gt; &#123;</span><br><span class="line">      log.error(<span class="string">"error occured. ex:&#123;&#125;"</span>, ex.getMessage());</span><br><span class="line">    &#125;)  <span class="comment">// 例外が発生したらログ出力する</span></span><br><span class="line">    .count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="プロシージャの実行"><a href="#プロシージャの実行" class="headerlink" title="プロシージャの実行"></a>プロシージャの実行</h3><p>uroboroSQLでは、SQLの検索/更新のほかDBが提供するストアドプロシージャの呼び出し用APIも提供しています。</p>
<p>ストアドプロシージャの呼出は<code>SQL名</code>を指定する場合と直接<code>ストアドプロシージャ文字列</code>を記述する２つのAPIが提供されています。<br><code>agent#proc()</code> もしくは <code>agent#procWith()</code>を使用してProcedureインタフェースのインスタンスを取得します。</p>
<p>###　ストアドプロシージャの実行</p>
<ul>
<li>Map&lt;String, Object&gt; Procedure#call()</li>
</ul>
<p>ストアドプロシージャからの戻り値を取得する場合は　<code>SqlFluent#outParam()</code>でパラメータを指定します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Procedureインタフェースのインスタンスを取得</span></span><br><span class="line">Map&lt;String, Object&gt; result = agent.procWith(<span class="string">"&#123;call product_id_exist_check(/*product_id*/, /*check_out*/)&#125;"</span>)</span><br><span class="line">  .param(<span class="string">"product_id"</span>, <span class="number">0</span>)</span><br><span class="line">  .outParam(<span class="string">"check_out"</span>, java.sql.JDBCType.NUMERIC)</span><br><span class="line">  .call();</span><br><span class="line"><span class="comment">// outParamメソッドで指定したパラメータの値(戻り値)を取得</span></span><br><span class="line">BigDecimal checkOut = (BigDecimal)result.get(<span class="string">"check_out"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="DAOインタフェース"><a href="#DAOインタフェース" class="headerlink" title="DAOインタフェース"></a>DAOインタフェース</h3><p>uroboroSQLはDAO(Data Access Object)を用いた単一テーブルへのCRUDに対応しています。</p>
<p>下記のテーブルとそれに対応するエンティティクラスがあるとします。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employee (</span><br><span class="line">  emp_no <span class="built_in">number</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">  , first_name <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">  , last_name <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">  , birth_date <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">  , gender <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">  , lock_version <span class="built_in">number</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">  , <span class="keyword">constraint</span> employee_PKC primary <span class="keyword">key</span> (emp_no)</span><br><span class="line">) ;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> empNo;</span><br><span class="line">  <span class="keyword">private</span> String firstName;</span><br><span class="line">  <span class="keyword">private</span> String lastName;</span><br><span class="line">  <span class="keyword">private</span> LocalDate birthDate;</span><br><span class="line">  <span class="keyword">private</span> Gender gender;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> lockVersion = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 中略 getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SELECT-主キー検索"><a href="#SELECT-主キー検索" class="headerlink" title="SELECT (主キー検索)"></a>SELECT (主キー検索)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Employee employee = agent.find(Employee.class, <span class="number">1001</span>).orElse(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">  employee.setEmpNo(<span class="number">1002</span>);</span><br><span class="line">  employee.setFirstName(<span class="string">"Susan"</span>);</span><br><span class="line">  employee.setLastName(<span class="string">"Davis"</span>);</span><br><span class="line">  employee.setBirthDate(LocalDate.of(<span class="number">1969</span>, <span class="number">2</span>, <span class="number">10</span>));</span><br><span class="line">  employee.setGender(Gender.FEMALE); <span class="comment">// MALE("M"), FEMALE("F"), OTHER("O")</span></span><br><span class="line"></span><br><span class="line">  agent.insert(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Employee employee = agent.find(Employee.class, <span class="number">1001</span>).orElseThrow(Exception::<span class="keyword">new</span>);</span><br><span class="line">  employee.setLastName(<span class="string">"Wilson"</span>);</span><br><span class="line"></span><br><span class="line">  agent.update(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Employee employee = agent.find(Employee.class, <span class="number">1001</span>).orElseThrow(Exception::<span class="keyword">new</span>);</span><br><span class="line"></span><br><span class="line">  agent.delete(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="一括INSERT"><a href="#一括INSERT" class="headerlink" title="一括INSERT"></a>一括INSERT</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlAgent agent = config.agent()) &#123;</span><br><span class="line">  Stream&lt;Employee&gt; employees;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  agent.inserts(employees);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Entityアノテーション"><a href="#Entityアノテーション" class="headerlink" title="Entityアノテーション"></a>Entityアノテーション</h4><p>DAOインタフェースで利用するエンティティクラスではテーブルとのマッピングを行うためにアノテーションを利用することができます。</p>
<h5 id="Table"><a href="#Table" class="headerlink" title="@Table"></a>@Table</h5><p>エンティティクラスに紐づけるテーブル名を指定します。<br>テーブル名と名前が一致しないエンティティクラスにマッピングしたい場合に利用します。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性名</th>
<th style="text-align:left">型</th>
<th style="text-align:left">説明</th>
<th style="text-align:left">初期値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">name</td>
<td style="text-align:left">String</td>
<td style="text-align:left">マッピングするテーブル名</td>
<td style="text-align:left">なし</td>
</tr>
</tbody>
</table>
<p>例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jp.co.future.uroborosql.mapping.annotations.Table;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"employee"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomEmployee</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 以下略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Column"><a href="#Column" class="headerlink" title="@Column"></a>@Column</h5><p>フィールドに紐づけるカラム名を指定します。<br>カラム名と名前が一致しないフィールドにマッピングしたい場合に利用します。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性名</th>
<th style="text-align:left">型</th>
<th style="text-align:left">説明</th>
<th style="text-align:left">初期値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">name</td>
<td style="text-align:left">String</td>
<td style="text-align:left">マッピングするカラム名</td>
<td style="text-align:left">なし</td>
</tr>
</tbody>
</table>
<p>例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jp.co.future.uroborosql.mapping.annotations.Column;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Column</span>(name = <span class="string">"empNo"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> employeeNo;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以下略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Domain"><a href="#Domain" class="headerlink" title="@Domain"></a>@Domain</h5><p>独自に作成した型(ドメインクラス)のフィールドにカラムをマッピングする場合に指定します。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性名</th>
<th style="text-align:left">型</th>
<th style="text-align:left">説明</th>
<th style="text-align:left">初期値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">valueType</td>
<td style="text-align:left">Class&lt;?&gt;</td>
<td style="text-align:left">ドメインクラスを生成するのに必要な値の型</td>
<td style="text-align:left">なし</td>
</tr>
<tr>
<td style="text-align:left">factoryMethod</td>
<td style="text-align:left">String</td>
<td style="text-align:left">ドメインクラスを生成・取得するメソッド名<br>指定しない場合はコンストラクタが呼び出される。</td>
<td style="text-align:left">“”</td>
</tr>
<tr>
<td style="text-align:left">toJdbcMethod</td>
<td style="text-align:left">String</td>
<td style="text-align:left">JDBCが受け付けられる値に変換するメソッド名</td>
<td style="text-align:left">“getValue”</td>
</tr>
<tr>
<td style="text-align:left">nullable</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left">null可かどうかの指定</td>
<td style="text-align:left">false</td>
</tr>
</tbody>
</table>
<p>例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jp.co.future.uroborosql.mapping.annotations.Domain;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Domain</span>(valueType = String.class, factoryMethod = <span class="string">"of"</span>, toJdbcMethod = <span class="string">"getName"</span>, nullable = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NameDomain</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">NameDomain</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> NameDomain <span class="title">of</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> NameDomain(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> empNo;</span><br><span class="line">  <span class="keyword">private</span> NameDomain firstName;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以下略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Transient"><a href="#Transient" class="headerlink" title="@Transient"></a>@Transient</h5><p>フィールドとカラムのマッピング対象から除外します。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性名</th>
<th style="text-align:left">型</th>
<th style="text-align:left">説明</th>
<th style="text-align:left">初期値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">insert</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left"><code>agent#insert()</code>実行時にフィールドを無視するかどうか。<br><code>true</code>の場合は無視する。</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">update</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left"><code>agent#update()</code>実行時にフィールドを無視するかどうか。<br><code>true</code>の場合は無視する。</td>
<td style="text-align:left">true</td>
</tr>
</tbody>
</table>
<p>例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jp.co.future.uroborosql.mapping.annotations.Transient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 途中略</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transient</span></span><br><span class="line">  <span class="keyword">private</span> String memo; <span class="comment">// 常に無視</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transient</span>(insert = <span class="keyword">false</span>, update = <span class="keyword">true</span>)</span><br><span class="line">  <span class="keyword">private</span> LocalDate creationDate; <span class="comment">// insert時は対象、update時は無視</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transient</span>(insert = <span class="keyword">true</span>, update = <span class="keyword">false</span>)</span><br><span class="line">  <span class="keyword">private</span> LocalDate updateDate;  <span class="comment">// insert時は無視、update時は対象</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以下略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Version"><a href="#Version" class="headerlink" title="@Version"></a>@Version</h5><p>このアノテーションが付与されたフィールドは楽観ロック用のバージョン情報を保持するフィールドになります。<br>UPDATE時にはSET句で+1され、WHERE句の検索条件に追加されてSQLを発行し、更新件数が0の場合には<code>OptimisticLockException</code>を発生させます。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性名</th>
<th style="text-align:left">型</th>
<th style="text-align:left">説明</th>
<th style="text-align:left">初期値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">なし</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
</tr>
</tbody>
</table>
<p>例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jp.co.future.uroborosql.mapping.annotations.Version;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> empNo;</span><br><span class="line">  <span class="keyword">private</span> String firstName;</span><br><span class="line">  <span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">　　<span class="comment">// 途中略</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@version</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> lockVersion = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以下略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="トランザクション"><a href="#トランザクション" class="headerlink" title="トランザクション"></a>トランザクション</h2><p>uroboroSQLではローカルトランザクションを提供します。<br>トランザクションを利用することで、エラー発生時でも一部のデータだけ登録を成功させるといった細かな制御ができるようになります。</p>
<h3 id="トランザクションの開始と終了"><a href="#トランザクションの開始と終了" class="headerlink" title="トランザクションの開始と終了"></a>トランザクションの開始と終了</h3><p>uroboroSQLで提供するトランザクションのレベルは以下の3つです</p>
<table>
<thead>
<tr>
<th style="text-align:left">トランザクションタイプ</th>
<th style="text-align:left">トランザクション有り</th>
<th style="text-align:left">トランザクションなし</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">required</td>
<td style="text-align:left">トランザクション内で処理を実行</td>
<td style="text-align:left">新たなトランザクションを開始して処理を実行</td>
</tr>
<tr>
<td style="text-align:left">requiresNew</td>
<td style="text-align:left">既存のトランザクションを停止し、新たなトランザクションを開始して処理を実行。<br>トランザクションが終了すると停止していたトランザクションを再開させる</td>
<td style="text-align:left">新たなトランザクションを開始して処理を実行</td>
</tr>
<tr>
<td style="text-align:left">notSupported</td>
<td style="text-align:left">既存のトランザクションを停止し、トランザクション外で処理を実行。<br>処理が終了すると停止していたトランザクションを再開させる</td>
<td style="text-align:left">トランザクション外で処理を実行</td>
</tr>
</tbody>
</table>
<p><code>SqlAgent</code>インタフェースにトランザクションタイプに応じたメソッドが提供されており、そのメソッドを呼び出すことでトランザクションの開始と終了を制御します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">agent.required(() -&gt; &#123;</span><br><span class="line">  <span class="comment">// トランザクション開始</span></span><br><span class="line">  agent.updateWith(<span class="string">"insert into employee (emp_no) values (/*emp_no*/1001)"</span>)</span><br><span class="line">    .param(<span class="string">"emp_no"</span>, <span class="number">1001</span>)</span><br><span class="line">    .count();</span><br><span class="line"></span><br><span class="line">  agent.requiresNew(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// 新しい トランザクション開始</span></span><br><span class="line">    agent.updateWith(<span class="string">"insert into department (dept_no, dept_name) values (/*dept_no*/1111, /*dept_name*/'Sales')"</span>)</span><br><span class="line">      .param(<span class="string">"dept_no"</span>, <span class="number">1002</span>)</span><br><span class="line">      .param(<span class="string">"dept_name"</span>, <span class="string">"export"</span>)</span><br><span class="line">      .count();</span><br><span class="line">    <span class="comment">// 新しい トランザクション終了 commit</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// トランザクション終了 commit</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="コミットとロールバック"><a href="#コミットとロールバック" class="headerlink" title="コミットとロールバック"></a>コミットとロールバック</h3><p>トランザクションのlamdba式が正常に終了すればトランザクションはコミットされます。<br>トランザクションのlamdba式が例外をスローした場合はトランザクションをロールバックします。<br>例外をスローせずに明示的にロールバックを行う場合は<code>SqlAgent#setRollbackOnly()</code>を呼び出します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">agent.required(() -&gt; &#123;</span><br><span class="line">  <span class="comment">// トランザクション開始</span></span><br><span class="line">  agent.updateWith(<span class="string">"insert into employee (emp_no) values (/*emp_no*/1001)"</span>)</span><br><span class="line">    .param(<span class="string">"emp_no"</span>, <span class="number">1001</span>)</span><br><span class="line">    .count();</span><br><span class="line"></span><br><span class="line">  agent.requiresNew(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// 新しい トランザクション開始</span></span><br><span class="line">    agent.updateWith(<span class="string">"insert into department (dept_no, dept_name) values (/*dept_no*/1111, /*dept_name*/'Sales')"</span>)</span><br><span class="line">      .param(<span class="string">"dept_no"</span>, <span class="number">1002</span>)</span><br><span class="line">      .param(<span class="string">"dept_name"</span>, <span class="string">"export"</span>)</span><br><span class="line">      .count();</span><br><span class="line">    <span class="comment">// 新しい トランザクション終了 明示的なrollback</span></span><br><span class="line">    agent.setRollbackOnly();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// トランザクション終了 commit</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="セーブポイント"><a href="#セーブポイント" class="headerlink" title="セーブポイント"></a>セーブポイント</h3><p>トランザクション内でセーブポイントを設けることで、トランザクション内の特定の更新のみ取り消すといった細かな制御ができます。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">agent.required(() -&gt; &#123;</span><br><span class="line">  <span class="comment">// トランザクション開始</span></span><br><span class="line">  agent.update(<span class="string">"employee/insert_employee"</span>)</span><br><span class="line">    .param(<span class="string">"emp_no"</span>, <span class="number">1001</span>)</span><br><span class="line">    .count();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// セーブポイント(名前:sp)の設定</span></span><br><span class="line">  agent.setSavepoint(<span class="string">"sp"</span>);</span><br><span class="line">  agent.update(<span class="string">"employee/insert_employee"</span>)</span><br><span class="line">    .param(<span class="string">"emp_no"</span>, <span class="number">1002</span>)</span><br><span class="line">    .count();</span><br><span class="line"></span><br><span class="line">  assertThat(agent.query(<span class="string">"employee/select_employee"</span>).collect().size(), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最後のinsertを取消(セーブポイント(名前:sp)までロールバック)</span></span><br><span class="line">  agent.rollback(<span class="string">"sp"</span>);</span><br><span class="line"></span><br><span class="line">  assertThat(agent.query(<span class="string">"employee/select_employee"</span>).collect().size(), <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<div style="font-size:130%; font-weight:bold;"><br>  <a href="../getting_started" style="float:left">&#60;&#60; Getting Started</a><a href="../advanced" style="float:right">高度な操作 &#62;&#62;</a><br></div>


<!-- Tags -->



<div class="tags">
    
</div>



<!-- Comments -->
<div>
    


</div>



            </div>
        </div>

        <!-- Footer -->
<footer id="footer">
  <div class="inner">
      <div>
        <h2>Share</h2>
        <ul class="sns-area">
          <li>
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="https://future-architect.github.io/uroborosql-doc/">Tweet</a>
            <script>
            ! function(d, s, id) {
              var js, fjs = d.getElementsByTagName(s)[0],
                p = /^http:/.test(d.location) ? 'http' : 'https';
              if (!d.getElementById(id)) { js = d.createElement(s);
                js.id = id;
                js.src = p + '://platform.twitter.com/widgets.js';
                fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');

            </script>
          </li>
          <li>
            <iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Ffuture-architect.github.io%2Furoborosql-doc%2F&width=130&layout=button_count&action=like&size=small&show_faces=true&share=true&height=46&appId=316260158574612" width="130" height="46" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowtransparency="true"></iframe>
          </li>
          <li>
            <a href="http://b.hatena.ne.jp/entry/s/future-architect.github.io/uroborosql-doc/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-counter" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;"></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
          </li>
          <li>
            <div class="g-plusone" data-size="medium" data-href="https://future-architect.github.io/uroborosql-doc/"></div>
          </li>
        </ul>
      </div>
      <div>
          <h2>Follow</h2>
          <ul class="icons">
              
                  <li><a href="https://twitter.com/future_techblog" class="icon style2 fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
              
              
                  <li><a href="https://www.facebook.com/future.saiyo" class="icon style2 fa-facebook" target="_blank"><span class="label">Facebook</span></a></li>
              
              
                  <li><a href="https://github.com/future-architect" class="icon style2 fa-github" target="_blank"><span class="label">GitHub</span></a></li>
              
              
                  <li><a href="http://qiita.com/organizations/future" class="icon style2 fa-pencil" target="_blank"><span class="label">Qiita</span></a></li>
              
              
                 <li><a href="https://future-architect.github.io/" class="icon style2 fa-pencil-square-o" target="_blank"><span class="label">Tech Blog</span></a></li>
              
          </ul>
      </div>
      <br>
      <ul class="copyright">
          <li>&copy; 2018 - 2019 Future Corporation. All rights reserved</li>
          <li>Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a></li>
      </ul>
  </div>
</footer>
    </div>

    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="/uroborosql-doc/js/jquery.min.js"></script>

<!-- skel -->
<script src="/uroborosql-doc/js/skel.min.js"></script>

<!-- Custom Code -->
<script src="/uroborosql-doc/js/util.js"></script>

<!--[if lte IE 8]>
<script src="/uroborosql-doc/js/ie/respond.min.js"></script>
<![endif]-->

<!-- Custom Code -->
<script src="/uroborosql-doc/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>