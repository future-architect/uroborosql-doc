<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Why uroboroSQL?]]></title>
      <url>./uroborosql-doc/why_uroborosql/</url>
      <content type="html"><![CDATA[<hr>
<ul>
<li><a href="#uroboroSQLとは">uroboroSQLとは</a></li>
<li><a href="#uroboroSQLを使う理由？">uroboroSQLを使う理由？</a></li>
</ul>
<hr>
<h2 id="uroboroSQLとは"><a href="#uroboroSQLとは" class="headerlink" title="uroboroSQLとは"></a>uroboroSQLとは</h2><p>uroboroSQLは、Java8対応の2Way-SQLが利用可能なシンプルなSQL実行ライブラリです。</p>
<p>フューチャーアーキテクト社内にて、2006-2007年頃にS2Daoを参考に開発されて、プロジェクトで利用され、現在まで改善が続けられてきました。社内では、Webアプリケーションフレームワークや各種設計開発支援ツールと連携・統合される形で利用されています。</p>
<p>とはいえ、社内で秘伝のタレ化していることは否めず、開発フェーズでは、開発パートナーさんからも「ググれない」から、使い方がわからないいう声もちらほら。だったら、OSS化してしまえということのが公開のきっかけです。</p>
<h2 id="uroboroSQLを使う理由？"><a href="#uroboroSQLを使う理由？" class="headerlink" title="uroboroSQLを使う理由？"></a>uroboroSQLを使う理由？</h2><p>JavaからRDBにアクセスするとき、Java標準のJPA(Java Persistence API)の実装であるEclipseLink、OpenJPAはもとより、歴史のあるORMとしてHibernate、MyBatis、SpringJDBCといったグローバルで使われているものもありますし、日本でよく使われてきたS2Dao、S2JDBC、DBflute、Domaといったものもあります。</p>
<p>こういった数多のDB系ライブラリ・フレームワークの中で、解決したい領域もそれぞれですが、uroboroSQLは主にSQL中心の設計コンセプトを採用しています。Javaを中心に考えてSQLを組み立てるという思想ではなく、SQLに足りないところをJavaで補うという思想です。</p>
<p>これはエンタープライズシステムにおいて、ORマッパーやクエリビルダでは実装しきれない、分析関数の利用などの複雑かつDBプロダクト依存のSQLを使う場合に有効と考えています。</p>
<p>そのため、uroboroSQLはSQLは2Way-SQL方式で記述ができるものの、ORMでよくあるエンティティクラスとリレーションをたどって遅延ロードして子エンティティを取得するなどの機能は有していません。</p>
<p>その分、エンタープライズで培われたノウハウとして、区分値サポート、リトライ、フィルターによるカスタマイズなどの機能を充実させています。また、2Way-SQLに対して、カバレッジを取れるようにするという、品質視点での機能があるのも特徴です。</p>
<p><strong>SQLの能力を最大限活かしつつ、生産性と品質を高めたい</strong></p>
<p>それがuroboroSQLの最大の関心事なのです。</p>
<div style="font-size:130%; font-weight:bold;"><br>  <a href="../getting_started" style="float:right">Getting Started &#62;&#62;</a><br></div>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[Getting Started]]></title>
      <url>./uroborosql-doc/getting_started/</url>
      <content type="html"><![CDATA[<hr>
<ul>
<li><a href="#環境設定">環境設定</a><ul>
<li><a href="#ビルドツールの設定">ビルドツールの設定</a></li>
<li><a href="#事前準備">事前準備</a></li>
</ul>
</li>
<li><a href="#サンプルプロジェクトの実行">サンプルプロジェクトの実行</a></li>
<li><a href="#サンプルプロジェクトの構成">サンプルプロジェクトの構成</a></li>
<li><a href="#SQLの実行方法">SQLの実行方法</a></li>
<li><a href="#SQL-REPL">SQL-REPL</a></li>
</ul>
<hr>
<h2 id="環境設定"><a href="#環境設定" class="headerlink" title="環境設定"></a>環境設定</h2><h3 id="ビルドツールの設定"><a href="#ビルドツールの設定" class="headerlink" title="ビルドツールの設定"></a>ビルドツールの設定</h3><p>uroboroSQLをMavenプロジェクトに組み込むには、<strong>pom.xml</strong>に以下の記述を加えて下さい。<br>uroboroSQLは<a href="https://search.maven.org/#search%7Cga%7C1%7Curoborosql" target="_blank" rel="external">Maven Central Repository</a>で公開されています。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jp.co.future<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>uroborosql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Gradleプロジェクトの場合は、<strong>build.gradle</strong>のdependencies内に以下の記述を加えて下さい。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="keyword">group</span>: jp.co.future, name: uroborosql, version: <span class="number">0.1</span>.<span class="number">0</span></div></pre></td></tr></table></figure>
<h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>事前準備として、</p>
<ul>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">JDK8</a></li>
<li><a href="https://maven.apache.org/download.cgi" target="_blank" rel="external">Apache Maven</a></li>
</ul>
<p>をインストールしてください。</p>
<h2 id="サンプルプロジェクトの実行"><a href="#サンプルプロジェクトの実行" class="headerlink" title="サンプルプロジェクトの実行"></a>サンプルプロジェクトの実行</h2><p>uroboroSQLのサンプルアプリケーションであるuroborosql-sampleを使ってuroboroSQLを動かしてみましょう。</p>
<p>まず始めに<a href="https://github.com/future-architect/uroborosql-sample" target="_blank" rel="external">uroborosql-sample</a>から最新のソースコードを取得します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/future-architect/uroborosql-sample.git</div></pre></td></tr></table></figure></p>
<p>取得できたらcloneしたフォルダに移動します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> uroborosql-sample</div></pre></td></tr></table></figure></p>
<p>まずはサンプルアプリケーションを実行してみましょう。<br>サンプルアプリケーションは以下の起動コマンドで実行します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -PrunMain</div></pre></td></tr></table></figure></p>
<p>これでサンプルアプリケーションが実行されます。（初回実行時は必要なライブラリをダウンロードするため時間がかかります）<br>アプリケーションの実行ログが出力され、Mavenが正常終了すれば成功です。<br>色々ログが流れますが、この中でDB接続からテーブル作成、データの挿入、検索、バッチ更新、トランザクション、といった一連の処理が実行されています。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div></pre></td><td class="code"><pre><div class="line">[DEBUG] SQL定義ファイルの読み込みを開始します[/uroborosql-sample/target/classes/sql]</div><div class="line">[DEBUG] パッケージ[]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[ddl]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[department]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[employee]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[relation]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[setup]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] Enum定数[名前：CLS_GENDER_MALE, 値：M] を定数パラメータとして追加しました。</div><div class="line">[DEBUG] Enum定数[名前：CLS_GENDER_FEMALE, 値：F] を定数パラメータとして追加しました。</div><div class="line">[DEBUG] Enum定数[名前：CLS_GENDER_OTHER, 値：O] を定数パラメータとして追加しました。</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">-- employee</div><div class="line">drop table if exists employee cascade;</div><div class="line">create table employee (</div><div class="line">  emp_no NUMBER(11) not null</div><div class="line">  , first_name VARCHAR(20) not null</div><div class="line">  , last_name VARCHAR(20) not null</div><div class="line">  , birth_date DATE not null</div><div class="line">  , gender CHAR(1) not null</div><div class="line">  , constraint employee_PKC primary key (emp_no)</div><div class="line">) ;</div><div class="line">-- dept_emp</div><div class="line">drop table if exists dept_emp cascade;</div><div class="line">create table dept_emp (</div><div class="line">  emp_no NUMBER(11) not null</div><div class="line">  , dept_no NUMBER(4) not null</div><div class="line">  , constraint dept_emp_PKC primary key (emp_no,dept_no)</div><div class="line">) ;</div><div class="line">-- department</div><div class="line">drop table if exists department cascade;</div><div class="line">create table department (</div><div class="line">  dept_no NUMBER(4) not null</div><div class="line">  , dept_name VARCHAR(100) not null</div><div class="line">  , constraint department_PKC primary key (dept_no)</div><div class="line">) ;</div><div class="line">comment on table employee is 'employee';</div><div class="line">comment on column employee.emp_no is 'emp_no';</div><div class="line">comment on column employee.first_name is 'first_name';</div><div class="line">comment on column employee.last_name is 'last_name';</div><div class="line">comment on column employee.birth_date is 'birth_date';</div><div class="line">comment on column employee.gender is 'gender     ''F''emale/''M''ale/''O''ther';</div><div class="line">comment on table dept_emp is 'dept_emp';</div><div class="line">comment on column dept_emp.emp_no is 'emp_no';</div><div class="line">comment on column dept_emp.dept_no is 'dept_no';</div><div class="line">comment on table department is 'department';</div><div class="line">comment on column department.dept_no is 'dept_no';</div><div class="line">comment on column department.dept_name is 'dept_name'</div><div class="line">]</div><div class="line">[DEBUG] SQLによる更新を実行します。</div><div class="line">[DEBUG] SQL実行時間 [ddl/create_tables] : [00:00:00.027]</div><div class="line">[INFO ] ddl/create_tables count=0</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">insert into department (dept_no, dept_name) values (1001, 'sales');</div><div class="line">insert into department (dept_no, dept_name) values (1002, 'export');</div><div class="line">insert into department (dept_no, dept_name) values (1003, 'accounting');</div><div class="line">insert into department (dept_no, dept_name) values (1004, 'personnel');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (0001, 'Bob', 'Smith', '1970-01-02', 'M');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (0002, 'Susan', 'Davis', '1969-02-10', 'F');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (0003, 'John', 'Wilson', '1982-05-08', 'M');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (0004, 'Sharon', 'Johnson', '1990-01-20', 'F');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (0005, 'Stephen', 'Taylor', '2003-12-31', 'M');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (0001, '1001');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (0002, '1001');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (0003, '1002');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (0004, '1003');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (0005, '1004')</div><div class="line">]</div><div class="line">[DEBUG] SQLによる更新を実行します。</div><div class="line">[DEBUG] SQL実行時間 [setup/insert_data] : [00:00:00.010]</div><div class="line">[INFO ] setup/insert_data count=1</div><div class="line">[INFO ] select department data (collect)</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_no)], 判定結果：[false], パラメータ：[dept_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_name)], 判定結果：[false], パラメータ：[dept_name:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        department/select_department</div><div class="line">*/</div><div class="line">        DEPT.DEPT_NO    AS      DEPT_NO</div><div class="line">,       DEPT.DEPT_NAME  AS      DEPT_NAME</div><div class="line">FROM</div><div class="line">        DEPARTMENT      DEPT</div><div class="line">WHERE</div><div class="line">        1                               =       1</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [department/select_department] : [00:00:00.004]</div><div class="line">[INFO ] &#123;DEPT_NO=1001,DEPT_NAME=sales&#125;</div><div class="line">[INFO ] &#123;DEPT_NO=1002,DEPT_NAME=export&#125;</div><div class="line">[INFO ] &#123;DEPT_NO=1003,DEPT_NAME=accounting&#125;</div><div class="line">[INFO ] &#123;DEPT_NO=1004,DEPT_NAME=personnel&#125;</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_no)], 判定結果：[true], パラメータ：[dept_no:[1001]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_name)], 判定結果：[false], パラメータ：[dept_name:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        department/select_department</div><div class="line">*/</div><div class="line">        DEPT.DEPT_NO    AS      DEPT_NO</div><div class="line">,       DEPT.DEPT_NAME  AS      DEPT_NAME</div><div class="line">FROM</div><div class="line">        DEPARTMENT      DEPT</div><div class="line">WHERE</div><div class="line">        1                               =       1</div><div class="line">AND     DEPT.DEPT_NO    =       ?/*dept_no*/</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [department/select_department] : [00:00:00.000]</div><div class="line">[INFO ] &#123;DEPT_NO=1001,DEPT_NAME=sales&#125;</div><div class="line">[INFO ] select employee data (stream)</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(emp_no)], 判定結果：[false], パラメータ：[emp_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(first_name)], 判定結果：[false], パラメータ：[first_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(last_name)], 判定結果：[false], パラメータ：[last_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_from)], 判定結果：[false], パラメータ：[birth_date_from:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_to)], 判定結果：[false], パラメータ：[birth_date_to:[null]]</div><div class="line">[DEBUG] 評価式：[gender_list != null], 判定結果：[false], パラメータ：[gender_list:[null]]</div><div class="line">[DEBUG] 評価式：[female != null and female], 判定結果：[false], パラメータ：[female:[null],female:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        employee/select_employee</div><div class="line">*/</div><div class="line">        EMP.EMP_NO              AS      EMP_NO</div><div class="line">,       EMP.FIRST_NAME  AS      FIRST_NAME</div><div class="line">,       EMP.LAST_NAME   AS      LAST_NAME</div><div class="line">,       EMP.BIRTH_DATE  AS      BIRTH_DATE</div><div class="line">,       EMP.GENDER              AS      GENDER</div><div class="line">FROM</div><div class="line">        EMPLOYEE        EMP</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [employee/select_employee] : [00:00:00.000]</div><div class="line">[INFO ] &#123;EMP_NO=1,FIRST_NAME=Bob,LAST_NAME=Smith,BIRTH_DATE=1970-01-02,GENDER=M&#125;</div><div class="line">[INFO ] &#123;EMP_NO=2,FIRST_NAME=Susan,LAST_NAME=Davis,BIRTH_DATE=1969-02-10,GENDER=F&#125;</div><div class="line">[INFO ] &#123;EMP_NO=3,FIRST_NAME=John,LAST_NAME=Wilson,BIRTH_DATE=1982-05-08,GENDER=M&#125;</div><div class="line">[INFO ] &#123;EMP_NO=4,FIRST_NAME=Sharon,LAST_NAME=Johnson,BIRTH_DATE=1990-01-20,GENDER=F&#125;</div><div class="line">[INFO ] &#123;EMP_NO=5,FIRST_NAME=Stephen,LAST_NAME=Taylor,BIRTH_DATE=2003-12-31,GENDER=M&#125;</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(emp_no)], 判定結果：[false], パラメータ：[emp_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(first_name)], 判定結果：[false], パラメータ：[first_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(last_name)], 判定結果：[false], パラメータ：[last_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_from)], 判定結果：[true], パラメータ：[birth_date_from:[&#123;1990-01-01&#125;]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_to)], 判定結果：[false], パラメータ：[birth_date_to:[null]]</div><div class="line">[DEBUG] 評価式：[gender_list != null], 判定結果：[false], パラメータ：[gender_list:[null]]</div><div class="line">[DEBUG] 評価式：[female != null and female], 判定結果：[false], パラメータ：[female:[null],female:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        employee/select_employee</div><div class="line">*/</div><div class="line">        EMP.EMP_NO              AS      EMP_NO</div><div class="line">,       EMP.FIRST_NAME  AS      FIRST_NAME</div><div class="line">,       EMP.LAST_NAME   AS      LAST_NAME</div><div class="line">,       EMP.BIRTH_DATE  AS      BIRTH_DATE</div><div class="line">,       EMP.GENDER              AS      GENDER</div><div class="line">FROM</div><div class="line">        EMPLOYEE        EMP</div><div class="line">WHERE</div><div class="line">EMP.BIRTH_DATE  &gt;=      ?/*birth_date_from*/</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [employee/select_employee] : [00:00:00.000]</div><div class="line">[INFO ] &#123;EMP_NO=4,FIRST_NAME=Sharon,LAST_NAME=Johnson,BIRTH_DATE=1990-01-20,GENDER=F&#125;</div><div class="line">[INFO ] &#123;EMP_NO=5,FIRST_NAME=Stephen,LAST_NAME=Taylor,BIRTH_DATE=2003-12-31,GENDER=M&#125;</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(emp_no)], 判定結果：[false], パラメータ：[emp_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(first_name)], 判定結果：[false], パラメータ：[first_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(last_name)], 判定結果：[false], パラメータ：[last_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_from)], 判定結果：[false], パラメータ：[birth_date_from:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_to)], 判定結果：[false], パラメータ：[birth_date_to:[null]]</div><div class="line">[DEBUG] 評価式：[gender_list != null], 判定結果：[true], パラメータ：[gender_list:[&#123;F&#125;]]</div><div class="line">[DEBUG] 評価式：[female != null and female], 判定結果：[false], パラメータ：[female:[null],female:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        employee/select_employee</div><div class="line">*/</div><div class="line">        EMP.EMP_NO              AS      EMP_NO</div><div class="line">,       EMP.FIRST_NAME  AS      FIRST_NAME</div><div class="line">,       EMP.LAST_NAME   AS      LAST_NAME</div><div class="line">,       EMP.BIRTH_DATE  AS      BIRTH_DATE</div><div class="line">,       EMP.GENDER              AS      GENDER</div><div class="line">FROM</div><div class="line">        EMPLOYEE        EMP</div><div class="line">WHERE</div><div class="line">EMP.GENDER              IN      (?)/*gender_list*/</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [employee/select_employee] : [00:00:00.000]</div><div class="line">[INFO ] &#123;EMP_NO=2,FIRST_NAME=Susan,LAST_NAME=Davis,BIRTH_DATE=1969-02-10,GENDER=F&#125;</div><div class="line">[INFO ] &#123;EMP_NO=4,FIRST_NAME=Sharon,LAST_NAME=Johnson,BIRTH_DATE=1990-01-20,GENDER=F&#125;</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(emp_no)], 判定結果：[false], パラメータ：[emp_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(first_name)], 判定結果：[false], パラメータ：[first_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(last_name)], 判定結果：[false], パラメータ：[last_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_from)], 判定結果：[false], パラメータ：[birth_date_from:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_to)], 判定結果：[false], パラメータ：[birth_date_to:[null]]</div><div class="line">[DEBUG] 評価式：[gender_list != null], 判定結果：[false], パラメータ：[gender_list:[null]]</div><div class="line">[DEBUG] 評価式：[female != null and female], 判定結果：[true], パラメータ：[female:[true],female:[true]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        employee/select_employee</div><div class="line">*/</div><div class="line">        EMP.EMP_NO              AS      EMP_NO</div><div class="line">,       EMP.FIRST_NAME  AS      FIRST_NAME</div><div class="line">,       EMP.LAST_NAME   AS      LAST_NAME</div><div class="line">,       EMP.BIRTH_DATE  AS      BIRTH_DATE</div><div class="line">,       EMP.GENDER              AS      GENDER</div><div class="line">FROM</div><div class="line">        EMPLOYEE        EMP</div><div class="line">WHERE</div><div class="line">EMP.GENDER              =       'F'/*#CLS_GENDER_FEMALE*/</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [employee/select_employee] : [00:00:00.000]</div><div class="line">[INFO ] &#123;EMP_NO=2,FIRST_NAME=Susan,LAST_NAME=Davis,BIRTH_DATE=1969-02-10,GENDER=F&#125;</div><div class="line">[INFO ] &#123;EMP_NO=4,FIRST_NAME=Sharon,LAST_NAME=Johnson,BIRTH_DATE=1990-01-20,GENDER=F&#125;</div><div class="line">[INFO ] delete tables with sql literal</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">delete from dept_emp</div><div class="line">]</div><div class="line">[DEBUG] SQLによる更新を実行します。</div><div class="line">[DEBUG] SQL実行時間 [null] : [00:00:00.002]</div><div class="line">[INFO ] delete dept_emp count=5</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">delete from department</div><div class="line">]</div><div class="line">[DEBUG] SQLによる更新を実行します。</div><div class="line">[DEBUG] SQL実行時間 [null] : [00:00:00.000]</div><div class="line">[INFO ] delete department count=4</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">delete from employee</div><div class="line">]</div><div class="line">[DEBUG] SQLによる更新を実行します。</div><div class="line">[DEBUG] SQL実行時間 [null] : [00:00:00.000]</div><div class="line">[INFO ] delete employee count=5</div><div class="line">[INFO ] commit!</div><div class="line">[INFO ] create new transaction.</div><div class="line">[INFO ] department/insert_department batch insert.</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">INSERT</div><div class="line">/* department/insert_department */</div><div class="line">INTO</div><div class="line">        DEPARTMENT</div><div class="line">(</div><div class="line">        DEPT_NO</div><div class="line">,       DEPT_NAME</div><div class="line">) VALUES (</div><div class="line">        ?/*dept_no*/</div><div class="line">,       ?/*dept_name*/</div><div class="line">)</div><div class="line">]</div><div class="line">[DEBUG] 4件バッチ処理を追加しました。</div><div class="line">[DEBUG] バッチ処理を実行します。</div><div class="line">[DEBUG] SQL実行時間 [department/insert_department] : [00:00:00.015]</div><div class="line">[INFO ] department/insert_department count=&#123;1,1,1,1&#125;</div><div class="line">[INFO ] employee/insert_employee batch insert.</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">INSERT</div><div class="line">/* employee/insert_employee */</div><div class="line">INTO</div><div class="line">        EMPLOYEE</div><div class="line">(</div><div class="line">        EMP_NO</div><div class="line">,       FIRST_NAME</div><div class="line">,       LAST_NAME</div><div class="line">,       BIRTH_DATE</div><div class="line">,       GENDER</div><div class="line">) VALUES (</div><div class="line">        ?/*emp_no*/</div><div class="line">,       ?/*first_name*/</div><div class="line">,       ?/*last_name*/</div><div class="line">,       ?/*birth_date*/</div><div class="line">,       ?/*gender*/</div><div class="line">)</div><div class="line">]</div><div class="line">[DEBUG] 5件バッチ処理を追加しました。</div><div class="line">[DEBUG] バッチ処理を実行します。</div><div class="line">[DEBUG] SQL実行時間 [employee/insert_employee] : [00:00:00.001]</div><div class="line">[INFO ] employee/insert_employee count=&#123;1,1,1,1,1&#125;</div><div class="line">[INFO ] relation/insert_dept_emp batch insert.</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">INSERT</div><div class="line">/* relation/insert_dept_emp */</div><div class="line">INTO</div><div class="line">        DEPT_EMP</div><div class="line">(</div><div class="line">        EMP_NO</div><div class="line">,       DEPT_NO</div><div class="line">) VALUES (</div><div class="line">        ?/*emp_no*/</div><div class="line">,       ?/*dept_no*/</div><div class="line">)</div><div class="line">]</div><div class="line">[DEBUG] 5件バッチ処理を追加しました。</div><div class="line">[DEBUG] バッチ処理を実行します。</div><div class="line">[DEBUG] SQL実行時間 [relation/insert_dept_emp] : [00:00:00.003]</div><div class="line">[INFO ] relation/insert_dept_emp count=</div><div class="line">[INFO ] employee/select_employee in transaction select</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(emp_no)], 判定結果：[false], パラメータ：[emp_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(first_name)], 判定結果：[false], パラメータ：[first_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(last_name)], 判定結果：[false], パラメータ：[last_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_from)], 判定結果：[false], パラメータ：[birth_date_from:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_to)], 判定結果：[false], パラメータ：[birth_date_to:[null]]</div><div class="line">[DEBUG] 評価式：[gender_list != null], 判定結果：[false], パラメータ：[gender_list:[null]]</div><div class="line">[DEBUG] 評価式：[female != null and female], 判定結果：[false], パラメータ：[female:[null],female:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        employee/select_employee</div><div class="line">*/</div><div class="line">        EMP.EMP_NO              AS      EMP_NO</div><div class="line">,       EMP.FIRST_NAME  AS      FIRST_NAME</div><div class="line">,       EMP.LAST_NAME   AS      LAST_NAME</div><div class="line">,       EMP.BIRTH_DATE  AS      BIRTH_DATE</div><div class="line">,       EMP.GENDER              AS      GENDER</div><div class="line">FROM</div><div class="line">        EMPLOYEE        EMP</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [employee/select_employee] : [00:00:00.000]</div><div class="line">[INFO ] &#123;EMP_NO=1,FIRST_NAME=Bob,LAST_NAME=Smith,BIRTH_DATE=1970-01-02,GENDER=M&#125;</div><div class="line">[INFO ] &#123;EMP_NO=2,FIRST_NAME=Susan,LAST_NAME=Davis,BIRTH_DATE=1969-02-10,GENDER=F&#125;</div><div class="line">[INFO ] &#123;EMP_NO=3,FIRST_NAME=John,LAST_NAME=Wilson,BIRTH_DATE=1982-05-08,GENDER=M&#125;</div><div class="line">[INFO ] &#123;EMP_NO=4,FIRST_NAME=Sharon,LAST_NAME=Johnson,BIRTH_DATE=1990-01-20,GENDER=F&#125;</div><div class="line">[INFO ] &#123;EMP_NO=5,FIRST_NAME=Stephen,LAST_NAME=Taylor,BIRTH_DATE=2003-12-31,GENDER=M&#125;</div><div class="line">[INFO ] transaction rollback!</div><div class="line">[INFO ] employee/select_employee after transaction select. employee is empty.</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(emp_no)], 判定結果：[false], パラメータ：[emp_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(first_name)], 判定結果：[false], パラメータ：[first_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(last_name)], 判定結果：[false], パラメータ：[last_name:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_from)], 判定結果：[false], パラメータ：[birth_date_from:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(birth_date_to)], 判定結果：[false], パラメータ：[birth_date_to:[null]]</div><div class="line">[DEBUG] 評価式：[gender_list != null], 判定結果：[false], パラメータ：[gender_list:[null]]</div><div class="line">[DEBUG] 評価式：[female != null and female], 判定結果：[false], パラメータ：[female:[null],female:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        employee/select_employee</div><div class="line">*/</div><div class="line">        EMP.EMP_NO              AS      EMP_NO</div><div class="line">,       EMP.FIRST_NAME  AS      FIRST_NAME</div><div class="line">,       EMP.LAST_NAME   AS      LAST_NAME</div><div class="line">,       EMP.BIRTH_DATE  AS      BIRTH_DATE</div><div class="line">,       EMP.GENDER              AS      GENDER</div><div class="line">FROM</div><div class="line">        EMPLOYEE        EMP</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">[DEBUG] SQL実行時間 [employee/select_employee] : [00:00:00.000]</div><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">[INFO] BUILD SUCCESS</div><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">[INFO] Total time: 7.571 s</div><div class="line">[INFO] Finished at: XXXX-XX-XXT00:00:00+09:00</div><div class="line">[INFO] Final Memory: 24M/981M</div><div class="line">[INFO] ------------------------------------------------------------------------</div></pre></td></tr></table></figure>
<h2 id="サンプルプロジェクトの構成"><a href="#サンプルプロジェクトの構成" class="headerlink" title="サンプルプロジェクトの構成"></a>サンプルプロジェクトの構成</h2><p>ではサンプルアプリケーションの構成を見ていきましょう。</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">uroborosql-sample</div><div class="line">  ├─REPL</div><div class="line">  │  └─repl.properties</div><div class="line">  └─src</div><div class="line"><span class="code">     └─main</span></div><div class="line"><span class="code">        ├─java</span></div><div class="line"><span class="code">        │  └─jp</span></div><div class="line"><span class="code">        │      └─co</span></div><div class="line"><span class="code">        │          └─future</span></div><div class="line"><span class="code">        │              └─uroborosql</span></div><div class="line"><span class="code">        │                  └─sample</span></div><div class="line"><span class="code">        │                      └─Main.java</span></div><div class="line"><span class="code">        │                      └─type</span></div><div class="line"><span class="code">        │                          └─Gender.java</span></div><div class="line"><span class="code">        └─resources</span></div><div class="line"><span class="code">            ├─logback.xml</span></div><div class="line"><span class="code">            ├─data</span></div><div class="line"><span class="code">            │   ├─department.tsv</span></div><div class="line"><span class="code">            │   ├─dept_emp.tsv</span></div><div class="line"><span class="code">            │   └─employee.tsv</span></div><div class="line"><span class="code">            └─sql</span></div><div class="line"><span class="code">                ├─ddl</span></div><div class="line"><span class="code">                │   └─create_tables.sql</span></div><div class="line"><span class="code">                └─setup</span></div><div class="line"><span class="code">                │   └─insert_data.sql</span></div><div class="line"><span class="code">                ├─department</span></div><div class="line"><span class="code">                │   ├─insert_department.sql</span></div><div class="line"><span class="code">                │   └─select_department.sql</span></div><div class="line"><span class="code">                ├─employee</span></div><div class="line"><span class="code">                │   ├─insert_employee.sql</span></div><div class="line"><span class="code">                │   └─select_employee.sql</span></div><div class="line"><span class="code">                └─relation</span></div><div class="line"><span class="code">                    └─insert_dept_emp.sql</span></div></pre></td></tr></table></figure>
<p>主要なファイルの説明です</p>
<ul>
<li>Main.java<br>  uroborosql-sampleのメインプログラムです。</li>
<li>Gender.java<br>  性別を表すEnumクラスです。メインプログラムの中で使用します。</li>
<li>sqlフォルダ配下のSQL<br>  uroborosqlで実行するSQLファイルです。</li>
<li>dataフォルダ配下のTSV<br>  テーブルデータ作成用のTSVファイルです。Mainクラスの中でテーブルへの一括データ投入を行う際のデータとして利用します。</li>
<li>logback.xml<br>  ログ出力設定ファイルです。</li>
</ul>
<h2 id="SQLの実行方法"><a href="#SQLの実行方法" class="headerlink" title="SQLの実行方法"></a>SQLの実行方法</h2><p>Main.javaを見ていきましょう。</p>
<p>mainメソッドの中で最初にSqlConfigクラスを作成しています。<br>ここでは<a href="http://www.h2database.com/html/main.html" target="_blank" rel="external">H2DB</a>のメモリDBに接続するSqlConfigインスタンスを生成しています。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// create SqlConfig</span></div><div class="line">SqlConfig config = createSqlConfig();</div><div class="line"></div><div class="line">... 中略 ...</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SqlConfig <span class="title">createSqlConfig</span><span class="params">()</span> </span>&#123;</div><div class="line">    SqlConfig config = DefaultSqlConfig.getConfig(<span class="string">"jdbc:h2:mem:test;DB_CLOSE_DELAY=-1"</span>, <span class="string">"sa"</span>, <span class="string">""</span>);</div><div class="line"></div><div class="line">    ... 中略 ...</div><div class="line"></div><div class="line">    <span class="keyword">return</span> config;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>次に生成したSqlConfigからuroboroSQLの中核となるクラスであるSqlAgentを生成します。<br>uroboroSQLのそれぞれの処理はSqlAgentを使って呼び出します。<br>SqlAgentはAutoClosableインタフェースを実装しているので、try-with-resources文で囲むことで処理終了時にクローズされます。<br>このときSqlAgentの中に保持するConnectionなどもクローズされるため、クローズ漏れによるメモリリークを防ぐことができます。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// create SqlAgent. SqlAgent implements AutoClosable.</span></div><div class="line"><span class="keyword">try</span> (SqlAgent agent = config.createAgent()) &#123;</div><div class="line"></div><div class="line">... 中略 ...</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以降の処理はtry-with-resourcesの中で行います。</p>
<p>接続したDBにテーブルを作成と初期データの登録を行います。<br>uroboroSQLでは実行するSQLをファイルパスに似た表現（<code>SQL名</code>と呼ぶ）で指定します。<br>下の例ではクラスパス上にあるsqlフォルダ配下のddl/create_tables.sqlを指定してSQL更新処理を実行します。</p>
<p>更新処理を行う場合、<code>SqlAgent#update(&quot;[SQL名]&quot;)</code>メソッドを使用してSqlUpdateを取得し、続けてバインドパラメータの設定や<br>Updateの実行を行います。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// create table :  テーブル作成</span></div><div class="line">agent.update(<span class="string">"ddl/create_tables"</span>).count();</div><div class="line"><span class="comment">// setup data : 初期データ挿入</span></div><div class="line">agent.update(<span class="string">"setup/insert_data"</span>).count();</div></pre></td></tr></table></figure>
<p>ddl/create_tables.sqlで作成したテーブルの構成は以下になります。<br><img src="erd.png" alt="ERD" title="テーブル構成"></p>
<p>登録したデータを検索してみましょう。<br>検索を行う際は、<code>SqlAgent#query(&quot;[SQL名]&quot;)</code>メソッドを使用してSqlQueryを取得し、続けてバインドパラメータの設定や<br>Queryの実行を行います。</p>
<p>uroboroSQLでは検索結果をいくつかの形式で取得することができます。</p>
<ul>
<li><code>SqlQuery#collect()</code><br>  検索結果の各行をMapに詰めたListの形式で取得する</li>
<li><code>SqlQuery#stream()</code><br>  検索結果をJava8で追加されたStreamの形式で取得する</li>
<li><code>SqlQuery#resultSet()</code><br>  検索結果のResultSetを取得する</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 検索結果の各行をMapに詰めたListの形式で取得する</span></div><div class="line">List&lt;Map&lt;String, Object&gt;&gt; departments = agent.query(<span class="string">"department/select_department"</span>).param(<span class="string">"dept_no"</span>, <span class="number">1001</span>).collect();</div><div class="line"></div><div class="line"><span class="comment">// 検索結果をJava8で追加されたStreamの形式で取得する</span></div><div class="line">agent.query(<span class="string">"employee/select_employee"</span>).paramList(<span class="string">"gender_list"</span>, Gender.Female).stream().forEachOrdered(m -&gt; log(toS(m)));</div></pre></td></tr></table></figure>
<p>ここで実行されるSQLは以下のようになっています。</p>
<ul>
<li>department/select_department.sql<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line"><span class="comment">/* _SQL_ID_ */</span></div><div class="line">	DEPT.DEPT_NO	<span class="keyword">AS</span>	DEPT_NO</div><div class="line">,	DEPT.DEPT_NAME	<span class="keyword">AS</span>	DEPT_NAME</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	DEPARTMENT	DEPT</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	<span class="number">1</span>				=	<span class="number">1</span></div><div class="line"><span class="comment">/*IF SF.isNotEmpty(dept_no)*/</span></div><div class="line"><span class="keyword">AND</span>	DEPT.DEPT_NO	=	<span class="comment">/*dept_no*/</span><span class="number">1</span></div><div class="line"><span class="comment">/*END*/</span></div><div class="line"><span class="comment">/*IF SF.isNotEmpty(dept_name)*/</span></div><div class="line"><span class="keyword">AND</span>	DEPT.DEPT_NAME	=	<span class="comment">/*dept_name*/</span><span class="string">'sample'</span></div><div class="line"><span class="comment">/*END*/</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><code>/* _SQL_ID_ */</code> はSQLを特定するIDを付与するための予約語で、実行時にSQLファイルを特定するための文字列に変換されます。<br><code>/*IF*/ ... /*END*/</code>は条件分岐で、IFの後ろの評価結果が<code>True</code>となる場合に<code>/*IF*/</code>と<code>/*END*/</code>で囲まれた部分が出力されます。<br><code>/*dept_no*/</code>はバインドパラメータで、実行時に<code>?</code>に変換され、SqlQueryに設定したパラメータがSQLへバインドされます。<br><code>/*dept_no*/</code>の後ろの<code>1</code>はテスト用データです。このようにテスト用データをSQL文に記述しておくことで、このSQLを<br>SQLクライアントツールで実行する際にエラーにならずに文法の確認を行うことができます。</p>
<p>SQLで使用できる構文の詳細については<a href="../basics/#2WaySQL">2WaySQL</a>を参照してください。</p>
<p>処理結果のCommitやRollbackもSqlAgent経由で行います。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// commit</span></div><div class="line">agent.commit();</div><div class="line"></div><div class="line"><span class="comment">// rollback</span></div><div class="line">agent.rollback();</div></pre></td></tr></table></figure>
<p>uroboroSQLでは、これらの基本的な操作のほか、バッチ処理やトランザクション処理なども行うことができます。<br>詳細については<a href="../basics/#基本操作">基本操作</a>を参照してください。</p>
<h2 id="SQL-REPL"><a href="#SQL-REPL" class="headerlink" title="SQL-REPL"></a>SQL-REPL</h2><p>ここまではJavaアプリケーションからuroboroSQLを利用する場合の説明でした。<br>uroboroSQLにはもう一つ特徴的な機能として、SQLを対話しながら実行するためのREPL機能を提供しています。</p>
<p>今度はこのREPL機能を利用してみましょう。</p>
<p>REPLを起動するためには<code>jp.co.future.uroborosql.client.SqlREPL</code>クラスを実行する必要があります。<br>サンプルアプリケーションでSqlREPLクラスを実行するためには以下のコマンドを実行します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -PREPL</div></pre></td></tr></table></figure></p>
<p>実行すると以下のようにタイトル表示とコマンド説明、設定値やロードしたSQLの情報が表示され、そのあとコマンド入力状態になります。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">uroboroSQL SQL REPL <span class="built_in">ver</span>.<span class="number">0</span>.<span class="number">1</span>.<span class="number">0</span></div><div class="line"></div><div class="line">Commands :</div><div class="line">        query   : execute query from loaded sql file.</div><div class="line">                ex1) query [sql file <span class="built_in">path</span>]&lt;Enter&gt; : インタラクティブモード。SQLファイルにパラメータが含まれる場合は設定する値を問い合わせる。</div><div class="line">                ex2) query [sql file <span class="built_in">path</span>] param1=val1 param2=val2 ...&lt;Enter&gt; : 一括実行モード。指定したパラメータでSQLを実行する。</div><div class="line">        update  : execute update from loaded sql file.</div><div class="line">                ex1) update [sql file <span class="built_in">path</span>]&lt;Enter&gt; : インタラクティブモード。SQLファイルにパラメータが含まれる場合は設定する値を問い合わせる。</div><div class="line">                ex2) update [sql file <span class="built_in">path</span>] param1=val1 param2=val2 ...&lt;Enter&gt; : 一括実行モード。指定したパラメータでSQLを実行する。</div><div class="line">        list    : list loaded sql files.</div><div class="line">        driver  : list loaded drivers.</div><div class="line">        reload  : reload sql files.</div><div class="line">        <span class="built_in">help</span>    : show this message.</div><div class="line">        quit    : quit SQL REPL.</div><div class="line"></div><div class="line">[プロパティ一覧]</div><div class="line">db.url=jdbc:h2:file:./target/db/repldb;</div><div class="line">sql.additionalClassPath=src/main/resources;$&#123;user.home&#125;/.m2/repository/com/h2database/h2/<span class="number">1</span>.<span class="number">4</span>.<span class="number">192</span>/h2-<span class="number">1</span>.<span class="number">4</span>.<span class="number">192</span>.jar</div><div class="line">db.user=sa</div><div class="line">db.password=</div><div class="line"></div><div class="line">[DEBUG] SQL定義ファイルの読み込みを開始します[uroborosql-sample\target\classes\sql]</div><div class="line">[DEBUG] パッケージ[]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[ddl]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[department]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[employee]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[relation]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[setup]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] SQL定義ファイルの読み込みを開始します[uroborosql-sample\src\main\resources\sql]</div><div class="line">[DEBUG] パッケージ[]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[ddl]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[department]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[employee]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[relation]以下のSQL定義を読み込んでいます</div><div class="line">[DEBUG] パッケージ[setup]以下のSQL定義を読み込んでいます</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>まずは<code>help[Enter]</code>と入力してみましょう。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt;<span class="built_in">help</span>[Enter]</div><div class="line"><span class="function">HELP:</span></div><div class="line"><span class="title">uroboroSQL</span> <span class="title">SQL</span> <span class="title">REPL</span> <span class="title">ver</span>.0.1.0</div><div class="line"></div><div class="line"><span class="title">Commands</span> :</div><div class="line">        <span class="title">query</span>   : <span class="title">execute</span> <span class="title">query</span> <span class="title">from</span> <span class="title">loaded</span> <span class="title">sql</span> <span class="title">file</span>.</div><div class="line">                <span class="title">ex1</span>) <span class="title">query</span> [<span class="title">sql</span> <span class="title">file</span> <span class="title">path</span>]&lt;<span class="title">Enter</span>&gt; : インタラクティブモード。<span class="title">SQL</span>ファイルにパラメータが含まれる場合は設定する値を問い合わせる。</div><div class="line">                <span class="title">ex2</span>) <span class="title">query</span> [<span class="title">sql</span> <span class="title">file</span> <span class="title">path</span>] <span class="title">param1</span>=<span class="title">val1</span> <span class="title">param2</span>=<span class="title">val2</span> ...&lt;<span class="title">Enter</span>&gt; : 一括実行モード。指定したパラメータで<span class="title">SQL</span>を実行する。</div><div class="line">        <span class="title">update</span>  : <span class="title">execute</span> <span class="title">update</span> <span class="title">from</span> <span class="title">loaded</span> <span class="title">sql</span> <span class="title">file</span>.</div><div class="line">                <span class="title">ex1</span>) <span class="title">update</span> [<span class="title">sql</span> <span class="title">file</span> <span class="title">path</span>]&lt;<span class="title">Enter</span>&gt; : インタラクティブモード。<span class="title">SQL</span>ファイルにパラメータが含まれる場合は設定する値を問い合わせる。</div><div class="line">                <span class="title">ex2</span>) <span class="title">update</span> [<span class="title">sql</span> <span class="title">file</span> <span class="title">path</span>] <span class="title">param1</span>=<span class="title">val1</span> <span class="title">param2</span>=<span class="title">val2</span> ...&lt;<span class="title">Enter</span>&gt; : 一括実行モード。指定したパラメータで<span class="title">SQL</span>を実行する。</div><div class="line">        <span class="title">list</span>    : <span class="title">list</span> <span class="title">loaded</span> <span class="title">sql</span> <span class="title">files</span>.</div><div class="line">        <span class="title">driver</span>  : <span class="title">list</span> <span class="title">loaded</span> <span class="title">drivers</span>.</div><div class="line">        <span class="title">reload</span>  : <span class="title">reload</span> <span class="title">sql</span> <span class="title">files</span>.</div><div class="line">        <span class="title">help</span>    : <span class="title">show</span> <span class="title">this</span> <span class="title">message</span>.</div><div class="line">        <span class="title">quit</span>    : <span class="title">quit</span> <span class="title">SQL</span> <span class="title">REPL</span>.</div></pre></td></tr></table></figure></p>
<p>ヘルプが表示され、使用できるコマンドの一覧が表示されます。</p>
<p>REPLを立ち上げた状態では接続したDB（H2DB メモリDB）には何もない状態なので、まずはテーブルを作成します。<br>サンプルアプリケーションで利用できるSQLファイルを確認しましょう。<br><code>list[Enter]</code>と入力します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;list[Enter]</div><div class="line"><span class="function">LIST:</span></div><div class="line">1 : <span class="title">ddl</span>/<span class="title">create_tables</span></div><div class="line">2 : <span class="title">employee</span>/<span class="title">select_employee</span></div><div class="line">3 : <span class="title">employee</span>/<span class="title">insert_employee</span></div><div class="line">4 : <span class="title">department</span>/<span class="title">insert_department</span></div><div class="line">5 : <span class="title">setup</span>/<span class="title">insert_data</span></div><div class="line">6 : <span class="title">department</span>/<span class="title">select_department</span></div><div class="line">7 : <span class="title">relation</span>/<span class="title">insert_dept_emp</span></div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p>ロード済みのSQLファイルのSQL名がわかります。<br>テーブルを作成するために<code>ddl/create_tables</code>を実行します。<br><code>ddl/create_tables</code>はDDLなので実行するためには<code>update</code>コマンドを使用します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">&gt; update ddl/create_tables[Enter]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">-- employee</div><div class="line">drop table <span class="keyword">if</span> exists employee cascade;</div><div class="line">create table employee (</div><div class="line">  emp_no NUMBER(<span class="number">11</span>) <span class="keyword">not</span> null</div><div class="line">  , first_name VARCHAR(<span class="number">20</span>) <span class="keyword">not</span> null</div><div class="line">  , last_name VARCHAR(<span class="number">20</span>) <span class="keyword">not</span> null</div><div class="line">  , birth_date <span class="built_in">DATE</span> <span class="keyword">not</span> null</div><div class="line">  , gender CHAR(<span class="number">1</span>) <span class="keyword">not</span> null</div><div class="line">  , constraint employee_PKC primary key (emp_no)</div><div class="line">) ;</div><div class="line">-- dept_emp</div><div class="line">drop table <span class="keyword">if</span> exists dept_emp cascade;</div><div class="line">create table dept_emp (</div><div class="line">  emp_no NUMBER(<span class="number">11</span>) <span class="keyword">not</span> null</div><div class="line">  , dept_no NUMBER(<span class="number">4</span>) <span class="keyword">not</span> null</div><div class="line">  , constraint dept_emp_PKC primary key (emp_no,dept_no)</div><div class="line">) ;</div><div class="line">-- department</div><div class="line">drop table <span class="keyword">if</span> exists department cascade;</div><div class="line">create table department (</div><div class="line">  dept_no NUMBER(<span class="number">4</span>) <span class="keyword">not</span> null</div><div class="line">  , dept_name VARCHAR(<span class="number">100</span>) <span class="keyword">not</span> null</div><div class="line">  , constraint department_PKC primary key (dept_no)</div><div class="line">) ;</div><div class="line">comment on table employee is 'employee';</div><div class="line">comment on column employee.emp_no is 'emp_no';</div><div class="line">comment on column employee.first_name is 'first_name';</div><div class="line">comment on column employee.last_name is 'last_name';</div><div class="line">comment on column employee.birth_date is 'birth_date';</div><div class="line">comment on column employee.gender is 'gender     ''F''emale/''M''ale/''O''ther';</div><div class="line">comment on table dept_emp is 'dept_emp';</div><div class="line">comment on column dept_emp.emp_no is 'emp_no';</div><div class="line">comment on column dept_emp.dept_no is 'dept_no';</div><div class="line">comment on table department is 'department';</div><div class="line">comment on column department.dept_no is 'dept_no';</div><div class="line">comment on column department.dept_name is 'dept_name'</div><div class="line">]</div><div class="line">[DEBUG] SQLによる更新を実行します。</div><div class="line">[DEBUG] SQL実行時間 [ddl/create_tables] : [<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>.<span class="number">035</span>]</div><div class="line">update sql[ddl/create_tables] end. row count=<span class="number">0</span></div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p><code>ddl/create_tables</code>が実行され、DBにテーブルが作成されました。<br>続いて初期データを投入しましょう。<br><code>setup/insert_data</code>を実行します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&gt; update setup/insert_data[Enter]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">insert into department (dept_no, dept_name) values (<span class="number">1001</span>, 'sales');</div><div class="line">insert into department (dept_no, dept_name) values (<span class="number">1002</span>, 'export');</div><div class="line">insert into department (dept_no, dept_name) values (<span class="number">1003</span>, 'accounting');</div><div class="line">insert into department (dept_no, dept_name) values (<span class="number">1004</span>, 'personnel');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (<span class="number">0001</span>, 'Bob', 'Smith', '<span class="number">1970</span>-<span class="number">01</span>-<span class="number">02</span>', 'M');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (<span class="number">0002</span>, 'Susan', 'Davis', '<span class="number">1969</span>-<span class="number">02</span>-<span class="number">10</span>', 'F');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (<span class="number">0003</span>, 'John', 'Wilson', '<span class="number">1982</span>-<span class="number">05</span>-<span class="number">08</span>', 'M');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (<span class="number">0004</span>, 'Sharon', 'Johnson', '<span class="number">1990</span>-<span class="number">01</span>-<span class="number">20</span>', 'F');</div><div class="line">insert into employee (emp_no, first_name, last_name, birth_date, gender) values (<span class="number">0005</span>, 'Stephen', 'Taylor', '<span class="number">2003</span>-<span class="number">12</span>-<span class="number">31</span>', 'M');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (<span class="number">0001</span>, '<span class="number">1001</span>');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (<span class="number">0002</span>, '<span class="number">1001</span>');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (<span class="number">0003</span>, '<span class="number">1002</span>');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (<span class="number">0004</span>, '<span class="number">1003</span>');</div><div class="line">insert into dept_emp (emp_no, dept_no) values (<span class="number">0005</span>, '<span class="number">1004</span>')</div><div class="line">]</div><div class="line">[DEBUG] SQLによる更新を実行します。</div><div class="line">[DEBUG] SQL実行時間 [setup/insert_data] : [<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>.<span class="number">040</span>]</div><div class="line">update sql[setup/insert_data] end. row count=<span class="number">1</span></div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p>これで書くテーブルに初期データが挿入されました。</p>
<p>では、挿入したデータを検索してみましょう。<br>検索を行う場合は<code>query</code>コマンドを使用します。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; query department/select_department[Enter]</div></pre></td></tr></table></figure></p>
<p>実行すると今度は続けて問い合わせが出てきます。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt; param : dept_no=</div><div class="line">&gt;&gt; param : dept_name=</div></pre></td></tr></table></figure></p>
<p>これらは<code>department/select_department</code>を解析して取得したバインドパラメータになります。<br>ここで=のあとに値を入力して[Enter]を押下すると、バインドパラメータに値を指定してSQLを実行することができます。<br>ここではまずバインドパラメータに値を設定せずに検索を行います。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&gt; query department/select_department[Enter]</div><div class="line">&gt;&gt; param : dept_no=[Enter]</div><div class="line">&gt;&gt; param : dept_name=[Enter]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_no)], 判定結果：[false], パラメータ：[dept_no:[null]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_name)], 判定結果：[false], パラメータ：[dept_name:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        department/select_department</div><div class="line">*/</div><div class="line">        DEPT.DEPT_NO    AS      DEPT_NO</div><div class="line">,       DEPT.DEPT_NAME  AS      DEPT_NAME</div><div class="line">FROM</div><div class="line">        DEPARTMENT      DEPT</div><div class="line">WHERE</div><div class="line">        1                               =       1</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">+-------+----------+</div><div class="line">|DEPT_NO|DEPT_NAME |</div><div class="line">+-------+----------+</div><div class="line">|   1001|sales     |</div><div class="line">|   1002|export    |</div><div class="line">|   1003|accounting|</div><div class="line">|   1004|personnel |</div><div class="line">+-------+----------+</div><div class="line">[DEBUG] SQL実行時間 [department/select_department] : [00:00:00.048]</div><div class="line">query sql[department/select_department] end.</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>バインドパラメータの指定がなかったため、絞込み条件のないSQLが実行され検索結果として4件のデータが取得できました。<br>REPLでは上の結果のように、</p>
<ul>
<li>実行するSQL</li>
<li>バインドパラメータ</li>
<li>SQL文の中の評価式とその評価結果</li>
<li>検索結果</li>
<li>実行時間<br>が表示されるので、どういう風にSQLが実行されたのかが良く分かるようになっています。</li>
</ul>
<p>次にバインドパラメータを指定して検索してみましょう。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&gt; query department/select_department[Enter]</div><div class="line"> &gt;&gt; param : dept_no=1001[Enter]</div><div class="line"> &gt;&gt; param : dept_name=[Enter]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_no)], 判定結果：[true], パラメータ：[dept_no:[1001]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_name)], 判定結果：[false], パラメータ：[dept_name:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        department/select_department</div><div class="line">*/</div><div class="line">        DEPT.DEPT_NO    AS      DEPT_NO</div><div class="line">,       DEPT.DEPT_NAME  AS      DEPT_NAME</div><div class="line">FROM</div><div class="line">        DEPARTMENT      DEPT</div><div class="line">WHERE</div><div class="line">        1                               =       1</div><div class="line">AND     DEPT.DEPT_NO    =       ?/*dept_no*/</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">+-------+---------+</div><div class="line">|DEPT_NO|DEPT_NAME|</div><div class="line">+-------+---------+</div><div class="line">|   1001|sales    |</div><div class="line">+-------+---------+</div><div class="line">[DEBUG] SQL実行時間 [department/select_department] : [00:00:00.008]</div><div class="line">query sql[department/select_department] end.</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p><code>dept_no</code>に1001を指定して検索しています。<br>この時、SQL文の評価式である/*IF SF.isNotEmpty(dept_no)*/が<code>true</code>となりSQLのWHERE句にDEPT_NOの条件が追加されバインドパラメータがバインドされます。<br>その結果、検索結果は1件になっています。</p>
<p>バインドパラメータを一括で指定することもできます。<br>以下のコマンドは上の入力と同じ結果になります。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&gt; query department/select_department dept_no=1001[Enter]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_no)], 判定結果：[true], パラメータ：[dept_no:[1001]]</div><div class="line">[DEBUG] 評価式：[SF.isNotEmpty(dept_name)], 判定結果：[false], パラメータ：[dept_name:[null]]</div><div class="line">[DEBUG] 実行時SQL[</div><div class="line">SELECT</div><div class="line">/*</div><div class="line">        department/select_department</div><div class="line">*/</div><div class="line">        DEPT.DEPT_NO    AS      DEPT_NO</div><div class="line">,       DEPT.DEPT_NAME  AS      DEPT_NAME</div><div class="line">FROM</div><div class="line">        DEPARTMENT      DEPT</div><div class="line">WHERE</div><div class="line">        1                               =       1</div><div class="line">AND     DEPT.DEPT_NO    =       ?/*dept_no*/</div><div class="line"></div><div class="line">]</div><div class="line">[DEBUG] SQLによる検索を実行します。</div><div class="line">+-------+---------+</div><div class="line">|DEPT_NO|DEPT_NAME|</div><div class="line">+-------+---------+</div><div class="line">|   1001|sales    |</div><div class="line">+-------+---------+</div><div class="line">[DEBUG] SQL実行時間 [department/select_department] : [00:00:00.000]</div><div class="line">query sql[department/select_department] end.</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p>このようにSQL名の後ろに<code>バインドパラメータ名</code>=<code>値</code>という形でバインドパラメータを記述することでバインドパラメータの問い合わせ無しにSQLを実行することができます。<br>バインドパラメータが複数ある場合は<code>バインドパラメータ名1</code>=<code>値1</code> <code>バインドパラメータ名2</code>=<code>値2</code> … という風に各パラメータの間を空白で区切って指定してください。</p>
<p>REPLを終了する場合はコマンド<code>quit</code>,もしくは<code>exit</code>を入力してください。<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; quit[Enter]</div><div class="line">SQL REPL end.</div></pre></td></tr></table></figure></p>
<p>終了メッセージが表示されてREPLが終了します。</p>
<p>さて、ここまでREPLの操作を説明してきましたが、DB接続情報やSQLファイルの場所はどこで指定していたのでしょうか。<br>実は<code>jp.co.future.uroborosql.client.SqlREPL</code>を実行する際、引数としてプロパティファイルを指定します。このプロパティファイルにDB接続情報やSQLファイルの場所などREPLを実行するのに必要な情報が記載されています。</p>
<p>pom.xmlのREPL実行部分<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>repl<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">goal</span>&gt;</span>java<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">workingDirectory</span>&gt;</span>$&#123;basedir&#125;<span class="tag">&lt;/<span class="name">workingDirectory</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>jp.co.future.uroborosql.client.SqlREPL<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">arguments</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">argument</span>&gt;</span>REPL/repl.properties<span class="tag">&lt;/<span class="name">argument</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">phase</span>&gt;</span>process-classes<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>初期設定ではプロパティファイルの場所は<code>REPL/repl.properties</code>になっています。<br>REPL/repl.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">db.url=jdbc:h2:file:./target/db/repldb;</div><div class="line">db.user=sa</div><div class="line">db.password=</div><div class="line"></div><div class="line">sql.additionalClassPath=src/main/resources;$&#123;user.home&#125;/.m2/repository/com/h2database/h2/1.4.192/h2-1.4.192.jar</div></pre></td></tr></table></figure></p>
<ul>
<li>db.url<br>  DB接続URL</li>
<li>db.user<br>  DB接続ユーザ</li>
<li>db.password<br>  DB接続パスワード</li>
<li>sql.additionalClassPath<br>  REPL起動時に起動時クラスパス以外でクラスパスに追加する場所。<code>;</code>で区切ることで複数指定可。<br>  SQLファイルのルート（sqlフォルダの親フォルダ）をクラスパスに追加することで、自動的にSQLファイルがロードされます。<br>  合わせて接続するDBのJDBCドライバを含むJarを指定することで動的にJDBCドライバを読み込みます。</li>
</ul>
<p>このプロパティファイルを変更することでいろいろなDBに接続することができるようになります。</p>
<p>これまで見てきたようにREPLを利用することで簡単にSQL実行や動作確認ができるので、SQL開発に欠かせないツールです。色々なSQLを記述してREPLで試してみてください。</p>
<p>これで <em>Getting Started</em> は終了です。</p>
<p>uroboroSQLで使用するSQLの文法や基本的な操作については<a href="../basics/">基本操作</a>を参照してください。</p>
<div style="font-size:130%; font-weight:bold;"><br>  <a href="../why_uroborosql" style="float:left">&#60;&#60; Why uroboroSQL?</a><a href="../basics" style="float:right">基本操作 &#62;&#62;</a><br></div>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[基本操作]]></title>
      <url>./uroborosql-doc/basics/</url>
      <content type="html"><![CDATA[<hr>
<ul>
<li><a href="#2WaySQL">2WaySQL</a></li>
<li><a href="#OGNL式言語">OGNL式言語</a></li>
<li><a href="#基本操作">基本操作</a></li>
<li><a href="#トランザクション">トランザクション</a></li>
</ul>
<hr>
<p>この章では、uroboroSQLの基本操作をまとめています。</p>
<h2 id="2WaySQL"><a href="#2WaySQL" class="headerlink" title="2WaySQL"></a>2WaySQL</h2><p>2WaySQLは普通のSQL文をファイルに保存したものです。<br>そのままSQLクライアントツールで実行することもできますし、uroboroSQLで読み込んで実行することも出来ます。<br>（２つの実行方法があることから<strong>2Way</strong>SQLと呼ばれます）</p>
<h3 id="バインドパラメータ"><a href="#バインドパラメータ" class="headerlink" title="バインドパラメータ"></a>バインドパラメータ</h3><p>SQLにバインドするパラメータを <code>/*parameter name*/</code>の形式で指定することができます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	DEPARTMENT</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	DEPT_NO		=	<span class="comment">/*dept_no*/</span><span class="number">10</span></div><div class="line"><span class="keyword">AND</span>	DEPT_NAME	=	<span class="comment">/*dept_name*/</span><span class="string">'Sales'</span></div></pre></td></tr></table></figure>
<p>上の例では、<code>/*dept_no*/</code>, <code>/*dept_name*/</code> がバインドパラメータで、uroboroSQLから実行される際はこの部分が<code>?</code>に置き換わり、後ろの<code>10</code>や<code>&#39;Sales&#39;</code>が削除されます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	DEPARTMENT</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	DEPT_NO		=	?<span class="comment">/*dept_no*/</span></div><div class="line"><span class="keyword">AND</span>	DEPT_NAME	=	?<span class="comment">/*dept_name*/</span></div></pre></td></tr></table></figure>
<p>配列やList型の値をIN句のバインドパラメータとして指定することもできます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div><div class="line"><span class="keyword">WHERE</span></div><div class="line"><span class="comment">/*IF gender_list != null*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.GENDER	<span class="keyword">IN</span>	<span class="comment">/*gender_list*/</span>(<span class="string">'M'</span>)</div><div class="line"><span class="comment">/*END*/</span></div></pre></td></tr></table></figure>
<p>上の例に<code>gender_list</code>として{“M”, “F”}を指定すると以下のように変換されます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div><div class="line"><span class="keyword">WHERE</span></div><div class="line"><span class="comment">/*IF gender_list != null*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.GENDER	<span class="keyword">IN</span>	(?, ?)<span class="comment">/*gender_list*/</span></div><div class="line"><span class="comment">/*END*/</span></div></pre></td></tr></table></figure>
<p>バインドパラメータに指定できるJava型は以下になります。</p>
<h3 id="バインド出来るパラメータの型"><a href="#バインド出来るパラメータの型" class="headerlink" title="バインド出来るパラメータの型"></a>バインド出来るパラメータの型</h3><ul>
<li>プリミティブ型とそのラッパー型（ただし char と java.lang.Character は除く）</li>
<li>java.math.BigDecimal</li>
<li>java.math.BigInteger</li>
<li>java.lang.String</li>
<li>byte[]</li>
<li>java.sql.Date</li>
<li>java.sql.Time</li>
<li>java.sql.Timestamp</li>
<li>java.sql.Array</li>
<li>java.sql.Ref</li>
<li>java.sql.Blob</li>
<li>java.sql.Clob</li>
<li>java.sql.SQLXML</li>
<li>java.sql.Struct</li>
<li>列挙型(enum)</li>
<li>java.util.Date</li>
<li>java.util.Optional</li>
<li>java.util.OptionalInt</li>
<li>java.util.OptionalLong</li>
<li>java.util.OptionalDouble</li>
<li>java.time.LocalDateTime</li>
<li>java.time.OffsetDateTime</li>
<li>java.time.ZonedDateTime</li>
<li>java.time.LocalDate</li>
<li>java.time.LocalTime</li>
<li>java.time.OffsetTime</li>
<li>java.time.Year</li>
<li>java.time.YearMonth</li>
<li>java.time.MonthDay</li>
<li>java.time.Month</li>
<li>java.time.DayOfWeek</li>
</ul>
<h3 id="置換文字列"><a href="#置換文字列" class="headerlink" title="置換文字列"></a>置換文字列</h3><p>置換文字列を使うことでSQLの一部を動的に変更することができます。<br>置換文字列は <code>/*$parameter name*/</code> もしくは <code>/*#parameter name*/</code>と記述します。<br> <code>/*#parameter name*/</code> と記述した場合は、置換文字列の前後を<code>&#39;</code>(シングルクォート)で囲みます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span>    <span class="comment">/*$table_name*/</span></div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	GENDER	=	<span class="comment">/*#gender*/</span></div></pre></td></tr></table></figure>
<p>上の例では、<code>table_name</code>や<code>gender</code>に設定した値でSQLが置換されます。<br>これはバインドパラメータではなく発行されるSQLが置換される点に注意してください。</p>
<ul>
<li><code>table_name</code>に<code>employee</code>, <code>gender</code>に<code>M</code>を設定した場合<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span>	EMPLOYEE</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	GENDER	=	<span class="string">'M'</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>という風に置換されます。</p>
<p><strong>※置換文字列はSQLインジェクションを防ぐため、変換の際にシングルクォート<code>&#39;</code>を<code>&#39;&#39;</code>にエスケープします。</strong></p>
<h3 id="条件分岐"><a href="#条件分岐" class="headerlink" title="条件分岐"></a>条件分岐</h3><p>/*IF*/,/*ELIF*/,/*ELSE*/,/*END*/ を使用してSQLを動的に変更することができます。<br>IF, ELIF の評価式としてOGNL式言語を利用します。<br>（ OGNL式言語の説明は<a href="#OGNL式言語">こちら</a> )<br>また、標準でSF関数(<em>S</em>tring <em>F</em>unction)を使うことができます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div><div class="line"><span class="keyword">WHERE</span></div><div class="line"><span class="comment">/*IF SF.isNotEmpty(birth_date_from) and SF.isNotEmpty(birth_date_to)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.BIRTH_DATE	<span class="keyword">BETWEEN</span>	<span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span>	<span class="keyword">AND</span>	<span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></div><div class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_from)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.BIRTH_DATE	&gt;=		<span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span></div><div class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_to)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.BIRTH_DATE	&lt;		<span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></div><div class="line"><span class="comment">/*ELSE*/</span></div><div class="line"><span class="comment">/*END*/</span></div></pre></td></tr></table></figure>
<p>上の例ではIFの評価式として<code>SF.isNotEmpty()</code>を使用してバインド変数が<code>null</code>または<code>&quot;&quot;</code>でないことを評価しています。</p>
<p>バインド変数として<code>birth_date_from</code>に<code>2000-01-01</code>, <code>birth_date_to</code>に<code>2010-12-31</code>を指定した場合、生成されるSQLは以下のようになります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	EMP.BIRTH_DATE	<span class="keyword">BETWEEN</span>	<span class="string">'2000-01-01'</span><span class="comment">/*birth_date_from*/</span>	<span class="keyword">AND</span>	<span class="string">'2010-12-31'</span><span class="comment">/*birth_date_to*/</span></div></pre></td></tr></table></figure>
<p>ここでEMP.BIRTH_DATEの前にあった<code>AND</code>が消えていることに注目してください。<br>uroboroSQLでは動的SQLを生成する際、WHERE句の後ろに<code>AND</code>や<code>OR</code>が来る場合はそれを削除してSQL文として正しい状態にします。<br>ただし、上の加工前SQLのようにSQL文として不正な状態になってしまうのでSQLクライアントツールからは実行できないという欠点もあります。<br>このようにSQL文として不正になることを防ぐために、WHERE句のあとに他に影響を与えない評価を入れる方法があります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	<span class="number">1</span>				=		<span class="number">1</span>	// &lt;<span class="comment">-- 必ずtrueとなる評価を入れる</span></div><div class="line"><span class="comment">/*IF SF.isNotEmpty(birth_date_from) and SF.isNotEmpty(birth_date_to)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.BIRTH_DATE	<span class="keyword">BETWEEN</span>	<span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span>	<span class="keyword">AND</span>	<span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></div><div class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_from)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.BIRTH_DATE	&gt;=		<span class="comment">/*birth_date_from*/</span><span class="string">'1990-01-01'</span></div><div class="line"><span class="comment">/*ELIF SF.isNotEmpty(birth_date_to)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.BIRTH_DATE	&lt;		<span class="comment">/*birth_date_to*/</span><span class="string">'1999-12-31'</span></div><div class="line"><span class="comment">/*ELSE*/</span></div><div class="line"><span class="comment">/*END*/</span></div></pre></td></tr></table></figure>
<h3 id="範囲の有効化"><a href="#範囲の有効化" class="headerlink" title="範囲の有効化"></a>範囲の有効化</h3><p>/*BEGIN*/, /*END*/ で囲まれた範囲は、その中の/*IF*/, /*ELIF*/のうち、どれか1つでも真(true)になった場合に出力されます。範囲内の全ての評価式が偽（false）の場合、/*BEGIN*/, /*END*/ で囲まれた範囲は出力されません。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div><div class="line"><span class="comment">/*BEGIN*/</span></div><div class="line"><span class="keyword">WHERE</span></div><div class="line"><span class="comment">/*IF SF.isNotEmpty(first_name)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.FIRST_NAME	=	<span class="comment">/*first_name*/</span><span class="string">'Bob'</span></div><div class="line"><span class="comment">/*END*/</span></div><div class="line"><span class="comment">/*IF SF.isNotEmpty(last_name)*/</span></div><div class="line"><span class="keyword">AND</span>	EMP.LAST_NAME	=	<span class="comment">/*last_name*/</span><span class="string">'Smith'</span></div><div class="line"><span class="comment">/*END*/</span></div><div class="line"><span class="comment">/*END*/</span></div></pre></td></tr></table></figure>
<p>上の例で、バインドパラメータ <code>first_name</code>に<code>Willson</code>, <code>last_name</code>に<code>null</code>を指定した場合は以下のようになります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	EMP.FIRST_NAME	=	?<span class="comment">/*first_name*/</span></div></pre></td></tr></table></figure>
<p>バインドパラメータ <code>first_name</code>, <code>last_name</code>ともに<code>null</code>を指定した場合は以下のようになります。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	*</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	EMPLOYEE	EMP</div></pre></td></tr></table></figure>
<h2 id="OGNL式言語"><a href="#OGNL式言語" class="headerlink" title="OGNL式言語"></a>OGNL式言語</h2><p>uroboroSQLでは、条件分岐の式として<a href="https://github.com/jkuhnert/ognl" target="_blank" rel="external">OGNL式言語</a>を利用することができます。<br>条件分岐の式として使用する場合、評価結果が真偽値(true/false)になるように記述してください。</p>
<h3 id="リテラル"><a href="#リテラル" class="headerlink" title="リテラル"></a>リテラル</h3><p>以下のリテラルが使用できます。</p>
<ul>
<li>“a”(java.lang.String)</li>
<li>‘a’(char)</li>
<li>1(int)</li>
<li>1L(long)</li>
<li>0.1F(float)</li>
<li>0.1D(double)</li>
<li>0.1B(java.math.BigDecimal)</li>
<li>1H(java.math.BigInteger)</li>
<li>true, false(Boolean)</li>
<li>null</li>
</ul>
<h3 id="演算子"><a href="#演算子" class="headerlink" title="演算子"></a>演算子</h3><p>以下の演算子が使用できます。</p>
<h4 id="算術演算子"><a href="#算術演算子" class="headerlink" title="算術演算子"></a>算術演算子</h4><ul>
<li>e1 + e2(足し算)</li>
<li>e1 - e2 (引き算)</li>
<li>e1 * e2 (掛け算)</li>
<li>e1 / e2 (割り算)</li>
<li>e1 % e2 (余り)</li>
</ul>
<h4 id="比較演算子"><a href="#比較演算子" class="headerlink" title="比較演算子"></a>比較演算子</h4><ul>
<li>e1 eq e2, e1 == e2 (等しい)<br>→ e1・e2のいずれかがnullの場合、両方ともnullの時のみe1とe2は等しい。<br>→ e1・e2が同じオブジェクトの場合、またはequals()メソッドにより等しいと判断される場合、e1とe2は等しい。<br>→ e1・e2が数値の場合、倍精度浮動小数点数が等しい時のみe1とe2は等しい。<br>→ その以外の場合、e1とe2は等しくない。</li>
<li>e1 neq e2, e1 != e2 (等しくない)</li>
<li>e1 lt e2, e1 &lt; e2 (小なり)</li>
<li>e1 lte e2, e1 &lt;= e2 (小なりイコール)</li>
<li>e1 gt e2, e1 &gt; e2 (大なり)</li>
<li>e1 gte e2, e1 &gt;= e2 (大なりイコール)</li>
</ul>
<h4 id="論理演算子"><a href="#論理演算子" class="headerlink" title="論理演算子"></a>論理演算子</h4><ul>
<li>e1 or e2, e1 || e2 (論理和)</li>
<li>e1 and e2, e1 &amp;&amp; e2 (論理積)</li>
<li>not e, ! e (論理否定)</li>
</ul>
<h4 id="連結演算子"><a href="#連結演算子" class="headerlink" title="連結演算子"></a>連結演算子</h4><ul>
<li>e1 + e2 (文字列連結)</li>
</ul>
<h4 id="メソッド・フィールドの呼び出し"><a href="#メソッド・フィールドの呼び出し" class="headerlink" title="メソッド・フィールドの呼び出し"></a>メソッド・フィールドの呼び出し</h4><p>以下のようにメソッド・フィールドの呼び出しができます。</p>
<ul>
<li>e.method(args) (メソッドの呼び出し)</li>
<li>e.property (フィールドの呼び出し)</li>
</ul>
<h4 id="StringFunction-SF"><a href="#StringFunction-SF" class="headerlink" title="StringFunction(SF)"></a>StringFunction(SF)</h4><p>uroboroSQLではOGNL式を利用する際、標準でStringFunction（SF）を使用することができます。<br>OGNL式と合わせてStringFunctionクラスのメソッドを呼び出すことができます。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*IF SF.isNotEmpty(emp_no)*/</span></div><div class="line">   <span class="comment">-- emp_noがnull または ""でない場合に処理される</span></div><div class="line"><span class="comment">/*END*/</span></div></pre></td></tr></table></figure>
<p>StringFunctionが提供するメソッドの一覧です。</p>
<table>
<thead>
<tr>
<th style="text-align:left">メソッド名</th>
<th style="text-align:left">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">booean SF.isEmpty(String str)</td>
<td style="text-align:left">対象文字列が空文字であること判定する</td>
</tr>
<tr>
<td style="text-align:left">boolean SF.isNotEmpty(String str)</td>
<td style="text-align:left">対象文字列が空文字でないことを判定する</td>
</tr>
<tr>
<td style="text-align:left">boolean SF.isBlank(String str)</td>
<td style="text-align:left">対象文字列が空文字、もしくは空白であること判定する</td>
</tr>
<tr>
<td style="text-align:left">boolean SF.isNotBlank(String str)</td>
<td style="text-align:left">対象文字列が空文字、もしくは空白でないこと判定する</td>
</tr>
<tr>
<td style="text-align:left">String SF.trim(String str)</td>
<td style="text-align:left">文字列の前後の空白を除去する。nullを渡した場合は結果もnullとなる</td>
</tr>
<tr>
<td style="text-align:left">String SF.trimToEmpty(String str)</td>
<td style="text-align:left">文字列の前後の空白を除去する。nullを渡した場合は空文字となる</td>
</tr>
<tr>
<td style="text-align:left">String SF.left(String str, int len)</td>
<td style="text-align:left">文字列の先頭から指定した文字数の文字列を取得する</td>
</tr>
<tr>
<td style="text-align:left">String SF.right(String str, int len)</td>
<td style="text-align:left">文字列の最後から指定した文字数の文字列を取得する</td>
</tr>
<tr>
<td style="text-align:left">String SF.mid(String str, int pos, int len)</td>
<td style="text-align:left">文字列の指定した位置から指定した文字数の文字列を取得する</td>
</tr>
<tr>
<td style="text-align:left">String SF.rightPad(String str, int size)</td>
<td style="text-align:left">文字列の末尾に空白を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String SF.rightPad(String str, int size, char padChar)</td>
<td style="text-align:left">文字列の末尾に指定した埋め込み文字を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String SF.leftPad(String str, int size)</td>
<td style="text-align:left">文字列の先頭に空白を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String SF.leftPad(String str, int size, char padChar)</td>
<td style="text-align:left">文字列の先頭に指定した埋め込み文字を埋めて指定された長さにする</td>
</tr>
<tr>
<td style="text-align:left">String[] SF.split(String str)</td>
<td style="text-align:left">文字列を空白で区切って配列に格納します。<br>nullが入力された場合はnullを返します</td>
</tr>
<tr>
<td style="text-align:left">String[] SF.split(String str, char separatorChar)</td>
<td style="text-align:left">文字列を指定した区切り文字で区切って配列に格納します。<br>nullが入力された場合はnullを返します</td>
</tr>
<tr>
<td style="text-align:left">String[] SF.split(String str, String separatorChars, int max)</td>
<td style="text-align:left">文字列を指定した区切り文字で区切って配列に格納します。<br>nullが入力された場合はnullを返します</td>
</tr>
<tr>
<td style="text-align:left">String SF.capitalize(String str)</td>
<td style="text-align:left">文字列の先頭文字を大文字にする</td>
</tr>
<tr>
<td style="text-align:left">String SF.uncapitalize(String str)</td>
<td style="text-align:left">文字列の先頭を小文字にする</td>
</tr>
</tbody>
</table>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>uroboroSQLを利用した基本的なDB操作を説明します。</p>
<h3 id="DB接続"><a href="#DB接続" class="headerlink" title="DB接続"></a>DB接続</h3><p>DBに接続するためには<code>SqlConfig</code>インタフェースのインスタンスを生成する必要があります。<br>標準で<code>DefaultSqlConfig</code>クラスが提供されているので、このクラスのファクトリメソッドを使用して生成します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// JDBC接続を行うSqlConfigの生成</span></div><div class="line"><span class="comment">// SqlConfig config = DefaultSqlConfig.getConfig(url, user, password);</span></div><div class="line">SqlConfig config = DefaultSqlConfig.getConfig(<span class="string">"jdbc:h2:mem:uroborosql"</span>, <span class="string">"sa"</span>, <span class="string">""</span>);</div><div class="line"></div><div class="line"><span class="comment">// DataSourceを使用したDB接続を行うSqlConfigの生成</span></div><div class="line"><span class="comment">// SqlConfig config = DefaultSqlConfig.getConfig(datasourceName);</span></div><div class="line">SqlConfig config = DefaultSqlConfig.getConfig(<span class="string">"java:comp/env/jdbc/datasource"</span>);</div></pre></td></tr></table></figure>
<p>次にすべての操作の基点となる<code>SqlAgent</code>インタフェースのインスタンスを取得します。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> (SqlAgent agent = config.createAgent()) &#123;</div><div class="line">	<span class="comment">// この中でSQLの操作を行う</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>SqlAgent</code>インタフェースは<code>java.lang.AutoClosable</code>インタフェースを実装しているので、上の例のようにtry-with-resourcesの中で宣言することで、終了時に自動的にclose処理が呼び出され、中で保持しているConnectionなどのオブジェクトも正しく破棄されます。</p>
<h3 id="SQLファイルの管理"><a href="#SQLファイルの管理" class="headerlink" title="SQLファイルの管理"></a>SQLファイルの管理</h3><p>uroboroSQLではSQL文の書かれたファイルのパスを指定してSQLを実行することができます。<br>その際、SQLファイルはクラスパスから参照できる場所に配置されている必要があります。</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">src</div><div class="line"><span class="code">    └─main</span></div><div class="line"><span class="code">        └─resources</span></div><div class="line"><span class="code">            └─sql</span></div><div class="line"><span class="code">                ├─department</span></div><div class="line"><span class="code">                │    ├─insert_department.sql</span></div><div class="line"><span class="code">                │    └─select_department.sql</span></div><div class="line"><span class="code">                └─employee</span></div><div class="line"><span class="code">                     ├─insert_employee.sql</span></div><div class="line"><span class="code">                     └─select_employee.sql</span></div></pre></td></tr></table></figure>
<p>上のようなフォルダ構成の場合で、<code>src/main/resources/</code>がクラスパスに指定されている場合、<br>その下のsqlフォルダをルートフォルダとした相対パスでSQLファイルを指定することができます。<br>それぞれのSQLファイルは以下のような<code>SQL名</code>となります</p>
<ul>
<li><code>insert_department.sql</code> -&gt; <code>department/insert_department</code></li>
<li><code>select_department.sql</code> -&gt; <code>department/select_department</code></li>
<li><code>insert_employee.sql</code> -&gt; <code>employee/insert_employee</code></li>
<li><code>select_employee.sql</code> -&gt; <code>employee/select_employee</code></li>
</ul>
<p>また、SQLファイルはjarの中にリソースとして含めることもできます。<br>その場合、リソースのルート直下のsqlフォルダをルートフォルダとした相対パスでSQLファイルを指定することができます。</p>
<h3 id="検索"><a href="#検索" class="headerlink" title="検索"></a>検索</h3><p>SQLを検索する方法は大きく２つあります。</p>
<ol>
<li><code>SQL名</code>を指定して検索</li>
<li>SQL文の文字列を指定して検索</li>
</ol>
<p>1つ目の<code>SQL名</code>を指定する場合は、<a href="#SQLファイルの管理">SQLファイルの管理</a>で説明した<code>SQL名</code>を用いてSQLファイルを指定し、<code>SqlQuery</code>インタフェースのインスタンスを取得します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 検索結果の先頭１件をMapで取得</span></div><div class="line">Map&lt;String, Object&gt; employee = agent.query(<span class="string">"employee/select_employee"</span>).param(<span class="string">"emp_no"</span>, <span class="number">1001</span>).first();</div></pre></td></tr></table></figure>
<p><code>SqlQuery</code>インタフェースはFluent APIを提供しているので、バインドパラメータの追加や検索結果の取得をFluent APIを使用して記述することができます。</p>
<p>2つ目のSQL文の文字列を指定する場合は、<code>SqlAgent#queryWith(&quot;[SQL文字列]&quot;)</code>を使用して<code>SqlQuery</code>インタフェースのインスタンスを取得します。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// employeeテーブルの各行の名前の一覧を取得</span></div><div class="line">List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">agent.queryWith(<span class="string">"select first_name, last_name where employee"</span>).collect().forEach(row -&gt; names.add(row.get(<span class="string">"first_name"</span>) + <span class="string">" "</span> + row.get(<span class="string">"last_name"</span>)));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>SQLQuery</code>インタフェースの主なAPIは以下になります。</p>
<ul>
<li>バインドパラメータ設定メソッド<ul>
<li><code>SqlQuery#param(String key, Object value)</code><br>  バインドパラメータや置換文字列として使用するキーと値のセットを設定する</li>
<li><code>SqlQuery#paramList(String key, Object... value)</code><br>  IN句のバインドパラメータに使用するキーと値のセットを設定する</li>
</ul>
</li>
</ul>
<p>他にもパラメータの型に応じたバインドパラメータ設定メソッドが提供されています。</p>
<ul>
<li>終端処理用メソッド<ul>
<li><code>Map&lt;String, Object&gt; SqlQuery#first()</code><br>  検索結果の1行目をMapに詰めて取得する</li>
<li><code>List&lt;Map&lt;String, Object&gt;&gt; SqlQuery#collect()</code><br>  検索結果の各行をMapに詰めたListの形式で取得する</li>
<li><code>Stream&lt;Map&lt;String, Object&gt; SqlQuery#stream()</code><br>  検索結果をJava8で追加されたStreamの形式で取得する</li>
<li><code>ResultSet SqlQuery#resultSet()</code><br>  検索結果のResultSetを取得する</li>
</ul>
</li>
</ul>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>DB更新処理も検索処理と同様<code>SQL名</code>を指定する場合と直接SQL文字列を記述する２つのAPIが提供されています。<br><code>agent#update()</code> もしくは <code>agent#updateWith()</code>を使用してSqlUpdateインタフェースのインスタンスを取得します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// １件挿入</span></div><div class="line"><span class="keyword">int</span> count = agent.update(<span class="string">"department/insert_department"</span>).param(<span class="string">"dept_no"</span>, <span class="number">1111</span>).param(<span class="string">"dept_name"</span>, <span class="string">"Sales"</span>).count();</div><div class="line"></div><div class="line"><span class="comment">// 更新</span></div><div class="line"><span class="keyword">int</span> count = agent.updateWith(<span class="string">"update employee set first_name = /*first_name*/ where emp_no = /*emp_no*/"</span>).param(<span class="string">"emp_no"</span>, <span class="number">1001</span>).param(<span class="string">"first_name"</span>, <span class="string">"Bob"</span>).count();</div></pre></td></tr></table></figure>
<p><code>SqlUpdate</code>インタフェースの主なAPIは以下になります。</p>
<ul>
<li>バインドパラメータ設定メソッド<ul>
<li><code>SqlUpdate#param(String key, Object value)</code><br>  バインドパラメータや置換文字列として使用するキーと値のセットを設定する</li>
<li><code>SqlUpdate#paramList(String key, Object... value)</code><br>  IN句のバインドパラメータに使用するキーと値のセットを設定する</li>
</ul>
</li>
</ul>
<p>他にもパラメータの型に応じたバインドパラメータ設定メソッドが提供されています。</p>
<ul>
<li>終端処理用メソッド<ul>
<li><code>int SqlUpdate#count()</code><br>  更新処理を行い、登録、更新を行った行数を返します</li>
</ul>
</li>
</ul>
<h3 id="バッチ更新"><a href="#バッチ更新" class="headerlink" title="バッチ更新"></a>バッチ更新</h3><p>大量のデータを一括で更新する場合、通常の更新では都度SQLが発行されるため速度が遅く問題になります。<br>そういったケースに対応するため、uroboroSQLではバッチ更新用のAPIを提供しています。</p>
<p>バッチ更新も更新と同様SqlUpdateインタフェースで行います。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// バッチ登録で使用するデータをファイルから取得</span></div><div class="line">List&lt;Map&lt;String, String&gt;&gt; deptList = getDataByFile(Paths.get(<span class="string">"src/main/resources/data/department.tsv"</span>));</div><div class="line"><span class="comment">// SqlUpdateインタフェースのインスタンスを取得</span></div><div class="line">SqlUpdate deptUpdate = agent.update(<span class="string">"department/insert_department"</span>);</div><div class="line"><span class="comment">// 登録件数分繰り返す</span></div><div class="line">deptList.forEach(row -&gt; &#123;</div><div class="line">	<span class="comment">// １件分のデータをパラメータとして設定したら、SqlUpdate#addBatch()を呼び出し、バッチパラメータとして登録する</span></div><div class="line">	row.forEach(deptUpdate::param);</div><div class="line">	deptUpdate.addBatch();</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 最後にSqlUpdate#batch()終端処理を呼び出し一括登録する</span></div><div class="line"><span class="keyword">int</span>[] deptCount = deptUpdate.batch();</div></pre></td></tr></table></figure>
<p><code>SqlUpdate</code>インタフェースのバッチ更新用のAPIは以下になります。</p>
<ul>
<li><p>バッチパラメータ登録メソッド</p>
<ul>
<li><code>SqlUpdate addBatch()</code><br>  1行登録する分のパラメータを設定した後呼び出す。このメソッドを呼び出すことで<br>  それまでに設定したバインドパラメータをまとめて1行分のデータとして保持される</li>
</ul>
</li>
<li><p>終端処理用メソッド</p>
<ul>
<li><code>int[] SqlUpdate#batch()</code><br>  一括更新処理を行い、登録、更新を行った行数の配列を返す。（※）<br>  （※）戻り値については利用するJDBCドライバの仕様によって変わる場合があります。</li>
</ul>
</li>
</ul>
<p><strong>（注意）</strong><br>上の例では<code>deptList</code>の件数分ループを回してすべての行を<code>addBatch()</code>していますが、その間はメモリにバインドしたパラメータが蓄積されるため、件数が増えると<code>Out Of Memory</code>になる可能性が出てきます。<br><code>Out Of Memory</code>を回避するために、一定の件数（100件とか1,000件など）で一度<code>SqlUpdate#batch()</code>を呼び出し、蓄積したパラメータをクリアするようにしてください。</p>
<h3 id="プロシージャの実行"><a href="#プロシージャの実行" class="headerlink" title="プロシージャの実行"></a>プロシージャの実行</h3><p>uroboroSQLでは、SQLの検索/更新のほかDBが提供するストアドプロシージャの呼び出し用APIも提供しています。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// SqlUpdateインタフェースのインスタンスを取得</span></div><div class="line">Map&lt;String, Object&gt; result = agent.procWith(<span class="string">"&#123;call product_id_exist_check(/*product_id*/, /*check_out*/)&#125;"</span>).param(<span class="string">"product_id"</span>, <span class="number">0</span>).outParam(<span class="string">"check_out"</span>, java.sql.JDBCType.NUMERIC).call();</div><div class="line">BigDecimal checkOut = (BigDecimal)result.get(<span class="string">"check_out"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="トランザクション"><a href="#トランザクション" class="headerlink" title="トランザクション"></a>トランザクション</h2><p>uroboroSQLではローカルトランザクションを提供します。<br>トランザクションを利用することで、エラー発生時でも一部のデータだけ登録を成功させるといった細かな制御ができるようになります。</p>
<h3 id="トランザクションの開始と終了"><a href="#トランザクションの開始と終了" class="headerlink" title="トランザクションの開始と終了"></a>トランザクションの開始と終了</h3><p>uroboroSQLで提供するトランザクションのレベルは以下の3つです</p>
<table>
<thead>
<tr>
<th style="text-align:left">トランザクションタイプ</th>
<th style="text-align:left">トランザクション有り</th>
<th style="text-align:left">トランザクションなし</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">required</td>
<td style="text-align:left">トランザクション内で処理を実行</td>
<td style="text-align:left">新たなトランザクションを開始して処理を実行</td>
</tr>
<tr>
<td style="text-align:left">requiresNew</td>
<td style="text-align:left">既存のトランザクションを停止し、新たなトランザクションを開始して処理を実行。<br>トランザクションが終了すると停止していたトランザクションを再開させる</td>
<td style="text-align:left">新たなトランザクションを開始して処理を実行</td>
</tr>
<tr>
<td style="text-align:left">notSupported</td>
<td style="text-align:left">既存のトランザクションを停止し、トランザクション外で処理を実行。<br>処理が終了すると停止していたトランザクションを再開させる</td>
<td style="text-align:left">トランザクション外で処理を実行</td>
</tr>
</tbody>
</table>
<p><code>SqlAgent</code>インタフェースにトランザクションタイプに応じたメソッドが提供されており、そのメソッドを呼び出すことでトランザクションの開始と終了を制御します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">agent.required(() -&gt; &#123;</div><div class="line">	<span class="comment">//トランザクション開始</span></div><div class="line">	agent.contextWith(<span class="string">"insert into employee (emp_no) values (/*emp_no*/1001)"</span>).param(<span class="string">"emp_no"</span>, <span class="number">1001</span>).count();</div><div class="line"></div><div class="line">	agent.requiresNew(() -&gt; &#123;</div><div class="line">		<span class="comment">//新しい トランザクション開始</span></div><div class="line">		agent.contextWith(<span class="string">"insert into department (dept_no, dept_name) values (/*dept_no*/1111, /*dept_name*/'Sales')"</span>).param(<span class="string">"dept_no"</span>, <span class="number">1002</span>).param(<span class="string">"dept_name"</span>, <span class="string">"export"</span>).count();</div><div class="line">		<span class="comment">//トランザクション終了 commit</span></div><div class="line">	&#125;);</div><div class="line">	<span class="comment">//トランザクション終了 commit</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="コミットとロールバック"><a href="#コミットとロールバック" class="headerlink" title="コミットとロールバック"></a>コミットとロールバック</h3><p>トランザクションのラムダ式が正常に終了すればトランザクションはコミットされます。<br>トランザクションのラムダ式が例外をスローした場合はトランザクションをロールバックします。</p>
<p>例外をスローさせずに明示的にロールバックを行う場合は<code>SqlAgent#setRollbackOnly()</code>を呼び出します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">agent.required(() -&gt; &#123;</div><div class="line">	<span class="comment">//トランザクション開始</span></div><div class="line">	agent.updateWith(<span class="string">"insert into employee (emp_no) values (/*emp_no*/1001)"</span>).param(<span class="string">"emp_no"</span>, <span class="number">1001</span>).count();</div><div class="line"></div><div class="line">	agent.requiresNew(() -&gt; &#123;</div><div class="line">		<span class="comment">//新しい トランザクション開始</span></div><div class="line">		agent.updateWith(<span class="string">"insert into department (dept_no, dept_name) values (/*dept_no*/1111, /*dept_name*/'Sales')"</span>).param(<span class="string">"dept_no"</span>, <span class="number">1002</span>).param(<span class="string">"dept_name"</span>, <span class="string">"export"</span>).count();</div><div class="line">		<span class="comment">//トランザクション終了 明示的なrollback</span></div><div class="line">		agent.setRollbackOnly();</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">//トランザクション終了 commit</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="セーブポイント"><a href="#セーブポイント" class="headerlink" title="セーブポイント"></a>セーブポイント</h3><p>トランザクション内でセーブポイントを設けることで、トランザクション内の特定の更新のみ取り消すといった細かな制御ができます。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">agent.required(() -&gt; &#123;</div><div class="line">	<span class="comment">//トランザクション開始</span></div><div class="line">	agent.update(<span class="string">"employee/insert_employee"</span>).param(<span class="string">"emp_no"</span>, <span class="number">1001</span>).count();</div><div class="line"></div><div class="line">	agent.setSavepoint(<span class="string">"sp"</span>);</div><div class="line">	agent.update(<span class="string">"employee/insert_employee"</span>).param(<span class="string">"emp_no"</span>, <span class="number">1002</span>).count();</div><div class="line"></div><div class="line">	assertThat(agent.query(<span class="string">"employee/select_employee"</span>).collect().size(), <span class="number">2</span>);</div><div class="line"></div><div class="line">	agent.rollback(<span class="string">"sp"</span>);<span class="comment">//最後のinsertを取消</span></div><div class="line"></div><div class="line">	assertThat(agent.query(<span class="string">"employee/select_employee"</span>).collect().size(), <span class="number">1</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<div style="font-size:130%; font-weight:bold;"><br>  <a href="../getting_started" style="float:left">&#60;&#60; Getting Started</a><a href="../advanced" style="float:right">高度な操作 &#62;&#62;</a><br></div>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[高度な操作]]></title>
      <url>./uroborosql-doc/advanced/</url>
      <content type="html"><![CDATA[<hr>
<ul>
<li><a href="#バインド出来るパラメーターの型">バインド出来るパラメーターの型</a></li>
<li><a href="#バッチ実行">バッチ実行</a></li>
<li><a href="#ストアドプロシージャの実行">ストアドプロシージャの実行</a></li>
<li><a href="#トランザクション">トランザクション</a></li>
<li><a href="#エラーハンドリング">エラーハンドリング </a></li>
<li><a href="#ストリームAPI">ストリームAPI</a></li>
<li><a href="#ログ">ログ</a></li>
<li><a href="#式言語">式言語</a></li>
</ul>
<hr>
<h2 id="バインド出来るパラメーターの型"><a href="#バインド出来るパラメーターの型" class="headerlink" title="バインド出来るパラメーターの型"></a>バインド出来るパラメーターの型</h2><p>uroboroSQLでバインド出来るパラメーターの型は、下記の通りです。</p>
<ul>
<li>プリミティブ型とそのラッパー型（ただし char と java.lang.Character は除く）</li>
<li>java.math.BigDecimal</li>
<li>java.math.BigInteger</li>
<li>java.lang.String</li>
<li>byte[ ]</li>
<li>java.sql.Date</li>
<li>java.sql.Time</li>
<li>java.sql.Timestamp</li>
<li>java.sql.Array</li>
<li>java.sql.Ref</li>
<li>java.sql.Blob</li>
<li>java.sql.Clob</li>
<li>java.sql.SQLXML</li>
<li>java.sql.Struct</li>
<li>列挙型(enum)</li>
<li>java.util.Date</li>
<li>java.util.Optional</li>
<li>java.util.OptionalInt</li>
<li>java.util.OptionalLong</li>
<li>java.util.OptionalDouble</li>
<li>java.time.LocalDateTime</li>
<li>java.time.OffsetDateTime</li>
<li>java.time.ZonedDateTime</li>
<li>java.time.LocalDate</li>
<li>java.time.LocalTime</li>
<li>java.time.OffsetTime</li>
<li>java.time.Year</li>
<li>java.time.YearMonth</li>
<li>java.time.MonthDay</li>
<li>java.time.Month</li>
<li>java.time.DayOfWeek</li>
</ul>
<h2 id="バッチ実行"><a href="#バッチ実行" class="headerlink" title="バッチ実行"></a>バッチ実行</h2><p>複数の挿入/更新/削除処理を実行する場合、<code>addBatch</code>と<code>executeBatch</code>メソッドを使用することでバッチ更新を行うことが出来ます。<br>例として、以下のSQLを実行するケースを考えてみます。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span></div><div class="line">    ms_products</div><div class="line"><span class="keyword">values</span>(</div><div class="line">    <span class="comment">/* product_id */</span><span class="string">'0040'</span>,</div><div class="line">    <span class="comment">/* product_category_id */</span><span class="string">'09'</span>,</div><div class="line">    <span class="comment">/* product_name */</span><span class="string">'コーラ'</span>,</div><div class="line">    <span class="comment">/* product_price */</span><span class="number">120</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>挿入処理を行いたいデータが複数存在する場合、以下の様に記述をすることでバッチ更新が実行されます。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">sqlContext.addParam(<span class="string">"product_id"</span>, <span class="string">"0040"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_category_id"</span>, <span class="string">"09"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_name"</span>, <span class="string">"コーラ"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_price"</span>, <span class="number">120</span>);</div><div class="line">sqlContext.addBatch();</div><div class="line"></div><div class="line">sqlContext.addParam(<span class="string">"product_id"</span>, <span class="string">"0041"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_category_id"</span>, <span class="string">"09"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_name"</span>, <span class="string">"サイダー"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_price"</span>, <span class="number">120</span>);</div><div class="line">sqlContext.addBatch();</div><div class="line"></div><div class="line">sqlAgent.executeBatch(sqlContext);</div></pre></td></tr></table></figure></p>
<h2 id="ストアドプロシージャの実行"><a href="#ストアドプロシージャの実行" class="headerlink" title="ストアドプロシージャの実行"></a>ストアドプロシージャの実行</h2><p><code>executeProcedure</code>メソッドを利用することで、ストアドプロシージャを実行することが出来ます。<br>例えば、<code>product_id</code>で商品の有無を確認するストアドプロシージャ<code>product_id_exists_check</code>を実行する以下SQLを考えます。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">call</span> product_id_exists_check(<span class="comment">/*product_id*/</span><span class="string">'0010'</span>, <span class="comment">/*check_out*/</span>)</div></pre></td></tr></table></figure></p>
<p>この時には、以下の様に記述をすることでストアドプロシージャを実行することが出来ます。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sqlContext.addParam(<span class="string">"product_id"</span>,<span class="string">"0010"</span> );</div><div class="line">sqlContext.addOutParam(<span class="string">"check_out"</span>,Types.NUMERIC);</div><div class="line"></div><div class="line">Map&lt;String, Object&gt; result = sqlAgent.executeProcedure(sqlContext);</div></pre></td></tr></table></figure></p>
<p><code>addOutParam</code>メソッドにより、<code>check_out</code>を戻り値として返されるパラメーターとして設定をしています。このプロシージャの実行結果は<code>result.get(&quot;check_out&quot;)</code>により取得が可能です。</p>
<h2 id="トランザクション"><a href="#トランザクション" class="headerlink" title="トランザクション"></a>トランザクション</h2><h2 id="エラーハンドリング"><a href="#エラーハンドリング" class="headerlink" title="エラーハンドリング"></a>エラーハンドリング</h2><p>エラーが発生した際、エラーコードの種類によるリトライを設定することが出来ます。<br>リトライするエラーコード、最大リトライ回数、リトライ時の待機時間を下記のように指定します。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; sqlRetryCodeList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">sqlRetryCodeList.add(<span class="string">"54"</span>);</div><div class="line">sqlRetryCodeList.add(<span class="string">"60"</span>);</div><div class="line">agentFactory.setSqlRetryCodeList(sqlRetryCodeList); <span class="comment">// リトライ対象とするSQLエラーコード。デフォルトは指定なし。</span></div><div class="line"></div><div class="line">agentFactory.setDefaultMaxRetryCount(<span class="number">3</span>); <span class="comment">// 最大リトライ回数。デフォルトは0。</span></div><div class="line"></div><div class="line">agentFactory.setDefaultSqlRetryWaitTime(<span class="number">1000</span>); <span class="comment">// リトライ時の待機時間(ms)。デフォルトは0。</span></div></pre></td></tr></table></figure></p>
<h2 id="ストリームAPI"><a href="#ストリームAPI" class="headerlink" title="ストリームAPI"></a>ストリームAPI</h2><p>実行したSQLの結果を取得したい際には、ストリームAPIを利用することが出来ます。  </p>
<h2 id="ログ"><a href="#ログ" class="headerlink" title="ログ"></a>ログ</h2><p>uroboroSQLではログ出力ライブラリとしてLogbackを使用しています。Logbackの詳細は<a href="http://logback.qos.ch/manual/index_ja.html" target="_blank" rel="external">公式のドキュメント</a>を参照して下さい。<br>クラス毎で出力されるログ内容は以下表の通りです。</p>
<table>
<thead>
<tr>
<th style="text-align:center">クラス名</th>
<th style="text-align:center">TRACE</th>
<th style="text-align:center">DEBUG</th>
<th style="text-align:center">INFO</th>
<th style="text-align:center">WARN</th>
<th style="text-align:center">ERROR</th>
<th style="text-align:center">FATAL</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AbstractAgent</td>
<td style="text-align:center">変換前SQL</td>
<td style="text-align:center">実行時SQL</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">DebugSqlFilter</td>
<td style="text-align:center">-</td>
<td style="text-align:center">パラメーター/<br\>対象データ数/<br\>実行結果</br\></br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">IfNode</td>
<td style="text-align:center">-</td>
<td style="text-align:center">評価式/<br\>判定結果/<br\>パラメーター</br\></br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">Parameter</td>
<td style="text-align:center">-</td>
<td style="text-align:center">パラメーターの設定</td>
<td style="text-align:center">-</td>
<td style="text-align:center">サブパラメーター値にNULLを設定</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SecretColumnSqlFilter</td>
<td style="text-align:center">-</td>
<td style="text-align:center">バッチ処理追加件数/<br\>ストアドプロシージャ出力パラメーター</br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlAgent</td>
<td style="text-align:center">ステートメントのクローズ</td>
<td style="text-align:center">処理実行アナウンス/<br\>リトライ実行アナウンス/<br\>SQL実行時間</br\></br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">エラーメッセージ</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlContext</td>
<td style="text-align:center">-</td>
<td style="text-align:center">バッチ処理追加件数/<br\>ストアドプロシージャ出力パラメーター</br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlContextFactory</td>
<td style="text-align:center">-</td>
<td style="text-align:center">定数パラメーター</td>
<td style="text-align:center">-</td>
<td style="text-align:center">定数名の重複</td>
<td style="text-align:center">エラーメッセージ</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlLoader</td>
<td style="text-align:center">SQL定義ファイルの読み込み完了</td>
<td style="text-align:center">SQL定義ファイルの読み込み開始/読み込み中</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">デフォルトファイルパスの設定/<br\>デフォルト拡張子/<br\>空のSQLキャッシュの返却</br\></br\></td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table>
<h2 id="式言語"><a href="#式言語" class="headerlink" title="式言語"></a>式言語</h2><h3 id="リテラル"><a href="#リテラル" class="headerlink" title="リテラル"></a>リテラル</h3><p>以下のリテラルが使用できます。</p>
<ul>
<li>“a”(java.lang.String)</li>
<li>‘a’(char)</li>
<li>1(int)</li>
<li>1L(long)</li>
<li>0.1F(float)</li>
<li>0.1D(double)</li>
<li>0.1B(java.math.BigDecimal)</li>
<li>1H(java.math.BigInteger)</li>
<li>true, false(Boolean)</li>
<li>null</li>
</ul>
<h3 id="演算子"><a href="#演算子" class="headerlink" title="演算子"></a>演算子</h3><p>以下の演算子が使用できます。</p>
<h4 id="算術演算子"><a href="#算術演算子" class="headerlink" title="算術演算子"></a>算術演算子</h4><ul>
<li>e1 + e2(足し算)</li>
<li>e1 - e2 (引き算)</li>
<li>e1 * e2 (掛け算)</li>
<li>e1 / e2 (割り算)</li>
<li>e1 % e2 (余り)</li>
</ul>
<h4 id="比較演算子"><a href="#比較演算子" class="headerlink" title="比較演算子"></a>比較演算子</h4><ul>
<li>e1 eq e2, e1 == e2 (等しい)<br>→ e1・e2のいずれかがnullの場合、両方ともnullの時のみe1とe2は等しい。<br>→ e1・e2が同じオブジェクトの場合、またはequals()メソッドにより等しいと判断される場合、e1とe2は等しい。<br>→ e1・e2が数値の場合、倍精度浮動小数点数が等しい時のみe1とe2は等しい。<br>→ その以外の場合、e1とe2は等しくない。</li>
<li>e1 neq e2, e1 != e2 (等しくない)</li>
<li>e1 lt e2, e1 &lt; e2 (小なり)</li>
<li>e1 lte e2, e1 &lt;= e2 (小なりイコール)</li>
<li>e1 gt e2, e1 &gt; e2 (大なり)</li>
<li>e1 gte e2, e1 &gt;= e2 (大なりイコール)</li>
</ul>
<h4 id="論理演算子"><a href="#論理演算子" class="headerlink" title="論理演算子"></a>論理演算子</h4><ul>
<li>e1 or e2, e1 || e2 (論理和)</li>
<li>e1 and e2, e1 &amp;&amp; e2 (論理積)</li>
<li>not e, ! e (論理否定)</li>
</ul>
<h4 id="連結演算子"><a href="#連結演算子" class="headerlink" title="連結演算子"></a>連結演算子</h4><ul>
<li>e1 + e2 (文字列連結)</li>
</ul>
<h3 id="メソッド・フィールドの呼び出し"><a href="#メソッド・フィールドの呼び出し" class="headerlink" title="メソッド・フィールドの呼び出し"></a>メソッド・フィールドの呼び出し</h3><p>以下のようにメソッド・フィールドの呼び出しができます。</p>
<ul>
<li>e.method(args) (メソッドの呼び出し)</li>
<li>e.property (フィールドの呼び出し)</li>
</ul>
<div style="font-size:130%; font-weight:bold;"><br><a href="../basics" style="float:left">&#60;&#60; 基本操作</a><a href="../developer_guide" style="float:right">開発者ガイド &#62;&#62;</a><br></div>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[開発者ガイド]]></title>
      <url>./uroborosql-doc/developer_guide/</url>
      <content type="html"><![CDATA[<hr>
<ul>
<li>コネクションの切り替え</li>
<li>操作のフィルタリング</li>
<li>SQLファイルのキャッシュ</li>
<li>springフレームワークとの統合</li>
</ul>
<hr>
<div style="font-size:130%; font-weight:bold;"><br><a href="../advanced" style="float:left">&#60;&#60; 高度な操作</a><a href="../about_uroborosql" style="float:right">uroboroSQLについて &#62;&#62;</a><br></div>]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[uroboroSQLについて]]></title>
      <url>./uroborosql-doc/about_uroborosql/</url>
      <content type="html"><![CDATA[<hr>
<ul>
<li>リリースノート</li>
<li>FAQ</li>
</ul>
<hr>
<div style="font-size:130%; font-weight:bold;"><br><a href="../developer_guide" style="float:left">&#60;&#60; 開発者ガイド</a><br></div>]]></content>
      
        
    </entry>
    
  
  
    
  
</search>
