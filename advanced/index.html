<!DOCTYPE html>
<html lang="ja">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--Description-->
    
        <meta name="description" content="バインド出来るパラメーターの型
バッチ実行
ストアドプロシージャの実行
トランザクション
エラーハンドリング 
ストリームAPI
ログ
式言語


バインド出来るパラメーターの型uroboroSQLでバインド出来るパラメーターの型は、下記の通りです。

プリミティブ型とそのラッパー型（ただし cha">
    

    <!--Author-->
    
        <meta name="author" content="Future Architect">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="高度な操作"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="uroboroSQL"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="/uroborosql-doc/images/logo.png"/>
    

    <!-- Title -->
    
    <title>高度な操作 - uroboroSQL</title>

    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="/css/main.css"> -->
    <link rel="stylesheet" href="/uroborosql-doc/css/main.css">

    <!--[if lt IE 8]>
        <script src="/uroborosql-doc/js/ie/html5shiv.js"></script>
    <![endif]-->

    <!--[if lt IE 8]>
        <link rel="stylesheet" href="/uroborosql-doc/sass/ie8.css">
    <![endif]-->

    <!--[if lt IE 9]>
        <link rel="stylesheet" href="/uroborosql-doc/sass/ie9.css">
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />
    <link rel="shortcut icon" href="/uroborosql-doc/favicon.ico">

    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer>
      {lang: 'ja'}
    </script>
    <!-- Google Analytics -->
    


</head>


<body>

    <div id="wrapper">

        <!-- Menu -->
        <!-- Header -->
<header id="header">
    <div class="inner">
        <!-- Logo -->
        <a href="/uroborosql-doc/" class="logo">
            <span class="symbol"><img src="/uroborosql-doc//images/logo.png" alt="" /></span>
        </a>
        <!-- Nav -->
        <nav>
            <ul>
                <li><a href="#menu">Menu</a></li>
            </ul>
        </nav>
    </div>
</header>
<!-- Menu -->
<nav id="menu">
    <h2>Menu</h2>
    <form id="search-form">
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off"/>
        <i class="fa fa-times" onclick="resetSearch()"></i>
    </form>
    <div id="local-search-result"></div>
    <p class='no-result'>No results found</p>
    <script type="text/javascript"
    src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
    <script src="/uroborosql-doc/js/search.js"></script>
    <script>
    var path = "/uroborosql-doc//search.xml";
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>
    <ul id="menu-agenda">
        <li><a href="/uroborosql-doc/why_uroborosql/">Why? uroboroSQL</a></li>
        <li><a href="/uroborosql-doc/getting_started/">Getting Started</a></li>
        <li><a href="/uroborosql-doc/basics/">基本操作</a></li>
        <li><a href="/uroborosql-doc/advanced/">高度な操作</a></li>
        <li><a href="/uroborosql-doc/developer_guide/">開発者ガイド</a></li>
        <li><a href="/uroborosql-doc/about_uroborosql/">uroboroSQLについて</a></li>
    </ul>
</nav>

        <div id="main">
            <div class="inner">

                <!-- Main Content -->
                

    <h1>高度な操作</h1>



<!-- Gallery -->


<!-- Content -->
<hr>
<ul>
<li><a href="#バインド出来るパラメーターの型">バインド出来るパラメーターの型</a></li>
<li><a href="#バッチ実行">バッチ実行</a></li>
<li><a href="#ストアドプロシージャの実行">ストアドプロシージャの実行</a></li>
<li><a href="#トランザクション">トランザクション</a></li>
<li><a href="#エラーハンドリング">エラーハンドリング </a></li>
<li><a href="#ストリームAPI">ストリームAPI</a></li>
<li><a href="#ログ">ログ</a></li>
<li><a href="#式言語">式言語</a></li>
</ul>
<hr>
<h2 id="バインド出来るパラメーターの型"><a href="#バインド出来るパラメーターの型" class="headerlink" title="バインド出来るパラメーターの型"></a>バインド出来るパラメーターの型</h2><p>uroboroSQLでバインド出来るパラメーターの型は、下記の通りです。</p>
<ul>
<li>プリミティブ型とそのラッパー型（ただし char と java.lang.Character は除く）</li>
<li>java.math.BigDecimal</li>
<li>java.math.BigInteger</li>
<li>java.lang.String</li>
<li>byte[ ]</li>
<li>java.sql.Date</li>
<li>java.sql.Time</li>
<li>java.sql.Timestamp</li>
<li>java.sql.Array</li>
<li>java.sql.Ref</li>
<li>java.sql.Blob</li>
<li>java.sql.Clob</li>
<li>java.sql.SQLXML</li>
<li>java.sql.Struct</li>
<li>列挙型(enum)</li>
<li>java.util.Date</li>
<li>java.util.Optional</li>
<li>java.util.OptionalInt</li>
<li>java.util.OptionalLong</li>
<li>java.util.OptionalDouble</li>
<li>java.time.LocalDateTime</li>
<li>java.time.OffsetDateTime</li>
<li>java.time.ZonedDateTime</li>
<li>java.time.LocalDate</li>
<li>java.time.LocalTime</li>
<li>java.time.OffsetTime</li>
<li>java.time.Year</li>
<li>java.time.YearMonth</li>
<li>java.time.MonthDay</li>
<li>java.time.Month</li>
<li>java.time.DayOfWeek</li>
</ul>
<h2 id="バッチ実行"><a href="#バッチ実行" class="headerlink" title="バッチ実行"></a>バッチ実行</h2><p>複数の挿入/更新/削除処理を実行する場合、<code>addBatch</code>と<code>executeBatch</code>メソッドを使用することでバッチ更新を行うことが出来ます。<br>例として、以下のSQLを実行するケースを考えてみます。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span></div><div class="line">    ms_products</div><div class="line"><span class="keyword">values</span>(</div><div class="line">    <span class="comment">/* product_id */</span><span class="string">'0040'</span>,</div><div class="line">    <span class="comment">/* product_category_id */</span><span class="string">'09'</span>,</div><div class="line">    <span class="comment">/* product_name */</span><span class="string">'コーラ'</span>,</div><div class="line">    <span class="comment">/* product_price */</span><span class="number">120</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>挿入処理を行いたいデータが複数存在する場合、以下の様に記述をすることでバッチ更新が実行されます。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">sqlContext.addParam(<span class="string">"product_id"</span>, <span class="string">"0040"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_category_id"</span>, <span class="string">"09"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_name"</span>, <span class="string">"コーラ"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_price"</span>, <span class="number">120</span>);</div><div class="line">sqlContext.addBatch();</div><div class="line"></div><div class="line">sqlContext.addParam(<span class="string">"product_id"</span>, <span class="string">"0041"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_category_id"</span>, <span class="string">"09"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_name"</span>, <span class="string">"サイダー"</span>);</div><div class="line">sqlContext.addParam(<span class="string">"product_price"</span>, <span class="number">120</span>);</div><div class="line">sqlContext.addBatch();</div><div class="line"></div><div class="line">sqlAgent.executeBatch(sqlContext);</div></pre></td></tr></table></figure></p>
<h2 id="ストアドプロシージャの実行"><a href="#ストアドプロシージャの実行" class="headerlink" title="ストアドプロシージャの実行"></a>ストアドプロシージャの実行</h2><p><code>executeProcedure</code>メソッドを利用することで、ストアドプロシージャを実行することが出来ます。<br>例えば、<code>product_id</code>で商品の有無を確認するストアドプロシージャ<code>product_id_exists_check</code>を実行する以下SQLを考えます。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">call</span> product_id_exists_check(<span class="comment">/*product_id*/</span><span class="string">'0010'</span>, <span class="comment">/*check_out*/</span>)</div></pre></td></tr></table></figure></p>
<p>この時には、以下の様に記述をすることでストアドプロシージャを実行することが出来ます。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sqlContext.addParam(<span class="string">"product_id"</span>,<span class="string">"0010"</span> );</div><div class="line">sqlContext.addOutParam(<span class="string">"check_out"</span>,Types.NUMERIC);</div><div class="line"></div><div class="line">Map&lt;String, Object&gt; result = sqlAgent.executeProcedure(sqlContext);</div></pre></td></tr></table></figure></p>
<p><code>addOutParam</code>メソッドにより、<code>check_out</code>を戻り値として返されるパラメーターとして設定をしています。このプロシージャの実行結果は<code>result.get(&quot;check_out&quot;)</code>により取得が可能です。</p>
<h2 id="トランザクション"><a href="#トランザクション" class="headerlink" title="トランザクション"></a>トランザクション</h2><h2 id="エラーハンドリング"><a href="#エラーハンドリング" class="headerlink" title="エラーハンドリング"></a>エラーハンドリング</h2><p>エラーが発生した際、エラーコードの種類によるリトライを設定することが出来ます。<br>リトライするエラーコード、最大リトライ回数、リトライ時の待機時間を下記のように指定します。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; sqlRetryCodeList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">sqlRetryCodeList.add(<span class="string">"54"</span>);</div><div class="line">sqlRetryCodeList.add(<span class="string">"60"</span>);</div><div class="line">agentFactory.setSqlRetryCodeList(sqlRetryCodeList); <span class="comment">// リトライ対象とするSQLエラーコード。デフォルトは指定なし。</span></div><div class="line"></div><div class="line">agentFactory.setDefaultMaxRetryCount(<span class="number">3</span>); <span class="comment">// 最大リトライ回数。デフォルトは0。</span></div><div class="line"></div><div class="line">agentFactory.setDefaultSqlRetryWaitTime(<span class="number">1000</span>); <span class="comment">// リトライ時の待機時間(ms)。デフォルトは0。</span></div></pre></td></tr></table></figure></p>
<h2 id="ストリームAPI"><a href="#ストリームAPI" class="headerlink" title="ストリームAPI"></a>ストリームAPI</h2><p>実行したSQLの結果を取得したい際には、ストリームAPIを利用することが出来ます。  </p>
<h2 id="ログ"><a href="#ログ" class="headerlink" title="ログ"></a>ログ</h2><p>uroboroSQLではログ出力ライブラリとしてLogbackを使用しています。Logbackの詳細は<a href="http://logback.qos.ch/manual/index_ja.html" target="_blank" rel="external">公式のドキュメント</a>を参照して下さい。<br>クラス毎で出力されるログ内容は以下表の通りです。</p>
<table>
<thead>
<tr>
<th style="text-align:center">クラス名</th>
<th style="text-align:center">TRACE</th>
<th style="text-align:center">DEBUG</th>
<th style="text-align:center">INFO</th>
<th style="text-align:center">WARN</th>
<th style="text-align:center">ERROR</th>
<th style="text-align:center">FATAL</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AbstractAgent</td>
<td style="text-align:center">変換前SQL</td>
<td style="text-align:center">実行時SQL</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">DebugSqlFilter</td>
<td style="text-align:center">-</td>
<td style="text-align:center">パラメーター/<br\>対象データ数/<br\>実行結果</br\></br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">IfNode</td>
<td style="text-align:center">-</td>
<td style="text-align:center">評価式/<br\>判定結果/<br\>パラメーター</br\></br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">Parameter</td>
<td style="text-align:center">-</td>
<td style="text-align:center">パラメーターの設定</td>
<td style="text-align:center">-</td>
<td style="text-align:center">サブパラメーター値にNULLを設定</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SecretColumnSqlFilter</td>
<td style="text-align:center">-</td>
<td style="text-align:center">バッチ処理追加件数/<br\>ストアドプロシージャ出力パラメーター</br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlAgent</td>
<td style="text-align:center">ステートメントのクローズ</td>
<td style="text-align:center">処理実行アナウンス/<br\>リトライ実行アナウンス/<br\>SQL実行時間</br\></br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">エラーメッセージ</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlContext</td>
<td style="text-align:center">-</td>
<td style="text-align:center">バッチ処理追加件数/<br\>ストアドプロシージャ出力パラメーター</br\></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlContextFactory</td>
<td style="text-align:center">-</td>
<td style="text-align:center">定数パラメーター</td>
<td style="text-align:center">-</td>
<td style="text-align:center">定数名の重複</td>
<td style="text-align:center">エラーメッセージ</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">SqlLoader</td>
<td style="text-align:center">SQL定義ファイルの読み込み完了</td>
<td style="text-align:center">SQL定義ファイルの読み込み開始/読み込み中</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">デフォルトファイルパスの設定/<br\>デフォルト拡張子/<br\>空のSQLキャッシュの返却</br\></br\></td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table>
<h2 id="式言語"><a href="#式言語" class="headerlink" title="式言語"></a>式言語</h2><h3 id="リテラル"><a href="#リテラル" class="headerlink" title="リテラル"></a>リテラル</h3><p>以下のリテラルが使用できます。</p>
<ul>
<li>“a”(java.lang.String)</li>
<li>‘a’(char)</li>
<li>1(int)</li>
<li>1L(long)</li>
<li>0.1F(float)</li>
<li>0.1D(double)</li>
<li>0.1B(java.math.BigDecimal)</li>
<li>1H(java.math.BigInteger)</li>
<li>true, false(Boolean)</li>
<li>null</li>
</ul>
<h3 id="演算子"><a href="#演算子" class="headerlink" title="演算子"></a>演算子</h3><p>以下の演算子が使用できます。</p>
<h4 id="算術演算子"><a href="#算術演算子" class="headerlink" title="算術演算子"></a>算術演算子</h4><ul>
<li>e1 + e2(足し算)</li>
<li>e1 - e2 (引き算)</li>
<li>e1 * e2 (掛け算)</li>
<li>e1 / e2 (割り算)</li>
<li>e1 % e2 (余り)</li>
</ul>
<h4 id="比較演算子"><a href="#比較演算子" class="headerlink" title="比較演算子"></a>比較演算子</h4><ul>
<li>e1 eq e2, e1 == e2 (等しい)<br>→ e1・e2のいずれかがnullの場合、両方ともnullの時のみe1とe2は等しい。<br>→ e1・e2が同じオブジェクトの場合、またはequals()メソッドにより等しいと判断される場合、e1とe2は等しい。<br>→ e1・e2が数値の場合、倍精度浮動小数点数が等しい時のみe1とe2は等しい。<br>→ その以外の場合、e1とe2は等しくない。</li>
<li>e1 neq e2, e1 != e2 (等しくない)</li>
<li>e1 lt e2, e1 &lt; e2 (小なり)</li>
<li>e1 lte e2, e1 &lt;= e2 (小なりイコール)</li>
<li>e1 gt e2, e1 &gt; e2 (大なり)</li>
<li>e1 gte e2, e1 &gt;= e2 (大なりイコール)</li>
</ul>
<h4 id="論理演算子"><a href="#論理演算子" class="headerlink" title="論理演算子"></a>論理演算子</h4><ul>
<li>e1 or e2, e1 || e2 (論理和)</li>
<li>e1 and e2, e1 &amp;&amp; e2 (論理積)</li>
<li>not e, ! e (論理否定)</li>
</ul>
<h4 id="連結演算子"><a href="#連結演算子" class="headerlink" title="連結演算子"></a>連結演算子</h4><ul>
<li>e1 + e2 (文字列連結)</li>
</ul>
<h3 id="メソッド・フィールドの呼び出し"><a href="#メソッド・フィールドの呼び出し" class="headerlink" title="メソッド・フィールドの呼び出し"></a>メソッド・フィールドの呼び出し</h3><p>以下のようにメソッド・フィールドの呼び出しができます。</p>
<ul>
<li>e.method(args) (メソッドの呼び出し)</li>
<li>e.property (フィールドの呼び出し)</li>
</ul>
<div style="font-size:130%; font-weight:bold;"><br><a href="../basics" style="float:left">&#60;&#60; 基本操作</a><a href="../developer_guide" style="float:right">開発者ガイド &#62;&#62;</a><br></div>

<!-- Tags -->



<div class="tags">
    
</div>



<!-- Comments -->
<div>
    


</div>



            </div>
        </div>

        <!-- Footer -->
<footer id="footer">
  <div class="inner">
      <div>
        <h2>Share</h2>
        <ul class="sns-area">
          <li>
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="https://future-architect.github.io/uroborosql-doc/">Tweet</a>
            <script>
            ! function(d, s, id) {
              var js, fjs = d.getElementsByTagName(s)[0],
                p = /^http:/.test(d.location) ? 'http' : 'https';
              if (!d.getElementById(id)) { js = d.createElement(s);
                js.id = id;
                js.src = p + '://platform.twitter.com/widgets.js';
                fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');

            </script>
          </li>
          <li>
            <iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Ffuture-architect.github.io%2Furoborosql-doc%2F&width=130&layout=button_count&action=like&size=small&show_faces=true&share=true&height=46&appId=316260158574612" width="130" height="46" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
          </li>
          <li>
            <a href="http://b.hatena.ne.jp/entry/s/future-architect.github.io/uroborosql-doc/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-counter" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
          </li>
          <li>
            <div class="g-plusone" data-size="medium" data-href="https://future-architect.github.io/uroborosql-doc/"></div>
          </li>
        </ul>
      </div>
      <div>
          <h2>Follow</h2>
          <ul class="icons">
              
                  <li><a href="https://twitter.com/future_techblog" class="icon style2 fa-twitter" target="_blank" ><span class="label">Twitter</span></a></li>
              
              
                  <li><a href="https://www.facebook.com/future.saiyo" class="icon style2 fa-facebook" target="_blank" ><span class="label">Facebook</span></a></li>
              
              
                  <li><a href="https://github.com/future-architect" class="icon style2 fa-github" target="_blank" ><span class="label">GitHub</span></a></li>
              
              
                  <li><a href="http://qiita.com/organizations/future" class="icon style2 fa-pencil" target="_blank" ><span class="label">Qiita</span></a></li>
              
              
                 <li><a href="https://future-architect.github.io/" class="icon style2 fa-pencil-square-o" target="_blank" ><span class="label">Tech Blog</span></a></li>
              
          </ul>
      </div>
      <br>
      <ul class="copyright">
          <li>&copy; 2017 Future Architect. All rights reserved</li>
          <li>Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a></li>
      </ul>
  </div>
</footer>
    </div>

    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="/uroborosql-doc/js/jquery.min.js"></script>

<!-- skel -->
<script src="/uroborosql-doc/js/skel.min.js"></script>

<!-- Custom Code -->
<script src="/uroborosql-doc/js/util.js"></script>

<!--[if lte IE 8]>
<script src="/uroborosql-doc/js/ie/respond.min.js"></script>
<![endif]-->

<!-- Custom Code -->
<script src="/uroborosql-doc/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>